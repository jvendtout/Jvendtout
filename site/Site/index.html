<!DOCTYPE html>
<html lang="fr">
<head>
<link href="https://fonts.googleapis.com/css2?family=Inter&family=Poppins&family=Lato&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #520670, #210641);
      min-height: 100vh;
      margin: 0;
      padding: 60px 1rem 1rem; /* Top padding pour le banner fixe */
      color: white;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      min-height: calc(100vh - 80px);
      padding: 1rem;
    }

    /* Top Banner Style Amazon */
    .top-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 999;
      background: linear-gradient(135deg, #2e003e, #4b1a7f);
      padding: 8px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(255, 211, 105, 0.2);
      min-height: 50px;
    }

    .banner-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .banner-logo {
      font-size: 18px;
      font-weight: 600;
      color: #ffd369;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .banner-nav {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .banner-nav button {
      padding: 6px 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      color: white;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .banner-nav button:hover {
      background: rgba(255, 211, 105, 0.2);
      color: #ffd369;
      transform: translateY(-1px);
    }

    .banner-nav button.active {
      background: #ffd369;
      color: #2e003e;
      font-weight: 600;
    }

    .banner-nav img {
      width: 12px;
      height: 12px;
    }

    /* Cacher les anciens éléments */
    .hamburger, .sidebar {
      display: none !important;
    }

    /* Menu latéral */
    .sidebar {
      position: fixed;
      top: 0;
      left: -280px;
      width: 280px;
      height: 100vh;
      background: linear-gradient(135deg, #2e003e, #4b1a7f);
      backdrop-filter: blur(15px);
      border-right: 1px solid rgba(255, 255, 255, 0.2);
      padding: 4rem 1.5rem 2rem;
      z-index: 1000;
      transition: left 0.3s ease;
      overflow-y: auto;
      box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
    }

    .sidebar.open {
      left: 0;
    }

    .sidebar button {
      display: block;
      width: 100%;
      padding: 16px 20px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      cursor: pointer;
      margin-bottom: 12px;
      transition: all 0.3s ease;
      font-size: 16px;
      font-weight: 500;
      text-align: left;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .sidebar button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.5s;
    }

    .sidebar button:hover::before {
      left: 100%;
    }

    .sidebar button:hover {
      background: linear-gradient(135deg, rgba(255, 211, 105, 0.2), rgba(255, 179, 71, 0.1));
      color: #ffd369;
      transform: translateX(8px) scale(1.02);
      box-shadow: 0 6px 20px rgba(255, 211, 105, 0.3);
      border-color: rgba(255, 211, 105, 0.4);
    }

    .sidebar button.active {
      background: linear-gradient(135deg, #ffd369, #ffb347);
      color: #2e003e;
      font-weight: 600;
      transform: translateX(12px) scale(1.05);
      box-shadow: 0 8px 25px rgba(255, 211, 105, 0.5);
      border-color: #ffd369;
    }

    .sidebar button.active::before {
      display: none;
    }

    /* Menu horizontal responsive */
    .menu-horizontal {
      display: none;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 1rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Tooltips stylisés */
    [data-tooltip] {
      position: relative;
    }
    
    [data-tooltip]::before {
      content: attr(data-tooltip);
      visibility: hidden;
      opacity: 0;
      position: absolute;
      top: calc(100% + 10px);
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #2e003e, #6a0572);
      color: #8ef58e;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 0.85em;
      white-space: nowrap;
      z-index: 10001;
      border: 1px solid #ffd369;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease;
      pointer-events: none;
      font-weight: 500;
      line-height: 1.4;
    }
    
    [data-tooltip]::after {
      content: '';
      visibility: hidden;
      opacity: 0;
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border-width: 6px;
      border-style: solid;
      border-color: transparent transparent #ffd369 transparent;
      transition: all 0.3s ease;
    }
    
    [data-tooltip]:hover::before,
    [data-tooltip]:hover::after {
      visibility: visible;
      opacity: 1;
    }
    
    [data-tooltip]:hover::before {
      top: calc(100% + 12px);
    }

    /* Responsive du banner */
    @media (max-width: 768px) {
      .banner-nav {
        gap: 4px;
      }
      
      .banner-nav button {
        padding: 4px 8px;
        font-size: 11px;
      }
      
      .banner-logo {
        font-size: 16px;
      }
      
      .banner-nav img {
        width: 10px;
        height: 10px;
      }
      
      .top-banner {
        padding: 6px 8px;
        min-height: 44px;
      }
      
      body {
        padding-top: 54px;
      }
      
      .container {
        min-height: calc(100vh - 70px);
      }
    }

    @media (max-width: 480px) {
      .banner-nav button span {
        display: none; /* Cacher le texte sur très petit écran */
      }
      
      .banner-nav {
        gap: 2px;
      }
      
      .banner-nav button {
        padding: 4px 6px;
        min-width: 32px;
        justify-content: center;
      }
    }

    @media (min-width: 768px) {
      /* Menu hamburger toujours visible */
      .hamburger {
        display: block;
      }
      
      .menu-horizontal {
        display: flex;
      }
      
      /* Sidebar accessible sur desktop aussi */
      .sidebar {
        display: block;
      }
    }

    .menu-horizontal button {
      background: #4b1a7f;
      color: #8ef58e;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      font-weight: bold;
      cursor: pointer;
      text-align: left;
      white-space: nowrap;
      transition: all 0.3s;
    }

    .menu-horizontal button:hover {
      background: #6a2c93;
      transform: translateY(-2px);
    }

    .menu-horizontal button.active {
      background: #8ef58e;
      color: #2e003e;
    }

    /* Contenu principal */
    .main-content {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    .content-section {
      display: none;
    }

    .content-section.active {
      display: block;
    }

    /* Contrôles de filtre */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      background: rgba(255, 255, 255, 0.05);
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
      z-index: 100;
    }

    .search-container {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 8px 12px;
      flex: 1;
      min-width: 200px;
      overflow: hidden; /* empêche débordement horizontal */
    }

    #search-input {
      background: transparent;
      border: none;
      outline: none;
      color: white;
      flex: 1;
      padding: 4px 8px;
      min-width: 0; /* autorise le shrink dans flex */
      white-space: nowrap; /* une seule ligne */
      overflow: hidden; /* cacher dépassement */
      text-overflow: ellipsis; /* afficher ... si trop long */
    }

    #search-input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    .search-icon {
      color: #ffd369;
      margin-right: 8px;
    }

    /* Boutons de contrôle */
    .control-btn {
      background: #4b1a7f;
      color: #8ef58e;
      border: none;
      border-radius: 6px;
      padding: 10px 16px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .control-btn:hover {
      background: #6a2c93;
      transform: translateY(-2px);
    }

    /* --- Mobile consolidated menu --- */
    .mobile-menu-wrapper { position: relative; }
    .mobile-menu-toggle {
      background: #6a2c93;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      font-weight: 600;
      display: none; /* hidden desktop */
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }
    .mobile-menu-toggle:active { transform: scale(0.96); }
    .mobile-menu-toggle span { font-size: 14px; }
    .mobile-menu-panel {
      position: absolute;
      top: 110%;
      right: 0;
      background: rgba(46,0,79,0.95);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.15);
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
      border-radius: 12px;
      padding: 8px;
      display: none;
      flex-direction: column;
      min-width: 180px;
      z-index: 9999;
      animation: mobileMenuFade .25s ease;
    }
    .mobile-menu-panel.open { display: flex; }
    .mobile-menu-panel button.control-btn,
    .mobile-menu-panel .control-btn { width: 100%; justify-content: flex-start; }
    .mobile-menu-panel .sort-dropdown { width: 100%; }
    .mobile-menu-panel .sort-dropdown .control-btn { width: 100%; }
  /* Mobile: options de tri masquées par défaut, visibles seulement si dropdown actif */
  .mobile-menu-panel .sort-options { position: static; box-shadow: none; border: none; background: transparent; opacity: 0; visibility: hidden; transform: none; padding-top: 4px; height: 0; overflow: hidden; transition: opacity .25s ease; }
  .mobile-menu-panel .sort-dropdown.active .sort-options { opacity: 1; visibility: visible; height: auto; }
    .mobile-menu-panel .sort-option { border-radius: 6px; }
    @keyframes mobileMenuFade { from { opacity:0; transform: translateY(-6px);} to {opacity:1; transform: translateY(0);} }
    /* Hide original buttons on small screens when consolidated menu used */
    @media (max-width: 760px) {
      /* Cacher seulement les boutons originaux (enfants directs) hors wrapper */
      .controls > .control-btn,
      .controls > .sort-dropdown,
      .controls > #cart-button { display: none; }
      .controls .mobile-menu-toggle { display: inline-flex; }
      .controls { align-items: center; flex-direction: row !important; flex-wrap: nowrap; }
      .search-container { flex: 1; }
      .mobile-menu-wrapper { position: relative; margin-left: 8px; top: 0; right: 0; }
      /* Panneau flottant (restauré) */
      .mobile-menu-panel { width: 220px; position: absolute; top: 42px; right: 0; box-shadow: 0 8px 24px rgba(0,0,0,0.4); background: rgba(46,0,79,0.9); border: 1px solid rgba(255,255,255,0.15); margin-top: 0; border-radius:12px; }
      @media (max-width: 420px){
        .mobile-menu-panel { width: 200px; }
      }
  .mobile-menu-panel .sort-options { background: rgba(255,255,255,0.06); padding: 4px; border-radius:8px; }
    }

    /* Override spécifique pour petite largeur: garder recherche + menu sur une ligne */
    @media (max-width: 760px) {
      .content-section .controls { display: flex; }
      .content-section .controls .search-container { min-width: 0; }
      .content-section .controls .mobile-menu-wrapper { flex: 0 0 auto; position: relative; right: auto; top: auto; }
      .content-section .controls .mobile-menu-toggle { white-space: nowrap; }
    }

    /* Dropdowns de tri */
    .sort-dropdown {
      position: relative;
      display: inline-block;
      z-index: 9998 !important;
    }

    .sort-dropdown.active {
      z-index: 9999 !important;
    }

    .dropdown-arrow {
      font-size: 12px;
      transition: transform 0.3s;
    }

    .sort-dropdown.active .dropdown-arrow {
      transform: rotate(180deg);
    }

    .sort-options {
      position: absolute;
      top: 100%;
      left: 0;
      min-width: 180px;
      background: rgba(46, 0, 79, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      z-index: 99999 !important;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s;
    }

    .sort-dropdown.active .sort-options {
      opacity: 1;
      visibility: visible;
      transform: translateY(5px);
    }

    .sort-option {
      padding: 12px 16px;
      cursor: pointer;
      color: #fff;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .sort-option:last-child {
      border-bottom: none;
    }

    .sort-option:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .sort-option.active {
      background: rgba(106, 44, 147, 0.5);
      color: #8ef58e;
      font-weight: 600;
    }

    /* Grille de produits */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      grid-auto-rows: max-content;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    /* Forcer au moins 2 colonnes sur petits écrans */
    @media (max-width: 600px) {
      .products-grid {
        grid-template-columns: repeat(2, 1fr) !important;
      }
      
      .product-card {
        padding: 6px !important;
      }
      
      .product-card img,
      .product-card video {
        height: 70px !important;
        margin-bottom: 6px !important;
      }
      
      .product-name {
        font-size: 0.85em !important;
        -webkit-line-clamp: 2 !important;
        line-clamp: 2 !important;
      }
      
      .product-description {
        font-size: 0.75em !important;
        line-height: 1.2 !important;
      }
      
      .product-price {
        font-size: 1em !important;
      }
      
      .product-status {
        font-size: 0.7em !important;
        padding: 3px 8px !important;
      }
      
      .add-to-cart-btn {
        padding: 6px 12px !important;
        font-size: 0.85em !important;
      }
    }

    .product-card {
      background: linear-gradient(135deg, #2e004f, #1976d2);
      border-radius: 12px;
      padding: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      transition: all 0.3s;
      cursor: pointer;
      border: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
 
    .product-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, #8ef58e, #ffd369);
    }

    .product-card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    .product-card img,
    .product-card video {
      width: 100%;
      height: 120px;
      object-fit: contain;
      border-radius: 8px;
      margin-bottom: 12px;
      background: rgba(255, 255, 255, 0.1);
    }

    /* Cas spécial pour les cartes sans image */
    .product-card.no-image {
      min-height: auto;
    }

    .product-card.no-image .product-info {
      padding-top: 8px;
    }

    .product-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }

    .product-name {
      font-weight: bold;
      color: #ffd369;
      font-size: 1em;
      line-height: 1.2;
      max-height: calc(1.2em * 3); /* Limiter à 3 lignes */
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      -webkit-box-orient: vertical;
    }

    .product-description {
      color: #8ef58e;
      font-size: 0.9em;
      line-height: 1.4;
      opacity: 0.9;
    }

    .product-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto;
      padding-top: 0px;
    }

    .product-price {
      color: #ff6b6b;
      font-weight: bold;
      font-size: 1.2em;
    }

    .product-status {
      background: #8ef58e;
      color: #2e003e;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: bold;
    }

    .add-to-cart-btn {
      background: #8ef58e;
      color: #2e003e;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }

    .add-to-cart-btn:hover {
      background: #7ae67a;
      transform: scale(1.05);
    }

    /* Modales à droite style static-index.html */
    .modal.hidden { 
      display: none !important; 
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: transparent;
      z-index: 1000;
      pointer-events: none;
    }
    
    /* Z-index spécifique pour product-selection-modal pour qu'elle apparaisse au-dessus de add-review-modal */
    #product-selection-modal {
      z-index: 1001;
    }

    .modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Modales côté droit - TOUTES les modales demandées */
    .modal.show#product-modal,
    .modal.show#cart-modal,
    .modal.show#arnaqueur-modal,
    .modal.show#category-modal,
    .modal.show#filter-modal,
    .modal.show#add-review-modal,
    .modal.show#add-arnaque-modal,
    .modal.show#product-selection-modal,
    .modal.show#review-detail-modal,
    .modal.show#sommaire-modal {
      justify-content: flex-end;
      align-items: stretch;
    }

    .modal.show#product-modal .modal-content,
    .modal.show#cart-modal .modal-content,
    .modal.show#arnaqueur-modal .modal-content,
    .modal.show#category-modal .modal-content,
    .modal.show#filter-modal .modal-content,
    .modal.show#add-review-modal .modal-content,
    .modal.show#add-arnaque-modal .modal-content,
    .modal.show#review-detail-modal .modal-content {
      width: 400px;
      max-width: 100%;
      height: 100%;
      margin: 0;
    }

    /* Modal de sélection de produit plus large */
    .modal.show#product-selection-modal .modal-content {
      width: 600px;
      max-width: 100%;
      height: 100%;
      margin: 0;
      border-radius: 0;
    }

    /* Modales centrées */
    .modal.show#media-selection-modal {
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      padding: 20px;
      height: 100%;
      box-sizing: border-box;
      position: relative;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #2e003e, #6a0572);
      color: white;
      border-radius: 0;
      max-width: none;
      max-height: none;
      overflow-y: auto;
      border: none;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
      pointer-events: auto;
    }

    .modal .close {
      position: absolute;
      right: 15px;
      top: 10px;
      cursor: pointer;
      font-size: 24px;
      background: none;
      border: none;
      color: white;
    }

    /* Style panier */
    #cart-modal .modal-content {
      background: linear-gradient(135deg, #2e003e, #6a0572) !important;
      color: white;
      border-radius: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
      display: flex;
      flex-direction: column;
      height: 100%;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
    }

    .cart-modal-content {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .cart-main-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .cart-commander-btn {
      position: sticky;
      bottom: 0;
      width: 100%;
      padding: 18px 20px;
      margin: 0;
      background: linear-gradient(135deg, #FFFC00, #FFF700);
      color: #000;
      border: none;
      border-radius: 0 0 10px 10px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 -4px 15px rgba(255, 252, 0, 0.3);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .cart-commander-btn:hover {
      background: linear-gradient(135deg, #FFF700, #FFFC00);
      transform: translateY(-2px);
      box-shadow: 0 -6px 20px rgba(255, 252, 0, 0.4);
    }

    .cart-commander-btn img {
      transition: transform 0.3s ease;
      background: #000;
      border-radius: 50%;
      padding: 2px;
      width: 28px;
      height: 28px;
    }

    .cart-commander-btn:hover img {
      transform: scale(1.1);
    }

    #cart-list li {
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #cart-list button {
      background: #ffd369;
      color: #000;
      border: none;
      padding: 5px 10px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    #cart-list button:hover {
      background: #fcbf49;
      transform: scale(1.05);
    }

    /* Style modal produit amélioré */
    #product-modal .modal-content {
      background: linear-gradient(135deg, #2e003e, #6a0572) !important;
      color: white;
      padding: 20px;
      font-family: 'Poppins', sans-serif;
      border-radius: 0 !important;
      height: 100% !important;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    #product-modal h2 {
      color: #ffd369;
      font-size: 1.4em;
      margin-bottom: 15px;
      font-weight: 600;
      flex-shrink: 0;
    }

    #product-modal #modal-description {
      color: #8ef58e;
      line-height: 1.5;
      margin-bottom: 15px;
      flex: 1;
      overflow-y: auto;
      max-height: none;
    }
    
    #product-modal p {
      color: #8ef58e;
      line-height: 1.5;
      margin-bottom: 15px;
    }

    /* Galerie media dans la modal - adaptative */
    .media-gallery {
      margin-bottom: 20px;
      max-height: 60vh; /* Limiter la hauteur pour éviter les coupures */
      overflow-y: auto; /* Scroll si nécessaire */
    }

    .media-item {
      margin-bottom: 15px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .media-item img,
    .media-item video {
      width: 100%;
      max-height: 200px; /* Hauteur maximum réduite */
      object-fit: contain; /* Contenir l'image entière sans couper */
      border-radius: 8px;
      transition: transform 0.3s;
      background: rgba(0,0,0,0.1); /* Fond pour les espaces vides */
    }

    .media-item:hover img,
    .media-item:hover video {
      transform: scale(1.02);
    }

    /* Controles panier dans modal produit - repositionnés */
    #cart-controls {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      margin: 15px 0; /* Margin avant et après */
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 10px;
    }

    #cart-controls button {
      transition: all 0.3s;
    }

    #cart-controls #add-to-cart {
      background: linear-gradient(45deg, #ffd369, #fcbf49);
      color: #2e003e;
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(255, 211, 105, 0.3);
    }

    #cart-controls #add-to-cart:hover {
      background: #ffdb4d;
      transform: translateY(-1px);
    }

    #cart-controls #remove-one {
      background: #ff6b6b;
      border: none;
      color: white;
      border-radius: 4px;
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
    }

    #cart-controls #remove-one:hover {
      background: #ff5252;
    }

    #cart-controls #item-qty {
      background: #ffd369;
      color: #333;
      padding: 4px 12px;
      border-radius: 4px;
      font-weight: bold;
    }

    /* Mobile responsive */
    @media screen and (max-width: 650px) {
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        width: 100%;
        height: 100%;
        margin: 0;
        max-width: none;
        z-index: 1000;
      }
      
      .media-item img,
      .media-item video {
        max-height: 150px; /* Hauteur encore plus réduite sur mobile */
      }
      
      .media-gallery {
        max-height: 40vh; /* Hauteur réduite sur mobile */
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal-title {
      color: #ffd369;
      font-size: 1.4em;
      font-weight: 600;
      margin: 0;
    }

    .close-btn {
      background: #ff6b6b;
      color: white;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
    }

    .close-btn:hover {
      background: #e74c3c;
      transform: scale(1.1);
    }

    /* Panier */
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      margin-bottom: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .cart-item-details {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .item-name {
      font-weight: 600;
      color: #fff;
      font-size: 14px;
    }

    .item-pricing {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .unit-price {
      font-size: 12px;
      color: #a0a0a0;
    }

    .total-price {
      font-size: 14px;
      font-weight: 600;
      color: #ffd369;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .qty-btn {
      width: 28px;
      height: 28px;
      border: none;
      border-radius: 6px;
      background: #6a2c93;
      color: white;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .qty-btn:hover:not(:disabled) {
      background: #8b3db8;
      transform: scale(1.1);
    }

    .qty-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .quantity {
      min-width: 24px;
      text-align: center;
      font-weight: 600;
      color: #8ef58e;
    }

    .remove-btn {
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 6px;
      background: #ff6b6b;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      margin-left: 8px;
    }

    .remove-btn:hover {
      background: #ff5252;
      transform: scale(1.1);
    }

    .cart-total {
      font-size: 1.2em;
      font-weight: bold;
      color: #ffd369;
      text-align: center;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      margin-top: 1rem;
    }

    /* ========== STYLES MODAL ARNAQUE ========== */
    
    .add-arnaque-modal-content {
      max-width: 700px;
      background: linear-gradient(135deg, #1a0b2e 0%, #2d1b4e 50%, #1a0b2e 100%);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(255, 107, 107, 0.3);
      border: 2px solid rgba(255, 107, 107, 0.2);
    }

    .add-arnaque-header {
      background: linear-gradient(135deg, #ff6b6b, #ffd369);
      color: #1a0b2e;
      padding: 20px 30px;
      border-radius: 20px 20px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
    }

    .add-arnaque-title {
      font-size: 24px;
      font-weight: 700;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 12px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .add-arnaque-close {
      background: rgba(26, 11, 46, 0.1);
      color: #1a0b2e;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .add-arnaque-close:hover {
      background: rgba(26, 11, 46, 0.2);
      transform: rotate(90deg) scale(1.1);
    }

    .add-arnaque-form {
      background: transparent;
      padding: 30px;
      border-radius: 0;
      border: none;
      backdrop-filter: none;
      overflow-y: auto;
      max-height: calc(90vh - 80px);
    }

    .add-arnaque-form .form-group label {
      color: #ff6b6b;
      font-weight: 600;
    }

    .add-arnaque-form .form-group input[type="text"],
    .add-arnaque-form .form-group textarea {
      border: 2px solid rgba(255, 107, 107, 0.3);
    }

    .add-arnaque-form .form-group input[type="text"]:focus,
    .add-arnaque-form .form-group textarea:focus {
      border-color: #ff6b6b;
      box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
    }

    .add-arnaque-form .checkbox-label input[type="checkbox"]:checked + .checkmark {
      background: linear-gradient(135deg, #ff6b6b, #ffd369);
      border-color: #ff6b6b;
    }

    .add-arnaque-form .selected-product,
    .add-arnaque-form .selected-products {
      border: 2px dashed rgba(255, 107, 107, 0.3);
    }

    .add-arnaque-form .selected-product:hover,
    .add-arnaque-form .selected-products:hover {
      border-color: #ff6b6b;
      background: rgba(255, 107, 107, 0.1);
    }

    .add-arnaque-form .product-select-btn {
      background: linear-gradient(135deg, #ff6b6b, #ffd369);
    }

    .add-arnaque-form .product-select-btn:hover {
      background: linear-gradient(135deg, #ff7b7b, #ffe379);
      box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
    }

    .add-arnaque-form .media-upload-btn {
      background: linear-gradient(135deg, #4b1a7f, #9b59b6);
      border: 2px dashed rgba(255, 107, 107, 0.3);
    }

    .add-arnaque-form .media-upload-btn:hover {
      background: linear-gradient(135deg, #5b2a8f, #ab69c6);
      border-color: #ff6b6b;
      box-shadow: 0 8px 25px rgba(75, 26, 127, 0.3);
    }

    .reseau-btn-signalement {
      background: #4b1a7f;
      color: #8ef58e;
      border: none;
      border-radius: 6px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 0.9em;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .reseau-btn-signalement:hover {
      background: #6a2a9f;
    }

    .reseau-btn-signalement.selected {
      background: #8ef58e;
      color: #2e004f;
      font-weight: bold;
    }

    .submit-arnaque-btn {
      background: linear-gradient(135deg, #ff6b6b, #ffd369);
      color: #1a1a1a;
      border: none;
      padding: 16px 32px;
      border-radius: 12px;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 1rem;
    }

    .submit-arnaque-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(255, 107, 107, 0.5);
    }

    /* Sélecteur multiple de produits pour arnaque */
    .product-selector-multiple {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .selected-products {
      min-height: 80px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px dashed rgba(255, 107, 107, 0.3);
      border-radius: 12px;
      padding: 10px;
      transition: all 0.3s ease;
    }

    .selected-products:hover {
      border-color: #ff6b6b;
      background: rgba(255, 107, 107, 0.1);
    }

    .selected-products.has-products {
      border-style: solid;
      background: rgba(255, 107, 107, 0.1);
    }

    .selected-products-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .selected-product-tag {
      background: linear-gradient(135deg, #ff6b6b, #ffd369);
      color: #1a0b2e;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.3s ease;
    }

    .selected-product-tag:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
    }

    .selected-product-remove {
      background: rgba(26, 11, 46, 0.3);
      border: none;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .selected-product-remove:hover {
      background: rgba(26, 11, 46, 0.5);
      transform: scale(1.1);
    }

    /* ========== FIN STYLES MODAL ARNAQUE ========== */

    /* Modal arnaque sidebar */
    #add-arnaque-modal .modal-content {
      background: linear-gradient(145deg, #1a0b2e, #16213e) !important;
      color: white;
      border-radius: 0;
      padding: 0;
      border: none;
      backdrop-filter: blur(20px);
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    .add-arnaque-header {
      background: linear-gradient(135deg, #ff6b6b, #ffd369);
      color: #1a0b2e;
      padding: 20px 30px;
      border-radius: 20px 20px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.2);
    }

    .add-arnaque-title {
      font-size: 24px;
      font-weight: 700;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 12px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .add-arnaque-close {
      background: rgba(26, 11, 46, 0.1);
      color: #1a0b2e;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .add-arnaque-close:hover {
      background: rgba(26, 11, 46, 0.2);
      transform: rotate(90deg) scale(1.1);
    }

    .add-arnaque-form {
      background: transparent;
      padding: 30px;
      border-radius: 0;
      border: none;
      backdrop-filter: none;
      overflow-y: auto;
      max-height: calc(90vh - 80px);
    }

    .submit-arnaque-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #ff6b6b, #ffd369);
      color: #1a0b2e;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 1.5rem;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
    }

    .submit-arnaque-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
    }

    /* ========== STYLES TECHNIQUES ARNAQUES ========== */
    
    .technique-arnaque-btn {
      background: linear-gradient(135deg, #ff6b6b, #ffd369);
      color: #1a0b2e;
      border: none;
      padding: 5px 12px;
      border-radius: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.75rem;
      box-shadow: 0 2px 6px rgba(255, 107, 107, 0.3);
    }

    .technique-arnaque-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(255, 107, 107, 0.5);
      background: linear-gradient(135deg, #ff7b7b, #ffe379);
    }

    #technique-detail-modal .modal-content {
      max-width: 600px;
      background: linear-gradient(135deg, #1a0b2e 0%, #2d1b4e 50%, #1a0b2e 100%);
      border: 2px solid rgba(255, 107, 107, 0.3);
    }

    #technique-detail-modal .modal-header {
      background: linear-gradient(135deg, #ff6b6b, #ffd369);
      color: #1a0b2e;
      padding: 20px;
      border-radius: 12px 12px 0 0;
    }

    #technique-detail-modal .modal-body {
      padding: 30px;
      color: #fff;
      font-size: 16px;
      line-height: 1.6;
    }

    /* ========== FIN STYLES TECHNIQUES ARNAQUES ========== */

    /* Responsive */
    @media (max-width: 768px) {
      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1rem;
      }
      
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .search-container {
        min-width: 100%;
      }

      /* Modales responsive - TOUTES les modales prennent tout l'écran sur mobile */
      .modal.show .modal-content {
        width: 100% !important;
        height: 100% !important;
        border-radius: 0 !important;
        max-width: 100% !important;
        max-height: 100% !important;
      }
      
      .modal.show {
        justify-content: stretch !important;
        align-items: stretch !important;
      }
    }

    @media (max-width: 480px) {
      .products-grid {
        grid-template-columns: 1fr;
      }
      
      .container {
        padding: 0.5rem;
      }
      
      .modal-content {
        margin: 1rem;
        padding: 1rem;
      }
    }

    /* Styles pour les Avis */
    .proof-card {
      background: linear-gradient(135deg, #2e004f, #1976d2);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s;
      cursor: pointer;
      border: 1px solid #8ef58e;
      position: relative;
    }

    .proof-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #8ef58e, #ffd369);
    }

    .proof-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    .proof-header {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
    }

    .proof-avatar {
      background: #8ef58e;
      color: #2e003e;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 12px;
      font-size: 1.2em;
    }

    .proof-user-info {
      flex: 1;
    }

    .proof-username {
      font-weight: bold;
      color: #8ef58e;
      font-size: 1.1em;
      margin: 0;
    }

    .proof-date {
      color: #ffd369;
      font-size: 0.85em;
      margin: 2px 0 0 0;
    }

    .proof-title {
      color: #ffd369;
      margin: 0 0 12px 0;
      font-size: 1.2em;
      line-height: 1.3;
      font-weight: 600;
    }

    .proof-testimonial {
      background: rgba(142, 245, 142, 0.1);
      padding: 12px;
      border-radius: 8px;
      border-left: 4px solid #8ef58e;
      margin: 16px 0;
    }

    .proof-testimonial p {
      color: #fff;
      margin: 0;
      line-height: 1.5;
      font-style: italic;
    }

    .proof-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
    }

    .proof-rating {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .proof-star {
      color: #ffd369;
      font-size: 1.2em;
    }

    .proof-rating-text {
      color: #8ef58e;
      margin-left: 8px;
      font-size: 0.9em;
    }

    .proof-verified {
      background: #8ef58e;
      color: #2e003e;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: bold;
    }

    /* Notice pour avis en attente */
    .pending-admin-notice {
      text-align: center;
      margin: 1rem 0;
      padding: 12px;
      background: rgba(255, 107, 107, 0.1);
      border: 1px solid #ff6b6b;
      border-radius: 8px;
      color: #ff6b6b;
      font-weight: 500;
    }

    /* Modal d'ajout d'avis */
    #add-review-modal .modal-content {
      background: linear-gradient(145deg, #1a0b2e, #16213e) !important;
      color: white;
      border-radius: 0;
      padding: 0;
      border: none;
      backdrop-filter: blur(20px);
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    .add-review-header {
      background: linear-gradient(135deg, #8ef58e, #6ad66a);
      color: #1a0b2e;
      padding: 20px 30px;
      border-radius: 20px 20px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 15px rgba(142, 245, 142, 0.2);
    }

    .add-review-title {
      font-size: 24px;
      font-weight: 700;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 12px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .title-icon {
      font-size: 28px;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
    }

    .add-review-close {
      background: rgba(26, 11, 46, 0.1);
      color: #1a0b2e;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .add-review-close:hover {
      background: rgba(26, 11, 46, 0.2);
      transform: rotate(90deg) scale(1.1);
    }

    /* Formulaire d'ajout d'avis */
    .add-review-form {
      background: transparent;
      padding: 30px;
      border-radius: 0;
      border: none;
      backdrop-filter: none;
      overflow-y: auto;
      max-height: calc(90vh - 80px);
    }

    .form-row {
      display: flex;
      gap: 1rem;
      align-items: end;
      margin-bottom: 1rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group.half {
      flex: 1;
    }

    .form-group.checkbox-group {
      flex: 0 0 auto;
    }

    .form-group label {
      display: block;
      color: #8ef58e;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .form-group input[type="text"],
    .form-group textarea {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(142, 245, 142, 0.3);
      border-radius: 12px;
      color: white;
      font-size: 14px;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      box-sizing: border-box;
    }

    .form-group input[type="text"]:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #8ef58e;
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 0 20px rgba(142, 245, 142, 0.2);
    }

    .form-group input[type="text"]::placeholder,
    .form-group textarea::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    .required {
      color: #ff6b6b;
      font-weight: 600;
    }

    .form-group input[type="text"],
    .form-group textarea {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(142, 245, 142, 0.3);
      border-radius: 12px;
      color: white;
      font-size: 14px;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .form-group input[type="text"]:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #8ef58e;
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 0 20px rgba(142, 245, 142, 0.2);
    }

    .form-group input[type="text"]::placeholder,
    .form-group textarea::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    .optional {
      color: rgba(255, 255, 255, 0.6);
      font-weight: 400;
      font-size: 12px;
    }

    .required {
      color: #ff6b6b;
      font-weight: 600;
    }

    /* Checkbox personnalisée */
    .checkbox-label {
      display: flex !important;
      align-items: center;
      cursor: pointer;
      user-select: none;
      color: #fff;
      font-size: 14px;
    }

    .checkbox-label input[type="checkbox"] {
      display: none;
    }

    .checkmark {
      width: 20px;
      height: 20px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(142, 245, 142, 0.3);
      border-radius: 4px;
      margin-right: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .checkbox-label input[type="checkbox"]:checked + .checkmark {
      background: linear-gradient(135deg, #8ef58e, #ffd369);
      border-color: #8ef58e;
    }

    .checkbox-label input[type="checkbox"]:checked + .checkmark::after {
      content: '✓';
      color: #1a1a1a;
      font-weight: bold;
      font-size: 14px;
    }

    /* Sélecteur personnalisé */
    .custom-select {
      position: relative;
      display: block;
    }

    .custom-select select {
      width: 100%;
      padding: 12px 40px 12px 16px;
      background: rgba(255, 255, 255, 0.08);
      border: 2px solid rgba(142, 245, 142, 0.2);
      border-radius: 10px;
      color: #fff;
      font-size: 14px;
      appearance: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .custom-select select:focus {
      outline: none;
      border-color: #8ef58e;
      box-shadow: 0 0 15px rgba(142, 245, 142, 0.3);
    }

    .select-arrow {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: #8ef58e;
      pointer-events: none;
      transition: transform 0.3s ease;
    }

    .custom-select:hover .select-arrow {
      transform: translateY(-50%) rotate(180deg);
    }

    /* Groupe rating */
    .rating-group {
      background: rgba(255, 211, 105, 0.1);
      padding: 16px;
      border-radius: 12px;
      border: 1px solid rgba(255, 211, 105, 0.2);
    }

    .rating-text {
      color: #ffd369;
      font-weight: 500;
      margin-left: 10px;
      font-size: 13px;
    }

    .form-group input:not([type="checkbox"]), .form-group textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid rgba(142, 245, 142, 0.2);
      background: rgba(255, 255, 255, 0.08);
      border-radius: 10px;
      color: #fff;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .form-group input:not([type="checkbox"]):focus, .form-group textarea:focus {
      outline: none;
      border-color: #8ef58e;
      box-shadow: 0 0 15px rgba(142, 245, 142, 0.3);
      background: rgba(255, 255, 255, 0.12);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
    }

    .submit-review-btn {
      background: linear-gradient(135deg, #8ef58e, #ffd369);
      color: #1a1a1a;
      border: none;
      padding: 16px 32px;
      border-radius: 12px;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 1rem;
    }

    .submit-review-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(142, 245, 142, 0.4);
    }

    .btn-icon {
      font-size: 18px;
    }

    /* Sélecteur de produit stylisé */
    .product-selector {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .selected-product {
      min-height: 80px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px dashed rgba(142, 245, 142, 0.3);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .selected-product:hover {
      border-color: #8ef58e;
      background: rgba(142, 245, 142, 0.1);
    }

    .selected-product.has-product {
      border-style: solid;
      background: rgba(142, 245, 142, 0.1);
    }

    .product-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      color: rgba(255, 255, 255, 0.6);
    }

    .product-icon {
      font-size: 24px;
      opacity: 0.7;
    }

    .product-text {
      font-size: 14px;
    }

    .product-select-btn {
      background: linear-gradient(135deg, #8ef58e, #ffd369);
      color: #1a1a1a;
      border: none;
      padding: 12px 20px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.3s ease;
    }

    .product-select-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(142, 245, 142, 0.3);
    }

    .btn-arrow {
      font-size: 16px;
      font-weight: bold;
    }

    .required {
      color: #ff6b6b;
      font-weight: 600;
    }

    /* Modal sélection de produit */
    .product-selection-content {
      height: 100%;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .product-selection-card {
      background: linear-gradient(135deg, #6a4c93, #9b59b6, #8e44ad);
      border-radius: 16px;
      padding: 16px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 12px;
      box-shadow: 0 4px 15px rgba(106, 76, 147, 0.2);
      position: relative;
      overflow: hidden;
    }

    .product-selection-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, transparent, rgba(255, 211, 105, 0.1));
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .product-selection-card:hover::before {
      opacity: 1;
    }

    .product-selection-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 35px rgba(106, 76, 147, 0.4);
      border-color: #ffd369;
    }

    .product-selection-card-content {
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      z-index: 1;
      height: 100%;
    }

    .product-selection-title {
      color: #ffffff;
      font-size: 14px;
      margin: 0;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      line-height: 1.2;
    }

    .product-selection-bottom {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: auto;
    }

    .product-selection-image {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      overflow: hidden;
      flex-shrink: 0;
      border: 2px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .product-selection-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .product-selection-right {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
      align-items: flex-end;
      min-width: 0;
      overflow: hidden;
    }

    .product-selection-price {
      color: #ffd369;
      font-size: 13px;
      font-weight: 900;
      margin: 0;
      background: rgba(255, 211, 105, 0.2);
      padding: 4px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255, 211, 105, 0.3);
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
      white-space: nowrap;
      flex-shrink: 0;
    }

    .product-selection-category {
      color: rgba(255, 255, 255, 0.8);
      font-size: 9px;
      margin: 0;
      background: rgba(255, 255, 255, 0.1);
      padding: 3px 6px;
      border-radius: 8px;
      text-align: right;
      white-space: normal;
      word-wrap: break-word;
      max-width: 120px;
      line-height: 1.3;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    /* Produit sélectionné */
    .selected-product-info {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px;
    }

    .selected-product-image {
      width: 50px;
      height: 50px;
      border-radius: 8px;
      object-fit: cover;
    }

    .selected-product-details h4 {
      color: #8ef58e;
      margin: 0 0 4px 0;
      font-size: 14px;
    }

    .selected-product-details p {
      color: #ffd369;
      margin: 0 0 4px 0;
      font-size: 13px;
      font-weight: bold;
    }

    .selected-category {
      color: rgba(255, 255, 255, 0.7);
      font-size: 11px;
      background: rgba(255, 255, 255, 0.1);
      padding: 2px 6px;
      border-radius: 8px;
    }

    /* Upload de médias */
    .media-upload-section {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .media-upload-btn {
      background: linear-gradient(135deg, #6a4c93, #9b59b6);
      color: white;
      border: 2px dashed rgba(255, 255, 255, 0.3);
      padding: 16px 20px;
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .media-upload-btn:hover {
      background: linear-gradient(135deg, #7a5ba3, #ab69c6);
      border-color: #ffd369;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(106, 76, 147, 0.3);
    }

    .upload-icon {
      font-size: 20px;
    }

    .media-preview {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 8px;
      margin-top: 8px;
    }

    .media-preview-item {
      position: relative;
      width: 80px;
      height: 80px;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .media-preview-item img,
    .media-preview-item video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .media-preview-remove {
      position: absolute;
      top: 4px;
      right: 4px;
      background: rgba(255, 107, 107, 0.9);
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Médias dans les avis */
    .review-medias {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 8px;
      margin: 12px 0;
    }

    .review-media-item {
      width: 100%;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.3s ease;
      border: 2px solid rgba(255, 255, 255, 0.1);
    }

    .review-media-item:hover {
      transform: scale(1.05);
      border-color: #8ef58e;
    }

    /* Modale de sélection de médias */
    .media-modal-content {
      max-width: 800px;
      max-height: 90vh;
    }

    .media-selection-tabs {
      display: flex;
      gap: 0;
      margin-bottom: 20px;
      border-radius: 12px;
      overflow: hidden;
      background: rgba(255, 255, 255, 0.1);
    }

    .media-tab.active {
      background: linear-gradient(135deg, #6a4c93, #9b59b6);
      color: white;
      box-shadow: 0 4px 15px rgba(106, 76, 147, 0.3);
    }

    .media-tab:hover:not(.active) {
      background: rgba(255, 255, 255, 0.15);
      color: white;
    }

    .media-selection-content {
      min-height: 400px;
      margin-bottom: 20px;
    }

    .media-tab-content {
      display: none;
    }

    .media-tab-content.active {
      display: block;
    }

    .upload-drop-zone {
      border: 3px dashed rgba(255, 255, 255, 0.3);
      border-radius: 16px;
      padding: 40px 20px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      background: linear-gradient(135deg, rgba(106, 76, 147, 0.1), rgba(155, 89, 182, 0.1));
    }

    .upload-drop-zone:hover,
    .upload-drop-zone.drag-over {
      border-color: #ffd369;
      background: linear-gradient(135deg, rgba(255, 211, 105, 0.1), rgba(106, 76, 147, 0.1));
      transform: translateY(-2px);
    }

    .upload-drop-content h3 {
      color: white;
      margin: 16px 0 8px 0;
      font-size: 18px;
    }

    .upload-drop-content p {
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 20px;
    }

    .upload-drop-icon {
      font-size: 48px;
      display: block;
      margin-bottom: 12px;
    }

    .browse-files-btn {
      background: linear-gradient(135deg, #6a4c93, #9b59b6);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .browse-files-btn:hover {
      background: linear-gradient(135deg, #7a5ba3, #ab69c6);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(106, 76, 147, 0.4);
    }

    .gallery-media-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 12px;
      max-height: 300px;
      overflow-y: auto;
      padding: 8px;
    }

    .gallery-media-item {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .gallery-media-item img,
    .gallery-media-item video {
      width: 100%;
      height: 120px;
      object-fit: cover;
    }

    .gallery-media-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    .gallery-media-item.selected {
      border-color: #ffd369;
      box-shadow: 0 0 20px rgba(255, 211, 105, 0.5);
    }

    .gallery-media-item .selection-indicator {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .gallery-media-item.selected .selection-indicator {
      background: #ffd369;
      color: #000;
      font-weight: bold;
    }

    .selected-media-preview {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 8px;
      margin-top: 16px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      min-height: 60px;
    }

    .selected-media-item {
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid rgba(255, 211, 105, 0.5);
    }

    .selected-media-item img,
    .selected-media-item video {
      width: 100%;
      height: 80px;
      object-fit: cover;
    }

    .selected-media-item .remove-selected {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(255, 107, 107, 0.9);
      color: white;
      border: none;
      cursor: pointer;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .media-selection-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .selected-count {
      color: rgba(255, 255, 255, 0.8);
      font-weight: 500;
    }

    .media-selection-actions {
      display: flex;
      gap: 12px;
    }

    .cancel-selection-btn {
      background: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 10px 20px;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .cancel-selection-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }

    .validate-selection-btn {
      background: linear-gradient(135deg, #8ef58e, #4CAF50);
      color: #000;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }

    .validate-selection-btn:hover {
      background: linear-gradient(135deg, #7de67d, #45a045);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
    }

    .validate-selection-btn:disabled {
      background: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.5);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Upload de médias */
    .media-upload-section {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .media-upload-btn {
      background: linear-gradient(135deg, #6a4c93, #9b59b6);
      color: white;
      border: 2px dashed rgba(255, 255, 255, 0.3);
      padding: 16px 20px;
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .media-upload-btn:hover {
      background: linear-gradient(135deg, #7a5ba3, #ab69c6);
      border-color: #ffd369;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(106, 76, 147, 0.3);
    }

    .upload-icon {
      font-size: 20px;
    }

    .media-preview {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 8px;
      margin-top: 8px;
    }

    .media-preview-item {
      position: relative;
      width: 80px;
      height: 80px;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .media-preview-item img,
    .media-preview-item video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .media-preview-remove {
      position: absolute;
      top: 4px;
      right: 4px;
      background: rgba(255, 107, 107, 0.9);
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .rating-star:hover,
    .rating-star.active {
      color: #ffd369;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-family: inherit;
    }

    .form-group input::placeholder,
    .form-group textarea::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    .rating-input {
      display: flex;
      gap: 4px;
      margin-bottom: 1rem;
    }

    .rating-star {
      font-size: 2em;
      color: rgba(255, 211, 105, 0.3);
      cursor: pointer;
      transition: color 0.2s;
    }

    .rating-star.active,
    .rating-star:hover {
      color: #ffd369;
    }

    .submit-review-btn {
      background: #8ef58e;
      color: #2e003e;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      font-size: 1em;
      transition: all 0.3s;
      width: 100%;
    }

    .submit-review-btn:hover {
      background: #7ae67a;
      transform: translateY(-2px);
    }

    /* Catégories: styles refondus */
    #category-modal.show {
      position: fixed;
      top: 0;
      left: 0;
      width: 360px;
      max-width: 100vw;
      height: 100vh;
      z-index: 1000;
      display: block;
      background: linear-gradient(to bottom right, #2e003e, #6a0572);
      box-shadow: 2px 0 12px rgba(0,0,0,0.4);
      border-right: 2px solid rgba(255, 211, 105, 0.3);
      animation: slideInLeft 0.25s ease-out;
    }

    @keyframes slideInLeft {
      from { transform: translateX(-100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    #category-modal .modal-content { 
      padding: 18px; 
      background: linear-gradient(135deg, #2e003e, #6a0572); 
      color: white;
    }
    #category-modal .modal-header { border-bottom: 1px solid rgba(255, 211, 105, 0.2); padding-bottom: 10px; margin-bottom: 12px; }
    #category-modal .modal-title { font-size: 1.1rem; }
    #category-modal .close-btn { width: 30px; height: 30px; }

    .cat-breadcrumbs { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 10px; }
    .cat-crumb { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); color:#ffd369; padding: 6px 10px; border-radius: 14px; cursor: pointer; font-size: 12px; }
    .cat-crumb.active { background: rgba(142,245,142,0.15); color:#8ef58e; border-color: rgba(142,245,142,0.3); }
    .cat-sep { color: rgba(255,255,255,0.5); align-self:center; }

  /* Liste catégories avec scroll interne, modal fixe */
  .cat-list { list-style: none; padding: 0; margin: 0; overflow-y:auto; overflow-x:hidden; }
    .cat-item { display:flex; align-items:center; justify-content:space-between; gap:8px; padding:10px 8px; border-bottom: 1px solid rgba(255,255,255,0.08); }
    .cat-name { display:flex; align-items:center; gap:8px; color:#fff; font-weight:600; }
    .cat-children-count { color:#8ef58e; font-size: 12px; opacity:0.8; }
    .cat-actions { display:flex; gap:6px; }
    .cat-btn { background:#4b1a7f; color:#8ef58e; border:1px solid rgba(255,255,255,0.2); border-radius:6px; padding:6px 10px; cursor:pointer; font-size:12px; }
    .cat-btn.select { background:#8ef58e; color:#2e003e; border:none; }
    .cat-btn:hover { filter: brightness(1.1); }

    #category-modal .modal-title {
      color: #ffd369;
      font-size: 1.3em;
      font-weight: 600;
      margin: 0;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }

    #category-modal .close-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 211, 105, 0.3);
      color: #ffd369;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      font-size: 20px;
      transition: all 0.3s ease;
    }

    #category-modal .close-btn:hover {
      background: rgba(255, 211, 105, 0.2);
      color: #fff;
      transform: scale(1.1);
    }

    #category-modal .category-modal {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 15px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    #category-modal .category-tree {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #category-modal .category-item {
      list-style: none;
      margin: 0;
    }

    #category-modal .category-row {
      display: flex;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.2s ease;
      border-radius: 6px;
      margin: 2px 0;
    }

    #category-modal .category-row:hover {
      background: rgba(255, 211, 105, 0.1);
      padding-left: 8px;
      box-shadow: 0 2px 8px rgba(255, 211, 105, 0.1);
    }

    #category-modal .category-children {
      list-style: none;
      padding: 0;
      margin: 0;
      overflow: hidden;
      transition: all 0.3s ease;
      border-left: 2px solid rgba(142, 245, 142, 0.2);
      margin-left: 15px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 0 8px 8px 0;
    }

    #category-modal .category-arrow {
      background: rgba(142, 245, 142, 0.1);
      border: 1px solid rgba(142, 245, 142, 0.3);
      color: #8ef58e;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      margin-right: 8px;
      font-size: 10px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #category-modal .category-arrow:hover {
      background: rgba(142, 245, 142, 0.2);
      transform: scale(1.1);
      box-shadow: 0 2px 6px rgba(142, 245, 142, 0.2);
    }

    #category-modal .category-name-btn {
      color: #fff;
      font-weight: 500;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 0.95em;
      padding: 8px 12px;
      flex: 1;
      text-align: left;
      background: none;
      border: none;
      cursor: pointer;
    }

    #category-modal .category-name-btn:hover {
      background: rgba(255, 211, 105, 0.15);
      color: #ffd369;
      transform: translateX(3px);
    }

    /* Indentation progressive pour les niveaux profonds */
    #category-modal .category-item[data-level="0"] .category-name-btn {
      font-weight: 600;
      font-size: 1em;
    }

    #category-modal .category-item[data-level="1"] .category-name-btn {
      font-size: 0.95em;
      color: rgba(255, 255, 255, 0.9);
    }

    #category-modal .category-item[data-level="2"] .category-name-btn {
      font-size: 0.9em;
      color: rgba(255, 255, 255, 0.8);
    }

    #category-modal .category-item[data-level="3"] .category-name-btn {
      font-size: 0.85em;
      color: rgba(255, 255, 255, 0.7);
    }

    /* Animation de fermeture */
    #category-modal.hide {
      animation: slideOutLeft 0.3s ease-in forwards;
    }

    @keyframes slideOutLeft {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(-100%);
        opacity: 0;
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ====== STYLES CARTES AVIS CLIENTS ====== */
    .review-card {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border-radius: 16px;
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .review-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #ffd369, #8ef58e);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .review-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(255, 211, 105, 0.2);
      border-color: rgba(255, 211, 105, 0.3);
    }

    .review-card:hover::before {
      opacity: 1;
    }

    .review-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .review-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: linear-gradient(135deg, #8ef58e, #ffd369);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #2e003e;
      font-weight: bold;
      margin-right: 12px;
      box-shadow: 0 4px 12px rgba(142, 245, 142, 0.3);
    }

    .review-info {
      flex: 1;
    }

    .review-username {
      color: #ffd369;
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 4px 0;
    }

    .review-date {
      color: rgba(255, 255, 255, 0.7);
      font-size: 12px;
      margin: 0;
    }

    .review-verified {
      background: linear-gradient(135deg, #8ef58e, #4caf50);
      color: #2e003e;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: bold;
      text-transform: uppercase;
      box-shadow: 0 2px 6px rgba(142, 245, 142, 0.3);
    }

    .review-title {
      color: #fff;
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 12px 0;
      line-height: 1.3;
    }

    .review-content {
      background: rgba(255, 255, 255, 0.08);
      border-left: 3px solid #ffd369;
      padding: 12px 15px;
      border-radius: 0 8px 8px 0;
      margin: 15px 0;
      position: relative;
    }

    .review-content::before {
      content: '"';
      position: absolute;
      top: -5px;
      left: 8px;
      font-size: 30px;
      color: #ffd369;
      opacity: 0.6;
    }

    .review-text {
      color: rgba(255, 255, 255, 0.9);
      font-style: italic;
      line-height: 1.5;
      margin: 0;
      font-size: 14px;
    }

    .review-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
    }

    .review-rating {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .review-stars {
      color: #ffd369;
      font-size: 16px;
      text-shadow: 0 2px 4px rgba(255, 211, 105, 0.3);
    }

    .review-rating-text {
      color: rgba(255, 255, 255, 0.8);
      font-size: 12px;
      font-weight: 500;
    }

    .review-product {
      background: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.8);
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 11px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Responsive pour les avis */
    @media (max-width: 768px) {
      .review-card {
        padding: 15px;
      }
      
      .review-avatar {
        width: 40px;
        height: 40px;
        font-size: 16px;
      }
      
      .review-title {
        font-size: 16px;
      }
    }

    /* ====== STYLES CARTES AVIS COMPACTES ====== */
    .review-card-compact {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      border-radius: 12px;
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .review-card-compact::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #ffd369, #8ef58e);
      opacity: 0;
      transition: opacity 0.3s ease;
      border-radius: 12px 12px 0 0;
    }

    .review-card-compact:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(255, 211, 105, 0.15);
      border-color: rgba(255, 211, 105, 0.3);
    }

    .review-card-compact:hover::before {
      opacity: 1;
    }

    .review-rating-compact {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 8px;
    }

    .review-stars-compact {
      color: #ffd369;
      font-size: 16px;
      text-shadow: 0 1px 3px rgba(255, 211, 105, 0.3);
    }

    .review-rating-text-compact {
      color: rgba(255, 255, 255, 0.7);
      font-size: 12px;
      font-weight: 500;
    }

    .review-title-compact {
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 8px 0;
      line-height: 1.3;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .review-footer-compact {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto;
    }

    .review-user-compact {
      color: #8ef58e;
      font-size: 13px;
      font-weight: 500;
    }

    .review-date-compact {
      color: rgba(255, 255, 255, 0.6);
      font-size: 11px;
    }

    /* Modal détails avis */
    #review-detail-modal .modal-content {
      background: linear-gradient(135deg, 
        #1a0024 0%,
        #2d0040 25%, 
        #4b1a7f 50%,
        #8b2f97 75%,
        #c5447a 100%) !important;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(15px);
      border-radius: 0 !important;
      height: 100% !important;
      position: relative;
      overflow: hidden;
    }
    
    /* ::before supprimé pour éviter de cacher les coins */

    .review-detail-content {
      max-height: 70vh;
      overflow-y: auto;
      position: relative;
      z-index: 1;
    }

    .review-detail-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding: 20px;
      background: linear-gradient(135deg, 
        rgba(197, 68, 122, 0.12) 0%,
        rgba(139, 47, 151, 0.08) 50%,
        rgba(197, 68, 122, 0.04) 100%);
      border-radius: 15px;
      border: 1px solid rgba(197, 68, 122, 0.25);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }
    
    /* .review-detail-header::before supprimé pour éviter les problèmes de coins */

    .review-detail-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, 
        #c5447a 0%,
        #8b2f97 40%, 
        #4b1a7f 70%,
        #2d0040 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      color: #fff;
      font-weight: bold;
      margin-right: 20px;
      box-shadow: 0 8px 25px rgba(197, 68, 122, 0.35),
                  0 0 0 3px rgba(197, 68, 122, 0.2),
                  inset 0 2px 4px rgba(255, 255, 255, 0.15);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
      position: relative;
      transition: all 0.3s ease;
    }
    
    .review-detail-avatar::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, #c5447a, #8b2f97, #4b1a7f, #2d0040);
      border-radius: 50%;
      z-index: -1;
      animation: rotateGradient 3s linear infinite;
    }
    
    @keyframes rotateGradient {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .review-detail-info {
      flex: 1;
    }

    .review-detail-username {
      color: #ffd369;
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 5px 0;
    }

    .review-detail-date {
      color: rgba(255, 255, 255, 0.7);
      font-size: 14px;
      margin: 0;
    }

    .review-detail-rating {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 15px 0;
    }

    .review-detail-title {
      color: #fff;
      font-size: 22px;
      font-weight: 700;
      margin: 20px 0;
      text-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
      background: linear-gradient(135deg, #fff, #ff6b6b, #ffd369);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
    }

    .review-detail-description {
      background: linear-gradient(135deg, 
        rgba(197, 68, 122, 0.1) 0%,
        rgba(139, 47, 151, 0.06) 50%,
        rgba(75, 26, 127, 0.08) 100%);
      border-left: 4px solid #c5447a;
      border-radius: 0 15px 15px 0;
      padding: 20px 25px;
      margin: 25px 0;
      position: relative;
      backdrop-filter: blur(5px);
      box-shadow: 0 8px 20px rgba(197, 68, 122, 0.08),
                  inset 0 1px 0 rgba(255, 255, 255, 0.08);
    }

    /* .review-detail-description::before supprimé pour éviter les problèmes de coins */
    
    .review-detail-description::after {
      content: '"';
      position: absolute;
      bottom: -15px;
      right: 20px;
      font-size: 45px;
      color: #c5447a;
      opacity: 0.6;
      text-shadow: 0 2px 4px rgba(197, 68, 122, 0.25);
      font-family: 'Times New Roman', serif;
    }

    .review-detail-description p {
      color: rgba(255, 255, 255, 0.9);
      line-height: 1.6;
      margin: 0;
      font-size: 16px;
    }

    .review-detail-product {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px 15px;
      border-radius: 8px;
      margin: 15px 0;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .review-detail-product strong {
      color: #8ef58e;
    }

    .review-images-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .review-images-grid img {
      width: 100%;
      height: auto;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .review-images-grid img:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    /* Améliorations visuelles pour la modal avis */
    @keyframes modalSlideIn {
      0% { 
        opacity: 0; 
        transform: translateY(-30px) scale(0.9); 
      }
      100% { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
      }
    }
    
    #review-detail-modal.show .modal-content {
      animation: modalSlideIn 0.4s ease-out;
    }
    
    @keyframes starGlow {
      0% { 
        filter: drop-shadow(0 0 8px rgba(255, 211, 105, 0.6));
        transform: scale(1);
      }
      100% { 
        filter: drop-shadow(0 0 15px rgba(255, 211, 105, 0.8));
        transform: scale(1.05);
      }
    }
    
    .review-detail-rating .review-stars {
      font-size: 28px;
      color: #ffd369;
      animation: starGlow 2s ease-in-out infinite alternate;
    }
    
    @keyframes verifiedPulse {
      0% { 
        box-shadow: 0 4px 15px rgba(6, 214, 160, 0.4);
        transform: scale(1);
      }
      100% { 
        box-shadow: 0 6px 20px rgba(6, 214, 160, 0.6);
        transform: scale(1.02);
      }
    }
    
    /* Styles pour s'assurer que les médias ne débordent jamais des modales */
    .modal .main-image-container {
      max-width: 100% !important;
      overflow: hidden !important;
      text-align: center !important;
    }
    
    .modal .main-image, .modal #review-main-media, .modal #admin-review-main-media {
      max-width: 100% !important;
      height: auto !important;
      object-fit: contain !important;
      border-radius: 8px !important;
    }
    
    /* Styles pour les miniatures */
    .modal .thumbnail {
      max-width: 60px !important;
      max-height: 60px !important;
      object-fit: cover !important;
      border-radius: 4px !important;
    }
    
    .review-verified {
      background: linear-gradient(135deg, #06d6a0 0%, #118ab2 50%, #073b4c 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.5px;
      border: 1px solid rgba(6, 214, 160, 0.5);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      animation: verifiedPulse 2s ease-in-out infinite alternate;
    }

    /* Modal détail avis */
    .review-detail-content {
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      padding: 20px 0;
    }

    .review-detail-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(142, 245, 142, 0.2);
    }

    .review-detail-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ffd369, #8ef58e);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 18px;
      color: #1a1a1a;
      margin-right: 15px;
      flex-shrink: 0;
    }

    .review-detail-info {
      flex: 1;
    }

    .review-detail-username {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: #8ef58e;
    }

    .review-detail-date {
      margin: 2px 0 0 0;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.7);
    }

    .review-verified {
      background: linear-gradient(135deg, #8ef58e, #ffd369);
      color: #1a1a1a;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .review-detail-rating {
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .review-detail-rating .review-stars {
      font-size: 20px;
      color: #ffd369;
    }

    .review-detail-rating .review-rating-text {
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
    }

    .review-detail-title {
      color: #8ef58e;
      font-size: 20px;
      margin: 0 0 15px 0;
      font-weight: 600;
    }

    .review-detail-description {
      color: rgba(255, 255, 255, 0.9);
      line-height: 1.6;
      margin-bottom: 20px;
      font-size: 15px;
    }

    .review-detail-product {
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 20px;
      padding: 10px 15px;
      background: rgba(255, 211, 105, 0.1);
      border-radius: 8px;
      border-left: 3px solid #ffd369;
    }

    .review-detail-images h4 {
      color: #8ef58e;
      margin: 15px 0 10px 0;
      font-size: 16px;
    }

    .review-images-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .review-images-grid img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      border: 2px solid transparent;
    }

    .review-images-grid img:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 25px rgba(142, 245, 142, 0.3);
      border-color: #8ef58e;
    }

    @media (max-width: 768px) {
      .review-card-compact {
        padding: 12px;
        min-height: 100px;
      }
      
      .review-title-compact {
        font-size: 14px;
      }

      /* Responsive pour page infos */
      .infos-canvas-responsive > div {
        position: relative !important;
        left: auto !important;
        top: auto !important;
        width: 100% !important;
        max-width: 100% !important;
        margin-bottom: 20px !important;
      }

      /* Responsive pour modal avis */
      .review-detail-content {
        max-height: 90vh;
        padding: 15px 0;
      }
      
      .review-detail-avatar {
        width: 40px;
        height: 40px;
        font-size: 16px;
      }
      
      .review-detail-username {
        font-size: 16px;
      }
      
      .review-detail-title {
        font-size: 18px;
      }
      
      .review-images-grid {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      }
      
      .review-images-grid img {
        height: 100px;
      }
    }

    /* Scrollbars stylisées - pratiquement invisibles */
    ::-webkit-scrollbar {
      width: 4px;
      height: 4px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255, 211, 105, 0.2);
      border-radius: 2px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 211, 105, 0.4);
    }

    ::-webkit-scrollbar-corner {
      background: transparent;
    }

    /* Pour Firefox */
    * {
      scrollbar-width: thin;
      scrollbar-color: rgba(255, 211, 105, 0.2) transparent;
    }

    /* Styles améliorés pour les cartes d'arnaques */
    #products-grid-arnaques .product-card {
      position: relative;
      background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(255, 107, 107, 0.05));
      border: 2px solid rgba(255, 107, 107, 0.3);
      border-radius: 12px;
      transition: all 0.3s ease;
      overflow: hidden;
    }

    #products-grid-arnaques .product-card:hover {
      border-color: rgba(255, 107, 107, 0.6);
      box-shadow: 0 8px 25px rgba(255, 107, 107, 0.2);
      transform: translateY(-2px);
    }



    #products-grid-arnaques .product-card img {
      filter: saturate(0.8) contrast(1.1);
      transition: filter 0.3s ease;
    }

    #products-grid-arnaques .product-card:hover img {
      filter: saturate(1) contrast(1.2);
    }

    /* Modal arnaqueur stylisée */
    #arnaqueur-modal .modal-content {
      background: linear-gradient(135deg, #2e003e, #1a0026) !important;
      border: none;
      border-radius: 0 !important;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
      height: 100% !important;
    }

    #arnaqueur-modal .modal-content h2 {
      color: #ff6b6b;
      text-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
      border-bottom: 2px solid rgba(255, 107, 107, 0.3);
      padding-bottom: 12px;
      margin-bottom: 20px;
    }

    #arnaqueur-modal .modal-content p {
      background: rgba(255, 107, 107, 0.1);
      border-left: 4px solid #ff6b6b;
      padding: 12px 16px;
      border-radius: 8px;
      margin: 10px 0;
    }

    #arnaqueur-modal .modal-content strong {
      color: #ffd369;
      text-shadow: 0 1px 3px rgba(255, 211, 105, 0.3);
    }

    #arnaqueur-gallery img {
      border: 2px solid rgba(255, 107, 107, 0.3);
      border-radius: 8px;
      transition: all 0.3s ease;
      filter: saturate(0.9);
    }

    #arnaqueur-gallery img:hover {
      border-color: rgba(255, 107, 107, 0.8);
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
      filter: saturate(1.1);
      transform: scale(1.02);
    }

    /* Badge ARNAQUEUR stylisé */
    .product-status {
      background: linear-gradient(45deg, #ff6b6b, #e55555) !important;
      box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      animation: pulse-warning 2s infinite;
    }

    @keyframes pulse-warning {
      0%, 100% { box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4); }
      50% { box-shadow: 0 4px 15px rgba(255, 107, 107, 0.7); }
    }

    /* Icônes réseaux dans la modal */
    #arnaqueur-reseaux img {
      border-radius: 4px;
      transition: transform 0.2s ease;
    }

    #arnaqueur-reseaux img:hover {
      transform: scale(1.1);
    }

    /* Modal de filtre stylisée */
    #filter-modal .modal-content {
      background: linear-gradient(135deg, #2e004f 0%, #4b1a7f 70%, #3a0f5a 100%) !important;
      border: none;
      border-radius: 0 !important;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
      padding: 0;
      overflow: hidden;
      backdrop-filter: blur(8px);
    }

    #filter-modal .modal-header {
      background: linear-gradient(135deg, #4b1a7f 0%, #6a2a9f 50%, #5a247f 100%);
      color: #ffd369;
      padding: 20px 25px;
      margin: 0;
      font-weight: 600;
      border-bottom: 1px solid rgba(255, 211, 105, 0.2);
    }

    #filter-modal .modal-title {
      margin: 0;
      font-size: 1.3em;
      font-weight: 700;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    #filter-modal .close-btn {
      background: rgba(255, 211, 105, 0.2);
      color: #ffd369;
      border: none;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #filter-modal .close-btn:hover {
      background: rgba(255, 211, 105, 0.3);
      transform: rotate(90deg);
    }

    #filter-content {
      padding: 25px;
    }

    #filter-content .form-group {
      margin-bottom: 20px;
    }

    #filter-content label {
      display: block;
      color: #ffd369;
      font-weight: 500;
      margin-bottom: 8px;
      font-size: 1em;
    }

    #filter-content input[type="number"] {
      width: 100%;
      padding: 12px 15px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(142, 245, 142, 0.25);
      border-radius: 10px;
      color: #ffffff;
      font-size: 16px;
      transition: all 0.3s ease;
      backdrop-filter: blur(3px);
      box-sizing: border-box;
    }

    #filter-content input[type="number"]:focus {
      outline: none;
      border-color: rgba(142, 245, 142, 0.5);
      background: rgba(255, 255, 255, 0.12);
      box-shadow: 0 0 12px rgba(142, 245, 142, 0.25);
    }

    #filter-content input[type="number"]::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    #apply-filters {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #7de57d 0%, #8ef58e 50%, #6dd46d 100%);
      color: #2e004f;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 12px rgba(142, 245, 142, 0.25);
    }

    #apply-filters:hover {
      background: linear-gradient(135deg, #6dd46d 0%, #7de57d 50%, #5cc35c 100%);
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(142, 245, 142, 0.35);
    }

    #apply-filters:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(142, 245, 142, 0.3);
    }

    #filter-modal .icon-white {
      filter: invert(0.2) sepia(1) saturate(5) hue-rotate(240deg);
    }

    /* Taille des icônes dans les boutons */
    button img.icon-white,
    button img[src*="icon/"] {
      min-width: 18px !important;
      min-height: 18px !important;
    }

    /* Bouton Commander Snapchat */
    #commander-btn:hover {
      background: linear-gradient(135deg, #7de57d, #5cc55c);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(142, 245, 142, 0.5);
    }

    #commander-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 10px rgba(142, 245, 142, 0.4);
    }
  </style>
</head>
<body>
  <!-- Top Banner Style Amazon -->
  <div class="top-banner">
    <div class="banner-left">
      <div class="banner-logo">
        <img src="img/_technique/icon/panier.png" alt="Panier" class="icon-white" style="width: 20px; height: 20px;">
        J'vend tout
      </div>
    </div>
    
    <div class="banner-nav">
      <button id="banner-articles" data-tooltip="Une partie des articles que je vends"><img src="img/_technique/icon/panier.png" alt="Articles" class="icon-white"> <span>Articles</span></button>
      <button id="banner-offres" data-tooltip="Des articles vendus par d'autres personnes"><img src="img/_technique/icon/offres.png" alt="Offres" class="icon-white"> <span>Offres</span></button>
      <button id="banner-arnaques" data-tooltip="Des comptes d'arnaques vérifiés"><img src="img/_technique/icon/arnaque.png" alt="Arnaques" class="icon-white"> <span>Arnaques</span></button>
      <button id="banner-Avis" data-tooltip="Avis et autres Avis de la qualité de mes services"><img src="img/_technique/icon/preuve.png" alt="Avis" class="icon-white"> <span>Avis</span></button>
      <button id="banner-annonces" data-tooltip="Des messages que je dois vous adresser"><img src="img/_technique/icon/annonce.png" alt="Annonces" class="icon-white"> <span>Annonces</span></button>
      <button id="banner-infos" data-tooltip="Informations et aide" style="background:#17a2b8;"><img src="img/_technique/icon/information.png" style="width:20px;height:20px;"/></button>
    </div>
  </div>

  <!-- Menu hamburger (caché) -->
  <div class="hamburger" id="hamburger">
    <span></span>
    <span></span>
    <span></span>
  </div>

  <!-- Menu latéral (caché) -->
  <div class="sidebar" id="sidebar">
    <button id="menu-articles"><img src="img/_technique/icon/panier.png" alt="Articles" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Articles</button>
    <button id="menu-offres"><img src="img/_technique/icon/offres.png" alt="Offres" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Offres</button>
    <button id="menu-arnaques"><img src="img/_technique/icon/arnaque.png" alt="Arnaques" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Arnaques</button>
    <button id="menu-Avis"><img src="img/_technique/icon/preuve.png" alt="Avis" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Avis</button>
  <button id="menu-annonces"><img src="img/_technique/icon/annonce.png" alt="Annonces" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Annonces</button>
  </div>

  <div class="container">
    <!-- Menu horizontal (caché maintenant) -->
    <div class="menu-horizontal" id="menu-horizontal" style="display: none;">
      <button id="menu-articles-desktop"><img src="img/_technique/icon/panier.png" alt="Articles" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Articles</button>
      <button id="menu-offres-desktop"><img src="img/_technique/icon/offres.png" alt="Offres" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Offres</button>
      <button id="menu-arnaques-desktop"><img src="img/_technique/icon/arnaque.png" alt="Arnaques" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Arnaques</button>
      <button id="menu-Avis-desktop"><img src="img/_technique/icon/preuve.png" alt="Avis" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Avis</button>
  <button id="menu-annonces-desktop"><img src="img/_technique/icon/annonce.png" alt="Annonces" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Annonces</button>
    </div>

    <div class="main-content">
      <!-- Section Articles -->
      <div class="content-section active" id="articles-section">
        <div class="controls">
          <div class="search-container">
            <span class="search-icon"><img src="img/_technique/icon/loupe.png" alt="Rechercher" class="icon-white" style="width: 16px; height: 16px;"></span>
            <input type="text" id="search-input" placeholder="Rechercher un article...">
          </div>
          <div class="mobile-menu-wrapper">
            <button class="mobile-menu-toggle" type="button" aria-expanded="false" aria-controls="mobile-menu-panel-articles">
              ☰ <span>Menu</span>
            </button>
            <div class="mobile-menu-panel" id="mobile-menu-panel-articles" role="menu" aria-label="Actions Articles"></div>
          </div>
          <button class="control-btn" id="category-button">
            <img src="img/_technique/icon/categorie.png" alt="Catégories" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Catégories
          </button>
          <div class="sort-dropdown">
            <button class="control-btn" id="sort-button">
              <img src="img/_technique/icon/trier.png" alt="Trier" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Trier <span class="dropdown-arrow">▼</span>
            </button>
            <div class="sort-options" id="sort-options-articles">
              <div class="sort-option active" data-sort="relevance">🎯 Pertinence</div>
              <div class="sort-option" data-sort="name-asc"><img src="img/_technique/icon/trie_AZ.png" alt="Nom ↓" class="icon-white" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 5px;"> Nom ↓</div>
              <div class="sort-option" data-sort="name-desc"><img src="img/_technique/icon/trie_ZA.png" alt="Nom ↑" class="icon-white" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 5px;"> Nom ↑</div>
              <div class="sort-option" data-sort="price-asc">💰 Prix ↑</div>
              <div class="sort-option" data-sort="price-desc">💰 Prix ↓</div>
            </div>
          </div>
          <button class="control-btn" id="filter-button">
            <img src="img/_technique/icon/filtre.png" alt="Filtres" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Filtres
          </button>
          <button class="control-btn" id="cart-button" style="display: flex; flex-direction: column; align-items: center; padding: 8px 12px; background: none; border: none; color: white; cursor: pointer;">
            <div style="position: relative; display: flex; align-items: center; margin-bottom: 4px;">
              <img src="img/_technique/icon/panier.png" alt="Panier" class="icon-white" style="width: 20px; height: 20px;">
              <span id="cart-count" style="margin-left: 4px; color: white; font-size: 14px; font-weight: normal;">0</span>
            </div>
            <span style="font-size: 12px; color: white;">Panier</span>
            <span id="cart-label" style="font-size: 11px; color: rgba(255,255,255,0.8); margin-top: 2px; display: none;"><span id="cart-total">0</span> €</span>
          </button>
        </div>
        <div class="products-grid" id="products-grid">
          <!-- Les produits seront chargés ici -->
        </div>
      </div>

      <!-- Section Offres -->
      <div class="content-section" id="offres-section">
        <div class="controls">
          <div class="search-container">
            <span class="search-icon"><img src="img/_technique/icon/loupe.png" alt="Rechercher" class="icon-white" style="width: 16px; height: 16px;"></span>
            <input type="text" id="search-input" placeholder="Rechercher une offre...">
          </div>
          <div class="mobile-menu-wrapper">
            <button class="mobile-menu-toggle" type="button" aria-expanded="false" aria-controls="mobile-menu-panel-offres">
              ☰ <span>Menu</span>
            </button>
            <div class="mobile-menu-panel" id="mobile-menu-panel-offres" role="menu" aria-label="Actions Offres"></div>
          </div>
          <div class="sort-dropdown">
            <button class="control-btn" id="sort-button-offres">
              <img src="img/_technique/icon/trier.png" alt="Trier" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Trier <span class="dropdown-arrow">▼</span>
            </button>
            <div class="sort-options" id="sort-options-offres">
              <div class="sort-option active" data-sort="recent">📅 Récent</div>
              <div class="sort-option" data-sort="name-asc"><img src="img/_technique/icon/trie_AZ.png" alt="Nom ↓" class="icon-white" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 5px;"> Nom ↓</div>
              <div class="sort-option" data-sort="name-desc"><img src="img/_technique/icon/trie_ZA.png" alt="Nom ↑" class="icon-white" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 5px;"> Nom ↑</div>
              <div class="sort-option" data-sort="price-asc">💰 Prix ↑</div>
              <div class="sort-option" data-sort="price-desc">💰 Prix ↓</div>
              <div class="sort-option" data-sort="date-old">📅 Ancien</div>
            </div>
          </div>
          <button class="control-btn" id="category-button-offres">
            <img src="img/_technique/icon/categorie.png" alt="Catégories" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Catégories
          </button>
          <button class="control-btn" id="filter-button-offres">
            <img src="img/_technique/icon/filtre.png" alt="Filtres" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Filtres
          </button>
        </div>
        <div class="products-grid" id="products-grid-offres">
          <!-- Les offres seront chargées ici -->
        </div>
      </div>

      <!-- Section Annonces -->
      <div class="content-section" id="annonces-section">
        <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:14px;margin-bottom:18px;">
          <h2 style="margin:0;font-size:1.4rem;display:flex;align-items:center;gap:8px;">📢 <span>Annonces & Actualités</span></h2>
          <div id="annonces-refresh" style="cursor:pointer;font-size:0.8em;background:#4b1a7f;padding:6px 12px;border-radius:8px;">🔄 Actualiser</div>
        </div>
        <div id="annonces-pinned" style="display:none;margin-bottom:25px;"></div>
        <div id="annonces-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:18px;"></div>
        <div id="annonces-empty" style="display:none;text-align:center;opacity:.7;padding:40px;">Aucune annonce publiée pour le moment.</div>
      </div>

      <!-- Section Infos -->
      <div class="content-section" id="infos-section">
        <!-- Bouton pour afficher le sommaire -->
        <div style="margin-bottom:20px;text-align:center;">
          <button id="toggle-sommaire-btn" style="display:none;background:linear-gradient(135deg, #ffd369, #ffb347);color:#2e003e;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;font-weight:700;font-size:1em;box-shadow:0 4px 12px rgba(255,211,105,0.3);transition:all 0.3s;">
            📋 Afficher le sommaire
          </button>
        </div>
        
        <!-- Modal Sommaire -->
        <div id="sommaire-modal" class="modal" style="display:none;">
          <div class="modal-content" style="max-width:600px;width:90%;max-height:80vh;background:linear-gradient(135deg, #2e003e, #6a0572);border-radius:16px;padding:0;overflow:hidden;">
            <div style="background:linear-gradient(135deg, #ffd369, #ffb347);padding:20px;display:flex;justify-content:space-between;align-items:center;">
              <h3 style="margin:0;color:#2e003e;font-size:1.3em;">📋 Sommaire</h3>
              <button onclick="document.getElementById('sommaire-modal').classList.remove('show')" style="background:none;border:none;color:#2e003e;font-size:2em;cursor:pointer;width:40px;height:40px;">×</button>
            </div>
            <div id="sommaire-content" style="padding:20px;overflow-y:auto;max-height:calc(80vh - 80px);color:#fff;">
              <!-- Le sommaire sera généré ici -->
            </div>
          </div>
        </div>
        
        <div id="infos-content" style="position:relative;min-height:400px;">
          <!-- Le contenu personnalisé sera chargé ici -->
        </div>
      </div>

      <!-- Section Arnaques -->
      <div class="content-section" id="arnaques-section">
        <div class="controls">
          <div class="search-container">
            <span class="search-icon"><img src="img/_technique/icon/loupe.png" alt="Rechercher" class="icon-white" style="width: 16px; height: 16px;"></span>
            <input type="text" id="search-input" placeholder="Rechercher un arnaqueur...">
          </div>
          <div class="mobile-menu-wrapper">
            <button class="mobile-menu-toggle" type="button" aria-expanded="false" aria-controls="mobile-menu-panel-arnaques">
              ☰ <span>Menu</span>
            </button>
            <div class="mobile-menu-panel" id="mobile-menu-panel-arnaques" role="menu" aria-label="Actions Arnaques"></div>
          </div>
          <div class="sort-dropdown">
            <button class="control-btn" id="sort-button-arnaques">
              <img src="img/_technique/icon/trier.png" alt="Trier" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Trier <span class="dropdown-arrow">▼</span>
            </button>
            <div class="sort-options" id="sort-options-arnaques">
              <div class="sort-option active" data-sort="recent">📅 Récent</div>
              <div class="sort-option" data-sort="name-asc"><img src="img/_technique/icon/trie_AZ.png" alt="Nom ↓" class="icon-white" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 5px;"> Nom ↓</div>
              <div class="sort-option" data-sort="name-desc"><img src="img/_technique/icon/trie_ZA.png" alt="Nom ↑" class="icon-white" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 5px;"> Nom ↑</div>
              <div class="sort-option" data-sort="date-old">📅 Ancien</div>
            </div>
          </div>
          <button class="control-btn" id="filter-button-arnaques">
            <img src="img/_technique/icon/filtre.png" alt="Filtres" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Filtres
          </button>
        </div>
        
        <!-- Bouton Signaler une arnaque (entre contrôles et techniques) -->
        <div style="margin: 1rem 0;">
          <button id="add-arnaque-btn" class="control-btn" style="background: linear-gradient(135deg, #ff6b6b, #4b1a7f); border: none; color: white; padding: 0.75rem 1.5rem; cursor: pointer; border-radius: 8px; font-size: 1rem; font-weight: 600; box-shadow: 0 4px 8px rgba(255, 107, 107, 0.3); transition: all 0.3s ease; width: 100%;">
            ⚠️ Signaler une arnaque
          </button>
        </div>
        
        <!-- Section Techniques d'arnaques (sous les contrôles) -->
        <div style="margin: 1rem 0; padding: 0.6rem; background: rgba(255, 107, 107, 0.08); border-radius: 8px; border: 1px solid rgba(255, 107, 107, 0.2);">
          <div style="color: #ff6b6b; font-size: 0.85rem; font-weight: 600; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 6px;">
            🎯 <span>Techniques:</span>
          </div>
          <div id="techniques-arnaques-list" style="display: flex; flex-wrap: wrap; gap: 6px;">
            <!-- Les techniques seront chargées ici -->
          </div>
        </div>
        <div class="products-grid" id="products-grid-arnaques">
          <!-- Les arnaques seront chargées ici -->
        </div>
      </div>

      <!-- Section Avis -->
      <div class="content-section" id="Avis-section">
        <div style="margin-bottom: 2rem;">
          <h2 style="color: #8ef58e; text-align: center;"><img src="img/_technique/icon/preuve.png" alt="Avis" class="icon-white" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;"> Avis de confiance</h2>
          <p style="text-align: center; color: #8ef58e;">Témoignages et Avis de la qualité de mes services</p>
          
          <!-- Compteur d'avis en attente de validation -->
          <div id="pending-admin-notice" class="pending-admin-notice" style="display: none;">
            <span id="pending-count-text"></span>
          </div>
          
          <div style="text-align: center; margin-top: 1rem;">
            <button id="add-review-btn" class="control-btn">
              ➕ Ajouter un avis
            </button>
          </div>
        </div>
        <div class="controls">
          <div class="search-container">
            <span class="search-icon"><img src="img/_technique/icon/loupe.png" alt="Rechercher" class="icon-white" style="width: 16px; height: 16px;"></span>
            <input type="text" id="search-input" placeholder="Rechercher une Avis...">
          </div>
          <div class="mobile-menu-wrapper">
            <button class="mobile-menu-toggle" type="button" aria-expanded="false" aria-controls="mobile-menu-panel-Avis">
              ☰ <span>Menu</span>
            </button>
            <div class="mobile-menu-panel" id="mobile-menu-panel-Avis" role="menu" aria-label="Actions Avis"></div>
          </div>
          <div class="sort-dropdown">
            <button class="control-btn" id="sort-button-Avis">
              <img src="img/_technique/icon/trier.png" alt="Trier" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Trier <span class="dropdown-arrow">▼</span>
            </button>
            <div class="sort-options" id="sort-options-Avis">
              <div class="sort-option active" data-sort="relevance">🎯 Pertinence</div>
              <div class="sort-option" data-sort="name-asc"><img src="img/_technique/icon/trie_AZ.png" alt="Nom ↓" class="icon-white" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 5px;"> Nom ↓</div>
              <div class="sort-option" data-sort="name-desc"><img src="img/_technique/icon/trie_ZA.png" alt="Nom ↑" class="icon-white" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 5px;"> Nom ↑</div>
              <div class="sort-option" data-sort="date-desc">📅 Récent</div>
              <div class="sort-option" data-sort="rating-desc">⭐ Note</div>
            </div>
          </div>
          <button class="control-btn" id="category-button-Avis">
            <img src="img/_technique/icon/categorie.png" alt="Catégories" class="icon-white" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 5px;"> Catégories
          </button>
        </div>
        <div class="products-grid" id="products-grid-Avis">
          <!-- Les Avis seront chargées ici -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal produit -->
  <div class="modal hidden" id="product-modal">
    <div class="modal-content">
      <span class="close">✖</span>
      <h2 id="modal-title"></h2>
      <p id="modal-description"></p>
      <img id="modal-img" style="max-width:100%; display:none;" />
      <video id="modal-video" controls style="max-width:100%; display:none;"></video>
    </div>
  </div>

  <!-- Modal panier -->
  <div class="modal hidden" id="cart-modal">
    <div class="modal-content cart-modal-content">
      <span class="close">✖</span>
      <div class="cart-main-content">
        <h2><img src="img/_technique/icon/panier.png" alt="Panier" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 8px;"> Votre panier</h2>
        <ul id="cart-list"></ul>
        <p style="margin-top: 1rem;"><strong>Total :</strong> <span id="cart-modal-total">0</span> €</p>
      </div>
      <button id="commander-btn" class="cart-commander-btn">
        <span>Commander sur Snapchat</span>
        <img src="img/_technique/icon/Snapchat.png" alt="Snapchat" width="24" height="24">
      </button>
    </div>
  </div>

  <!-- Modal Arnaqueur -->
  <div class="modal hidden" id="arnaqueur-modal">
    <div class="modal-content">
      <span class="close">✖</span>
      <h2 id="arnaqueur-modal-title"></h2>
      <div id="arnaqueur-modal-content">
        <div id="arnaqueur-info" style="margin-bottom: 20px;">
          <p><strong>Username :</strong> <span id="arnaqueur-username"></span></p>
          <p><strong>Réseaux :</strong> <span id="arnaqueur-reseaux"></span></p>
          <p><strong>Techniques :</strong> <span id="arnaqueur-techniques"></span></p>
        </div>
        <div id="arnaqueur-description" style="margin-bottom: 20px;"></div>
        <div id="arnaqueur-medias" style="display: none;">
          <h3>Avis :</h3>
          <div id="arnaqueur-gallery"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal catégories (refonte) -->
  <div class="modal" id="category-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><img src="img/_technique/icon/categorie.png" alt="Catégories" class="icon-white" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 8px;"> Catégories</h3>
        <button class="close-btn" id="close-category-modal">&times;</button>
      </div>
      <div class="cat-breadcrumbs" id="cat-breadcrumbs"></div>
      <ul class="cat-list" id="cat-list"></ul>
    </div>
  </div>

  <!-- Modal filtres -->
  <div class="modal" id="filter-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><img src="img/_technique/icon/filtre.png" alt="Filtres" class="icon-white" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 8px;"> Filtres</h3>
        <button class="close-btn" id="close-filter-modal">&times;</button>
      </div>
      <div id="filter-content">
        <div class="form-group">
          <label>Prix minimum:</label>
          <input type="number" id="min-price" placeholder="0">
        </div>
        <div class="form-group">
          <label>Prix maximum:</label>
          <input type="number" id="max-price" placeholder="1000">
        </div>
        <div class="form-group">
          <button class="control-btn" id="apply-filters">Appliquer les filtres</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal ajout avis -->
  <div class="modal" id="add-review-modal">
    <div class="modal-content add-review-modal-content">
      <div class="modal-header add-review-header">
        <h3 class="modal-title add-review-title">
          <span class="title-icon">⭐</span>
          Ajouter un avis
        </h3>
        <button class="close-btn add-review-close" id="close-add-review-modal">&times;</button>
      </div>
      <form class="add-review-form" id="add-review-form">
        <div class="form-row">
          <div class="form-group half">
            <label for="review-client">Nom du client:</label>
            <input type="text" id="review-client" placeholder="Votre nom">
          </div>
          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" id="review-anonymous">
              <span class="checkmark"></span>
              Avis anonyme
            </label>
          </div>
        </div>
        
        <div class="form-group">
          <label for="review-produit">Produit : <span class="optional">(optionnel)</span></label>
          <div class="product-selector">
            <div class="selected-product" id="selected-product">
              <div class="product-placeholder">
                <span class="product-icon">📦</span>
                <span class="product-text">Cliquez pour sélectionner un produit</span>
              </div>
            </div>
            <button type="button" class="product-select-btn" id="product-select-btn">
              <span>Parcourir les produits</span>
              <span class="btn-arrow">→</span>
            </button>
          </div>
          <input type="hidden" id="review-produit">
        </div>
        
        <div class="form-group">
          <label for="review-titre">Titre de l'avis: <span class="optional">(optionnel)</span></label>
          <input type="text" id="review-titre" placeholder="Un titre pour votre avis...">
        </div>
        
        <div class="form-group">
          <label for="review-description">Votre témoignage: <span class="optional">(optionnel)</span></label>
          <textarea id="review-description" rows="4" placeholder="Partagez votre expérience avec nous..."></textarea>
        </div>
        
        <div class="form-group rating-group">
          <label>Note: <span class="rating-text">Très satisfait (5/5)</span></label>
          <div class="rating-input">
            <span class="rating-star" data-rating="1">⭐</span>
            <span class="rating-star" data-rating="2">⭐</span>
            <span class="rating-star" data-rating="3">⭐</span>
            <span class="rating-star" data-rating="4">⭐</span>
            <span class="rating-star" data-rating="5">⭐</span>
          </div>
        </div>
        
        <div class="form-group">
          <label>Photos/Vidéos: <span class="optional">(optionnel)</span></label>
          <div class="media-upload-section">
            <input type="file" id="review-media" multiple accept="image/*,video/*" style="display: none;">
            <button type="button" class="media-upload-btn" id="media-upload-btn">
              <span class="upload-icon">📷</span>
              <span>Sélectionner des médias</span>
            </button>
            <div class="media-preview" id="media-preview"></div>
          </div>
        </div>
        
        <button type="submit" class="submit-review-btn">
          <span class="btn-icon">📝</span>
          Envoyer mon avis
        </button>
      </form>
    </div>
  </div>

  <!-- Modal ajout arnaque -->
  <div class="modal" id="add-arnaque-modal">
    <div class="modal-content add-arnaque-modal-content">
      <div class="modal-header add-arnaque-header">
        <h3 class="modal-title add-arnaque-title">
          <span class="title-icon">⚠️</span>
          Signaler une arnaque
        </h3>
        <button class="close-btn add-arnaque-close" id="close-add-arnaque-modal">&times;</button>
      </div>
      <form class="add-arnaque-form" id="add-arnaque-form">
        <div class="form-group">
          <label for="arnaque-nom">Nom de l'arnaqueur: <span class="required">*</span></label>
          <input type="text" id="arnaque-nom" placeholder="Nom ou pseudo de l'arnaqueur" required>
        </div>

        <div class="form-group">
          <label for="arnaque-id">Identifiant de l'arnaqueur: <span class="required">*</span></label>
          <input type="text" id="arnaque-id" placeholder="@pseudo, numéro, email, etc." required>
        </div>

        <div class="form-group">
          <label>Réseaux sociaux: <span class="required">*</span></label>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;">
            <button type="button" class="reseau-btn-signalement" data-reseau="Snapchat">
              <img src="img/_technique/icon/Snapchat.png" alt="Snapchat" style="width:16px;height:16px;"> Snapchat
            </button>
            <button type="button" class="reseau-btn-signalement" data-reseau="Telegram">
              <img src="img/_technique/icon/telegram.png" alt="Telegram" style="width:16px;height:16px;"> Telegram
            </button>
            <button type="button" class="reseau-btn-signalement" data-reseau="Discord">
              <img src="img/_technique/icon/discord.ico" alt="Discord" style="width:16px;height:16px;"> Discord
            </button>
            <button type="button" class="reseau-btn-signalement" data-reseau="Instagram">
              <img src="img/_technique/icon/Instagram.png" alt="Instagram" style="width:16px;height:16px;"> Instagram
            </button>
            <button type="button" class="reseau-btn-signalement" data-reseau="Facebook">
              <img src="img/_technique/icon/facebook.png" alt="Facebook" style="width:16px;height:16px;"> Facebook
            </button>
            <button type="button" class="reseau-btn-signalement" data-reseau="WhatsApp">
              <img src="img/_technique/icon/whatsapp.png" alt="WhatsApp" style="width:16px;height:16px;"> WhatsApp
            </button>
          </div>
          <input type="hidden" id="arnaque-reseaux">
        </div>

        <div class="form-group">
          <label for="arnaque-denonceur">Votre nom: <span class="required">*</span></label>
          <input type="text" id="arnaque-denonceur" placeholder="Votre nom ou pseudo" required>
        </div>

        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" id="arnaque-anonymous">
            <span class="checkmark"></span>
            Rester anonyme (votre nom ne sera pas visible)
          </label>
        </div>
        
        <div class="form-group">
          <label for="arnaque-produits">Produits liés: <span class="optional">(optionnel)</span></label>
          <div class="product-selector-multiple">
            <div class="selected-products" id="selected-arnaque-products">
              <div class="product-placeholder">
                <span class="product-icon">📦</span>
                <span class="product-text">Cliquez pour sélectionner des produits</span>
              </div>
            </div>
            <button type="button" class="product-select-btn" id="arnaque-product-select-btn">
              <span>Ajouter des produits</span>
              <span class="btn-arrow">→</span>
            </button>
          </div>
          <input type="hidden" id="arnaque-produits">
        </div>
        
        <div class="form-group">
          <label for="arnaque-technique">Technique détaillée: <span class="required">*</span></label>
          <textarea id="arnaque-technique" rows="5" placeholder="Décrivez en détail comment l'arnaque s'est déroulée..." required></textarea>
        </div>
        
        <div class="form-group">
          <label>Preuves (photos/vidéos): <span class="optional">(optionnel - sélection multiple possible)</span></label>
          <div class="media-upload-section">
            <input type="file" id="arnaque-media" multiple accept="image/*,video/*" style="display: none;">
            <button type="button" class="media-upload-btn" id="arnaque-media-upload-btn">
              <span class="upload-icon">📷</span>
              <span>Sélectionner des preuves (plusieurs fichiers possibles)</span>
            </button>
            <div class="media-preview" id="arnaque-media-preview"></div>
          </div>
        </div>
        
        <button type="submit" class="submit-arnaque-btn">
          <span class="btn-icon">⚠️</span>
          Envoyer le signalement
        </button>
      </form>
    </div>
  </div>

  <!-- Modal détail technique arnaque -->
  <div class="modal" id="technique-detail-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="technique-detail-title">
          <span style="margin-right: 10px;">🎯</span>
          <span id="technique-name"></span>
        </h3>
        <button class="close-btn" id="close-technique-detail-modal">&times;</button>
      </div>
      <div class="modal-body" id="technique-detail-description">
        <!-- La description sera affichée ici -->
      </div>
    </div>
  </div>

  <!-- Modal sélection de produit -->
  <div class="modal" id="product-selection-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">🛍️ Sélectionner un produit</h3>
        <button class="close-btn" id="close-product-selection-modal">&times;</button>
      </div>
      <div class="product-selection-content">
        <div class="search-container" style="margin-bottom: 20px;">
          <span class="search-icon"><img src="img/_technique/icon/loupe.png" alt="Rechercher" class="icon-white" style="width: 16px; height: 16px;"></span>
          <input type="text" id="search-input" placeholder="Rechercher un produit...">
        </div>
        <div class="products-grid" id="product-selection-grid">
          <!-- Les produits seront chargés ici -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal sélection de médias -->
  <div class="modal" id="media-selection-modal">
    <div class="modal-content media-modal-content">
      <div class="modal-header">
        <h3 class="modal-title">📷 Sélectionner des médias</h3>
        <button class="close-btn" id="close-media-selection-modal">&times;</button>
      </div>
    
      <div class="media-selection-content">
        <div class="media-tab-content active" id="device-tab">
          <div class="device-upload-area">
            <input type="file" id="device-media-input" multiple accept="image/*,video/*" style="display: none;">
            <div class="upload-drop-zone" id="upload-drop-zone">
              <div class="upload-drop-content">
                <span class="upload-drop-icon">📎</span>
                <h3>Glissez vos fichiers ici</h3>
                <p>ou cliquez pour parcourir</p>
              </div>
            </div>
          </div>
          <div class="selected-media-preview" id="device-selected-preview"></div>
        </div>
      </div>
      
      <div class="media-selection-footer">
        <div class="selected-count">
          <span id="selected-media-count">0 média sélectionné</span>
        </div>
        <div class="media-selection-actions">
          <button type="button" class="cancel-selection-btn" id="cancel-media-selection">
            Annuler
          </button>
          <button type="button" class="validate-selection-btn" id="validate-media-selection">
            <span class="btn-icon">✓</span>
            Valider la sélection
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal détails avis -->
  <div class="modal" id="review-detail-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title"><img src="img/_technique/icon/preuve.png" alt="Avis" class="icon-white" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 8px;"> Détail de l'avis</h3>
        <button class="close-btn" id="close-review-detail-modal">&times;</button>
      </div>
      <div class="review-detail-content">
        <div class="review-detail-header">
          <div class="review-detail-avatar" id="review-detail-avatar">C</div>
          <div class="review-detail-info">
            <h4 class="review-detail-username" id="review-detail-username">Client</h4>
            <p class="review-detail-date" id="review-detail-date">Date</p>
          </div>
          <div class="review-verified">VÉRIFIÉ</div>
        </div>
        
        <div class="review-detail-rating" id="review-detail-rating">
          <span class="review-stars">★★★★★</span>
          <span class="review-rating-text">(5/5)</span>
        </div>
        
        <h3 class="review-detail-title" id="review-detail-title">Titre de l'avis</h3>
        
        <div class="review-detail-description" id="review-detail-description">
          <p>Description de l'avis...</p>
        </div>
        
        <div class="review-detail-product" id="review-detail-product" style="display: none; cursor: pointer;" onclick="openProductFromReview()">
          <strong>Produit :</strong> <span id="review-product-name"></span>
        </div>
        
        <div class="review-detail-images" id="review-detail-images" style="display: none;">
          <h4 style="color: #8ef58e; margin: 15px 0 10px 0;">Photos :</h4>
          <div class="product-gallery">
            <div class="main-image-container" style="max-width: 100%; overflow: hidden; text-align: center;">
              <img id="review-main-image" class="main-image" src="" alt="Image principale" onclick="openImageModal(this.src)" style="max-width: 100%; height: auto; object-fit: contain; border-radius: 8px;">
            </div>
            <div class="thumbnail-container" id="review-thumbnails"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Variables globales
    let currentSection = 'articles';
  let annoncesData = [];
  let messagesAvisData = [];
    let articlesData = [];
    let offresData = [];
    let arnaquesData = [];
    let AvisData = [];
  // categories est géré par la nouvelle modale de catégories plus bas
    let cart = [];
    let selectedRating = 5;

    // Fonction pour normaliser les chemins des médias
    function normalizeMediaPath(path) {
      if (!path) return '';
      // Si URL absolue http(s), l'utiliser directement (Pixeldrain, etc.)
      if (/^https?:\/\//i.test(path)) {
        return path;
      }
      // Forcer le proxy public /img/ pour tous les médias locaux/relatifs
      if (path.startsWith('/img/')) return path; // déjà absolu
      if (path.startsWith('img/')) return '/' + path; // s'assurer d'un slash initial
      return '/img/' + path.replace(/^\//, '');
    }

    // Fonction helper pour obtenir le bon type MIME pour les vidéos
    function getVideoMimeType(filename) {
      const extension = filename.split('.').pop().toLowerCase();
      const mimeTypes = {
        'mp4': 'video/mp4',
        'webm': 'video/webm',
        'avi': 'video/avi',
        'mov': 'video/quicktime',
        'wmv': 'video/x-ms-wmv',
        'flv': 'video/x-flv',
        'mkv': 'video/x-matroska'
      };
      return mimeTypes[extension] || `video/${extension}`;
    }

    // Charger le compteur d'avis en attente
    async function loadPendingCountBadge() {
      try {
        const res = await fetch('/api/avis-pending');
        const avisPending = await res.json();
        const count = avisPending.length;
        
        const notice = document.getElementById('pending-admin-notice');
        const countText = document.getElementById('pending-count-text');
        
        if (count > 0 && notice && countText) {
          countText.textContent = `⚠️ ${count} avis en attente de validation par l'administrateur`;
          notice.style.display = 'block';
        } else if (notice) {
          notice.style.display = 'none';
        }
      } catch (e) {
        console.log('Pas d\'avis en attente ou erreur:', e.message);
        const notice = document.getElementById('pending-admin-notice');
        if (notice) notice.style.display = 'none';
      }
    }

    // Fonction de chargement des données selon la section
    async function loadSectionData() {
      console.log('loadSectionData appelée pour la section:', currentSection);
      try {
        switch(currentSection) {
          case 'articles':
            console.log('Chargement des articles (ordre de pertinence)...');
            try {
              const ts = Date.now();
              const orderedRes = await fetch('/api/articles-ordered?ts='+ts, { cache: 'no-store' });
              if(!orderedRes.ok) throw new Error('Réponse non OK /api/articles-ordered');
              articlesData = await orderedRes.json();
              console.log('Articles ordonnés chargés:', articlesData.length);
            } catch(errOrdered){
              console.warn('Fallback vers /api/articles:', errOrdered.message);
              const fallbackRes = await fetch('/api/articles?ts=' + Date.now(), { cache: 'no-store' });
              articlesData = await fallbackRes.json();
              console.log('Articles fallback chargés:', articlesData.length);
            }
            displayArticles(articlesData);
            // Charger les produits pour le formulaire d'avis après le chargement des articles
            loadProductsForReview();
            break;
          case 'offres':
            console.log('Chargement des offres...');
            if (!offresData.length) {
              const offresRes = await fetch('/offres.json');
              offresData = await offresRes.json();
            }
            displayOffres(offresData);
            break;
          case 'arnaques':
            console.log('Chargement des arnaques...');
            if (!arnaquesData.length) {
              const arnaquesRes = await fetch('/arnaques.json');
              arnaquesData = await arnaquesRes.json();
            }
            displayArnaques(arnaquesData);
            break;
          case 'Avis':
            console.log('Chargement des Avis...');
            const AvisRes = await fetch('/api/preuves');
            AvisData = await AvisRes.json();
            displayAvis(AvisData);
            loadPendingCountBadge(); // Charger le compteur pour cette section
            break;
          case 'annonces':
            console.log('Chargement des annonces...');
            await loadAnnoncesAndMessagesAvis();
            break;
          case 'infos':
            console.log('Chargement de la page infos...');
            await loadInfosPage();
            break;
        }
      } catch (error) {
        console.error('Erreur lors du chargement des données:', error);
      }
    }

    // Fonction d'affichage des articles
    function displayArticles(articles) {
      console.log('displayArticles appelée avec:', articles.length, 'articles');
      const container = document.getElementById('products-grid');
      if (!container) {
        console.error('Container products-grid non trouvé');
        return;
       }
      container.innerHTML='';
      articles.forEach(article => {
        const productDiv = document.createElement('div');
        productDiv.className = 'product-card';
        // media principal
        let mediaHtml='';
        const media = (article.thumbnail || (article.medias && article.medias[0]?.path) || (article.images && article.images[0]) || article.image || '');
        const normalized = normalizeMediaPath(media);
        
        if (normalized) {
          // Détecter le type basé sur l'URL du média utilisé, pas sur medias[0].type
          if (/\.(mp4|webm|mov|avi|wmv|flv|mkv)$/i.test(normalized)) {
            mediaHtml = `<video src="${normalized}" muted loop autoplay style="width:100%;height:160px;object-fit:cover;border-radius:12px;" onloadedmetadata="handleMainVideoLoad(this)"></video>`;
          } else {
            mediaHtml = `<img src="${normalized}" style="width:100%;height:160px;object-fit:cover;border-radius:12px;"/>`;
          }
        }
        productDiv.innerHTML = `
          ${mediaHtml ? `<div class="product-media">${mediaHtml}</div>` : ''}
          <div class="product-info">
            <h3 class="product-name">${article.nom || article.id || 'Article'}</h3>
            <div class="product-footer">
              <span class="product-price">${article.prix? article.prix+ '€':''}</span>
              <button class="add-to-cart-btn" data-add-cart>Ajouter</button>
            </div>
          </div>`;
        productDiv.querySelector('[data-add-cart]')?.addEventListener('click',(e)=>{
          e.stopPropagation();
          addToCart(article.id);
        });
        productDiv.addEventListener('click',()=>{
          showProductModal(article);
        });
        container.appendChild(productDiv);
      });
    }

    // ---- Annonces & Messages Avis (Index public) ----
    async function loadAnnoncesAndMessagesAvis(){
      try {
        const [annoncesRes, msgRes] = await Promise.all([
          fetch('/api/annonces'),
          fetch('/api/messages-Avis').catch(()=>({ json: async()=>[] }))
        ]);
        annoncesData = await annoncesRes.json();
        try { messagesAvisData = await msgRes.json(); } catch { messagesAvisData = []; }
        renderAnnonces();
        renderMessagesAvisPublic();
      } catch(e){
        console.error('Erreur chargement annonces/messages Avis', e);
        const grid = document.getElementById('annonces-grid');
        const empty = document.getElementById('annonces-empty');
        if(grid && empty){ grid.innerHTML=''; empty.style.display='block'; }
      }
    }
    function renderAnnonces(){
      const grid = document.getElementById('annonces-grid');
      const pinned = document.getElementById('annonces-pinned');
      const empty = document.getElementById('annonces-empty');
      if(!grid||!pinned||!empty) return;
      
      pinned.innerHTML='';
      grid.innerHTML='';
      
      if(!annoncesData.length){ 
        empty.style.display='block'; 
        grid.style.display='none'; 
        pinned.style.display='none';
        return; 
      }
      
      empty.style.display='none';
      
      // Trier par date décroissante (plus récente en premier)
      const annoncesSorted = [...annoncesData].sort((a,b)=> new Date(b.dateCreation)-new Date(a.dateCreation));
      
      // La première annonce (plus récente) est affichée en grand en haut
      if (annoncesSorted.length > 0) {
        const latestAnnonce = annoncesSorted[0];
        pinned.style.display='block';
        const div = document.createElement('div');
        div.innerHTML = annonceCardHTML(latestAnnonce, true);
        const card = div.firstElementChild;
        attachAnnonceEvents(card, latestAnnonce);
        pinned.appendChild(card);
      }
      
      // Les autres annonces s'empilent en dessous
      if (annoncesSorted.length > 1) {
        grid.style.display='flex';
        grid.style.flexDirection='column';
        grid.style.gap='12px';
        
        for (let i = 1; i < annoncesSorted.length; i++) {
          const a = annoncesSorted[i];
          const div = document.createElement('div');
          div.innerHTML = annonceCardHTML(a, false);
          const card = div.firstElementChild;
          attachAnnonceEvents(card, a);
          grid.appendChild(card);
        }
      } else {
        grid.style.display='none';
      }
    }
    // Fonction pour interpréter le message avec BBCode et images
    function renderAnnonceMessage(message, medias, maxLength = null) {
      if (!message) return '';
      
      let rendered = message;
      
      // Tronquer si nécessaire
      if (maxLength) {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = rendered;
        const text = tempDiv.textContent || tempDiv.innerText;
        if (text.length > maxLength) {
          rendered = text.slice(0, maxLength) + '…';
        }
      }
      
      // Remplacer les marqueurs d'images par les médias réels
      (medias || []).forEach((mediaPath, index) => {
        // Chercher les spans avec data-image-marker
        const markerPattern = new RegExp(`<span[^>]*data-image-marker="${index + 1}"[^>]*>.*?</span>`, 'g');
        const p = normalizeMediaPath(mediaPath);
        const isVideo = /\.(mp4|webm|mov)$/i.test(mediaPath);
        const mediaHtml = isVideo
          ? `<div style="margin:10px 0;"><video src="${p}" controls style="width:100%;max-height:300px;border-radius:8px;object-fit:contain;"></video></div>`
          : `<div style="margin:10px 0;"><img src="${p}" style="width:100%;max-height:300px;border-radius:8px;object-fit:contain;"/></div>`;
        rendered = rendered.replace(markerPattern, mediaHtml);
      });
      
      return rendered;
    }
    
    function annonceCardHTML(a,isFeatured){
      // Rendu du message HTML (déjà formaté par l'éditeur WYSIWYG)
      const renderedMessage = a.message || '';
      
      // Tronquer si nécessaire pour les cartes non-featured
      let displayMessage = renderedMessage;
      if (!isFeatured) {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = renderedMessage;
        const text = tempDiv.textContent || tempDiv.innerText;
        if (text.length > 150) {
          displayMessage = text.slice(0, 150) + '…';
        }
      }
      
      // Style différent pour la carte featured (dernière annonce)
      if (isFeatured) {
        return `<div class='annonce-card' data-annonce-id='${a.id}' style="background:linear-gradient(135deg, rgba(255,211,105,0.15), rgba(255,179,71,0.1));border:2px solid rgba(255,211,105,0.3);padding:20px;border-radius:20px;display:flex;flex-direction:column;gap:14px;position:relative;backdrop-filter:blur(8px);box-shadow:0 4px 12px rgba(255,211,105,0.2);">
          <div style='position:absolute;top:10px;right:10px;background:#ffd369;color:#240038;font-size:.7em;padding:6px 12px;border-radius:30px;font-weight:700;box-shadow:0 2px 6px #0007;'>🆕 DERNIÈRE</div>
          <div style='display:flex;flex-direction:column;gap:8px;'>
            <div style='font-weight:700;font-size:1.2em;color:#ffd369;'>${a.titre || 'Annonce'}</div>
            <div style='font-size:.95em;line-height:1.6;'>${renderedMessage}</div>
          </div>
          <div style='display:flex;justify-content:space-between;align-items:center;font-size:.75em;opacity:.9;'>
            <span style="color:#8ef58e;font-weight:600;">${new Date(a.dateCreation).toLocaleDateString('fr-FR')}</span>
          </div>
        </div>`;
      }
      
      // Style compact pour les autres annonces
      return `<div class='annonce-card' data-annonce-id='${a.id}' style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);padding:14px;border-radius:12px;display:flex;flex-direction:column;gap:8px;backdrop-filter:blur(6px);transition:all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.08)'" onmouseout="this.style.background='rgba(255,255,255,0.05)'">
        <div style='font-weight:600;font-size:0.95em;color:#8ef58e;'>${a.titre || 'Annonce'}</div>
        <div style='font-size:.8em;line-height:1.4;'>${displayMessage}</div>
        <div style='font-size:.7em;opacity:.7;margin-top:auto;'>${new Date(a.dateCreation).toLocaleDateString('fr-FR')}</div>
      </div>`;
    }
    function mediaCountBadge(n){ return `<div style='position:absolute;top:6px;right:6px;background:rgba(0,0,0,.55);color:#fff;padding:2px 6px;font-size:.6em;border-radius:8px;'>+${n-1}</div>`; }
    function attachAnnonceEvents(card,a){
      if(!card||!a) return;
      
      // Gérer les clics sur les liens produits dans la carte
      card.querySelectorAll('.annonce-product-link').forEach(link => {
        link.addEventListener('click', (e) => {
          e.stopPropagation();
          const productId = parseInt(link.dataset.productId);
          const product = articlesData.find(p => p.id === productId);
          if (product) {
            showProductModal(product);
          }
        });
      });
      
      // Ne pas rendre la carte cliquable
    }
    
    function showImageFullscreen(src) {
      let overlay = document.getElementById('image-fullscreen-overlay');
      if (!overlay) {
        overlay = document.createElement('div');
        overlay.id = 'image-fullscreen-overlay';
        overlay.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:99999;display:flex;align-items:center;justify-content:center;cursor:pointer;';
        overlay.onclick = () => overlay.remove();
        document.body.appendChild(overlay);
      }
      overlay.innerHTML = `<img src="${src}" style="max-width:95%;max-height:95%;border-radius:8px;"/>`;
    }
    function renderMessagesAvisPublic(){
      const wrap = document.getElementById('messages-Avis-wrapper');
      if(!wrap) return;
      wrap.innerHTML='';
      if(!messagesAvisData.length){ wrap.innerHTML='<div style="grid-column:1/-1;text-align:center;opacity:.6;padding:20px;">Aucun message</div>'; return; }
      messagesAvisData.forEach(msg=>{
        const card = document.createElement('div');
        card.style.cssText='background:#2e004f;border:1px solid #4b1a7f;padding:10px 12px;border-radius:12px;font-size:.72em;display:flex;flex-direction:column;gap:6px;position:relative;';
        card.innerHTML = `<div style='font-size:.65em;color:#ffd369;display:flex;align-items:center;gap:4px;'>💬 Confiance</div>${msg.titre?`<div style='font-weight:600;'>${msg.titre}</div>`:''}<div style='line-height:1.4;white-space:pre-wrap;'>${(msg.message||'').slice(0,240)}${(msg.message||'').length>240?'…':''}</div>`;
        card.addEventListener('click',()=>{
          // réutilise showReviewModal pour afficher plein
          if(window.showReviewModal){
            showReviewModal({ username:'Anonyme', titre: msg.titre||'Message', description: msg.message, medias:(msg.medias||[]).map(m=>({ path:m, type:/\.(mp4|webm|mov)$/i.test(m)?'video':'image'})), rating:5, date:new Date(msg.dateSubmission).toLocaleDateString('fr-FR') });
          }
        });
        wrap.appendChild(card);
      });
    }

    // ==================== PAGE INFOS ====================
    let infosPageData = { elements: [], sommaire: { visible: true, items: [] } };
    
    async function loadInfosPage() {
      try {
        const res = await fetch('/api/info-page');
        if (res.ok) {
          const data = await res.json();
          // S'assurer que sommaire existe
          infosPageData = {
            elements: data.elements || [],
            sommaire: data.sommaire || { visible: true, items: [] }
          };
          console.log('[INDEX] Page infos chargée, sommaire:', infosPageData.sommaire);
          console.log('[INDEX] Items du sommaire:', infosPageData.sommaire.items);
          renderInfosPage();
        } else {
          console.warn('Page infos non disponible');
          document.getElementById('infos-content').innerHTML = '<div style="text-align:center;padding:50px;color:#8ef58e;opacity:0.7;">Aucune information disponible pour le moment.</div>';
        }
      } catch (e) {
        console.error('Erreur chargement page infos:', e);
        document.getElementById('infos-content').innerHTML = '<div style="text-align:center;padding:50px;color:#ff6b6b;">Erreur de chargement</div>';
      }
    }

    function renderInfosPage() {
      const container = document.getElementById('infos-content');
      if (!container) return;
      
      container.innerHTML = '';
      
      // Afficher le sommaire si visible
      console.log('[INDEX] Rendu sommaire, données:', infosPageData.sommaire);
      if (infosPageData.sommaire && infosPageData.sommaire.visible && infosPageData.sommaire.items && infosPageData.sommaire.items.length > 0) {
        console.log('[INDEX] Affichage du sommaire avec', infosPageData.sommaire.items.length, 'items');
        const sommaireDiv = document.createElement('div');
        sommaireDiv.style.cssText = 'margin:20px 0;padding:20px;background:#2e004f;border-radius:12px;';
        sommaireDiv.innerHTML = `
          <div style="font-size:1.4em;font-weight:700;color:#ffd369;margin-bottom:15px;text-align:center;">📋 Sommaire</div>
          ${renderSommaireItems(infosPageData.sommaire.items)}
        `;
        container.appendChild(sommaireDiv);
      } else {
        console.log('[INDEX] Sommaire non affiché - visible:', infosPageData.sommaire?.visible, 'items:', infosPageData.sommaire?.items?.length);
      }
      
      // Si aucun élément
      if (!infosPageData.elements || infosPageData.elements.length === 0) {
        const emptyDiv = document.createElement('div');
        emptyDiv.style.cssText = 'text-align:center;padding:50px;color:#8ef58e;opacity:0.7;';
        emptyDiv.textContent = 'Aucune information disponible pour le moment.';
        container.appendChild(emptyDiv);
        return;
      }
      
      // Container pour les éléments positionnés
      const canvas = document.createElement('div');
      canvas.style.cssText = 'position:relative;min-height:800px;width:100%;overflow-x:auto;';
      canvas.className = 'infos-canvas-responsive';
      
      infosPageData.elements.forEach(element => {
        const el = createInfosPageElement(element);
        canvas.appendChild(el);
      });
      
      container.appendChild(canvas);
      
      // Initialiser le bouton sommaire
      setTimeout(() => initSommaireButton(), 100);
    }
    
    function renderSommaireItems(items, level = 0) {
      if (!items || items.length === 0) return '';
      
      return '<div style="display:flex;flex-direction:column;gap:8px;margin-left:' + (level * 20) + 'px;">' + 
        items.map(item => {
          const hasChildren = item.children && item.children.length > 0;
          return `
            <div style="display:flex;flex-direction:column;">
              <a href="#${item.id}" 
                 style="color:#8ef58e;text-decoration:none;padding:8px 12px;background:rgba(107,5,114,0.3);border-radius:8px;transition:all 0.2s;display:block;" 
                 onmouseover="this.style.background='rgba(107,5,114,0.6)'" 
                 onmouseout="this.style.background='rgba(107,5,114,0.3)'">
                ${hasChildren ? '📁' : '📄'} ${item.titre}
              </a>
              ${hasChildren ? renderSommaireItems(item.children, level + 1) : ''}
            </div>
          `;
        }).join('') + 
      '</div>';
    }

    function createInfosPageElement(element) {
      const wrapper = document.createElement('div');
      
      // Position par défaut si non définie (ancien format)
      const pos = element.position || { x: 20, y: 20, width: 600, height: 200 };
      
      // Rendre les ancres complètement invisibles
      if (element.type === 'anchor') {
        wrapper.style.cssText = `
          position:absolute;
          left:${pos.x}px;
          top:${pos.y}px;
          width:1px;
          height:1px;
          visibility:hidden;
          opacity:0;
          pointer-events:none;
        `;
      } else {
        wrapper.style.cssText = `
          position:absolute;
          left:${pos.x}px;
          top:${pos.y}px;
          width:${pos.width}px;
          min-height:${pos.height}px;
          padding:15px;
          background:rgba(75,26,127,0.3);
          border-radius:12px;
          box-sizing:border-box;
          ${pos.zIndex ? 'z-index:' + pos.zIndex + ';' : ''}
        `;
      }
      
      const content = document.createElement('div');
      content.style.cssText = element.style || '';
      
      switch (element.type) {
        case 'sommaire':
          // Générer le sommaire avec des ancres cliquables
          const textElements = infosPageData.elements.filter(e => e.type === 'text' && e.content);
          content.innerHTML = `<div style="background:#2e004f;padding:20px;border-radius:12px;">
            <div style="font-size:1.4em;font-weight:700;color:#ffd369;margin-bottom:15px;text-align:center;">📋 Sommaire</div>
            <div style="display:flex;flex-direction:column;gap:10px;">
              ${textElements.length > 0 ? textElements.map((e, i) => {
                const title = e.content.replace(/<[^>]*>/g, '').slice(0, 60);
                const anchorId = `section-${i}`;
                return `<a href="#${anchorId}" style="color:#8ef58e;text-decoration:none;padding:8px 12px;background:rgba(107,5,114,0.3);border-radius:8px;transition:all 0.2s;display:block;" 
                  onmouseover="this.style.background='rgba(107,5,114,0.6)'" 
                  onmouseout="this.style.background='rgba(107,5,114,0.3)'">
                  → ${title}${title.length >= 60 ? '...' : ''}
                </a>`;
              }).join('') : '<div style="opacity:0.6;text-align:center;">Aucune section disponible</div>'}
            </div>
          </div>`;
          break;
        case 'text':
          // Ajouter un ID unique pour les ancres
          const textIndex = infosPageData.elements.filter((e, idx) => e.type === 'text' && idx < infosPageData.elements.indexOf(element)).length;
          wrapper.id = `section-${textIndex}`;
          content.innerHTML = element.content || '';
          
          // Activer les liens vers produits/variantes
          setTimeout(() => {
            const productLinks = content.querySelectorAll('.product-link');
            productLinks.forEach(link => {
              const productId = link.dataset.productId;
              const variantName = link.dataset.varianteName;
              
              // Effet hover avec aperçu
              link.onmouseover = async (e) => {
                link.style.background = 'rgba(142,245,142,0.3)';
                link.style.transform = 'translateY(-2px)';
                
                // Créer tooltip d'aperçu
                const product = articlesData.find(a => a.id === productId);
                if (product) {
                  const tooltip = document.createElement('div');
                  tooltip.className = 'product-tooltip';
                  tooltip.style.cssText = `
                    position:fixed;
                    left:${e.clientX + 10}px;
                    top:${e.clientY + 10}px;
                    background:#2e004f;
                    border:2px solid #ffd369;
                    border-radius:12px;
                    padding:15px;
                    z-index:10000;
                    max-width:300px;
                    box-shadow:0 4px 16px rgba(0,0,0,0.5);
                    pointer-events:none;
                  `;
                  
                  const thumbnail = product.thumbnail || (product.medias && product.medias[0]?.path) || '';
                  const imgHtml = thumbnail ? `<img src="${thumbnail}" style="width:100%;border-radius:8px;margin-bottom:10px;">` : '';
                  
                  tooltip.innerHTML = `
                    ${imgHtml}
                    <div style="color:#ffd369;font-weight:700;margin-bottom:5px;">${product.nom}</div>
                    ${variantName ? `<div style="color:#8ef58e;font-size:0.9em;margin-bottom:5px;">📦 ${variantName}</div>` : ''}
                    <div style="color:#8ef58e;font-size:0.95em;">${product.prix}€</div>
                    ${product.description ? `<div style="color:#ccc;font-size:0.85em;margin-top:8px;">${product.description.slice(0, 100)}...</div>` : ''}
                  `;
                  
                  document.body.appendChild(tooltip);
                  link.tooltip = tooltip;
                }
              };
              
              link.onmouseout = () => {
                link.style.background = 'rgba(142,245,142,0.15)';
                link.style.transform = 'translateY(0)';
                if (link.tooltip) {
                  link.tooltip.remove();
                  delete link.tooltip;
                }
              };
              
              // Clic : ouvrir le modal produit
              link.onclick = (e) => {
                e.preventDefault();
                if (link.tooltip) {
                  link.tooltip.remove();
                  delete link.tooltip;
                }
                
                // Trouver le produit complet dans articlesData
                const product = articlesData.find(a => a.id === productId);
                if (product && typeof window.showProductModal === 'function') {
                  window.showProductModal(product);
                  
                  // Si une variante est spécifiée, la sélectionner après ouverture
                  if (variantName && product.variantes) {
                    setTimeout(() => {
                      const selector = document.getElementById('variante-selector');
                      if (selector) {
                        const variantIndex = product.variantes.findIndex(v => v.nom === variantName);
                        if (variantIndex >= 0) {
                          selector.value = variantIndex;
                          selector.dispatchEvent(new Event('change'));
                        }
                      }
                    }, 100);
                  }
                }
              };
            });
          }, 100);
          break;
        case 'image':
          const img = document.createElement('img');
          img.src = element.content;
          img.style.cssText = 'max-width:100%;border-radius:10px;display:block;margin:10px auto;' + (element.style || '');
          content.appendChild(img);
          break;
        case 'video':
          const video = document.createElement('video');
          video.src = element.content;
          video.controls = true;
          video.style.cssText = 'max-width:100%;border-radius:10px;display:block;margin:10px auto;' + (element.style || '');
          content.appendChild(video);
          break;
        case 'product':
          const prod = articlesData.find(a => a.id === element.content);
          if (prod) {
            // Parse style config
            const style = element.style || '';
            const layout = style.includes('layout:horizontal') ? 'horizontal' : 'vertical';
            const imageSize = (style.match(/image-size:(\d+px)/) || ['', '200px'])[1];
            const imagePosition = (style.match(/image-position:(top|left|right|bottom)/) || ['', 'top'])[1];
            const showName = !style.includes('show-name:false');
            const showPrice = !style.includes('show-price:false');
            
            const prodCard = document.createElement('div');
            
            // Déterminer la direction flex
            const flexDir = (layout === 'horizontal' || imagePosition === 'left' || imagePosition === 'right') ? 'row' : 'column';
            const order = (imagePosition === 'bottom' || imagePosition === 'right') ? 'reverse' : 'normal';
            
            prodCard.style.cssText = `padding:15px;background:#2e004f;border-radius:12px;cursor:pointer;display:flex;flex-direction:${flexDir}${order === 'reverse' ? '-reverse' : ''};align-items:center;gap:15px;transition:all 0.2s;`;
            prodCard.onmouseover = () => prodCard.style.background = '#4b1a7f';
            prodCard.onmouseout = () => prodCard.style.background = '#2e004f';
            
            let mediaHtml = '';
            if (prod.medias && prod.medias.length > 0) {
              const firstMedia = prod.medias[0];
              const mediaPath = normalizeMediaPath(firstMedia.path || firstMedia);
              if (/\.(mp4|webm|mov)$/i.test(mediaPath)) {
                mediaHtml = `<video src="${mediaPath}" muted autoplay loop style="max-width:${imageSize};max-height:${imageSize};object-fit:cover;border-radius:8px;"></video>`;
              } else {
                mediaHtml = `<img src="${mediaPath}" style="max-width:${imageSize};max-height:${imageSize};object-fit:cover;border-radius:8px;">`;
              }
            } else {
              mediaHtml = `<div style="width:${imageSize};height:${imageSize};background:#1a0033;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:2em;">🧨</div>`;
            }
            
            const nameHtml = showName ? `<div style="font-weight:600;color:#ffd369;margin-bottom:5px;">${prod.nom || 'Produit'}</div>` : '';
            const priceHtml = showPrice ? `<div style="font-size:0.9em;color:#8ef58e;margin-bottom:5px;">${prod.prix ? prod.prix + '€' : 'Prix non défini'}</div>` : '';
            
            prodCard.innerHTML = `
              ${mediaHtml}
              <div style="flex:1;display:flex;flex-direction:column;">
                ${nameHtml}
                ${priceHtml}
              </div>
              ${showName || showPrice ? '<div style="color:#8ef58e;font-size:1.5em;">→</div>' : ''}
            `;
            prodCard.onclick = () => {
              if (window.showProductModal) {
                showProductModal(prod);
              }
            };
            content.appendChild(prodCard);
          } else {
            content.innerHTML = '<div style="color:#ff6b6b;padding:10px;">Produit introuvable</div>';
          }
          break;
        case 'link':
          const link = document.createElement('a');
          link.href = element.url;
          link.target = '_blank';
          link.textContent = element.content || element.url;
          link.style.cssText = 'color:#8ef58e;text-decoration:underline;font-size:1.1em;font-weight:600;' + (element.style || '');
          content.appendChild(link);
          break;
        case 'anchor':
          // Marque de sommaire - affichage invisible pour l'ancre
          const anchorDiv = document.createElement('div');
          anchorDiv.id = element.content;
          anchorDiv.style.cssText = 'position:relative;top:-80px;visibility:hidden;';
          content.appendChild(anchorDiv);
          break;
        default:
          content.innerHTML = '<div style="color:#ff6b6b;">Type inconnu</div>';
      }
      
      wrapper.appendChild(content);
      return wrapper;
    }

    // Initialisation du bouton sommaire
    function initSommaireButton() {
      const toggleBtn = document.getElementById('toggle-sommaire-btn');
      const modal = document.getElementById('sommaire-modal');
      const sommaireContent = document.getElementById('sommaire-content');
      
      if (!toggleBtn || !modal || !sommaireContent) {
        console.warn('[Sommaire] Éléments manquants:', {toggleBtn: !!toggleBtn, modal: !!modal, sommaireContent: !!sommaireContent});
        return;
      }
      
      // Afficher/masquer le bouton selon la disponibilité du sommaire
      if (infosPageData.sommaire && infosPageData.sommaire.visible && infosPageData.sommaire.items && infosPageData.sommaire.items.length > 0) {
        toggleBtn.style.display = 'block';
        
        // Remplir le contenu du sommaire
        sommaireContent.innerHTML = renderSommaireItems(infosPageData.sommaire.items);
        
        // Ajouter smooth scroll aux liens
        sommaireContent.querySelectorAll('a').forEach(link => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = link.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
              targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
              modal.classList.remove('show');
            }
          });
        });
      } else {
        toggleBtn.style.display = 'none';
      }
      
      // Toggle modal (ouvrir/fermer)
      toggleBtn.addEventListener('click', () => {
        if (modal.classList.contains('show')) {
          modal.classList.remove('show');
        } else {
          modal.classList.add('show');
        }
      });
      
      // Bouton fermer (géré par onclick inline dans le HTML)
      
      // Fermer en cliquant sur le fond
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.classList.remove('show');
        }
      });
    }

    // Fonction d'affichage des offres
    function displayOffres(offres) {
      const container = document.getElementById('products-grid-offres');
      if (!container) return;
      
      container.innerHTML = '';
      
      offres.forEach(offre => {
        const productDiv = document.createElement('div');
        productDiv.className = 'product-card';
        
        const mediaHtml = offre.image ? 
          `<img src="${normalizeMediaPath(offre.image)}" alt="${offre.name}" style="width:100%;height:120px;object-fit:contain;border-radius:8px;margin-bottom:12px;background:rgba(255,255,255,0.1);">` :
          (() => { productDiv.classList.add('no-image'); return ``; })();
        
        productDiv.innerHTML = `
          ${mediaHtml}
          <div class="product-info">
            <h3 class="product-name">${offre.name}</h3>
            <p class="product-description">${offre.description}</p>
            <div class="product-footer">
              <span class="product-price">${offre.price}€</span>
              <span class="product-status">OFFRE</span>
            </div>
          </div>
        `;
        
        productDiv.addEventListener('click', () => {
          showProductModal(offre);
        });
        
        container.appendChild(productDiv);
      });
    }

    // Fonction d'affichage des arnaques
    function displayArnaques(arnaques) {
      const container = document.getElementById('products-grid-arnaques');
      if (!container) return;
      
      container.innerHTML = '';
      
      arnaques.forEach(arnaque => {
        const productDiv = document.createElement('div');
        productDiv.className = 'product-card';
        
        const mediaHtml = arnaque.image ? 
          `<img src="${normalizeMediaPath(arnaque.image)}" alt="${arnaque.anonyme ? 'Arnaqueur anonyme' : (arnaque.nom || arnaque.username)}" style="width:100%;height:120px;object-fit:contain;border-radius:8px;margin-bottom:12px;background:rgba(255,255,255,0.1);">` :
          (() => { productDiv.classList.add('no-image'); return ``; })();
        
        const verifiedBadge = arnaque.verified 
          ? '<span style="background:#28a745;color:white;padding:3px 8px;border-radius:12px;font-size:0.75em;font-weight:600;margin-left:8px;">✓ VÉRIFIÉ</span>'
          : '<span style="background:#ff9800;color:white;padding:3px 8px;border-radius:12px;font-size:0.75em;font-weight:600;margin-left:8px;">⚠ SUSPECTÉ</span>';
        
        productDiv.innerHTML = `
          ${mediaHtml}
          <div class="product-info">
            <h3 class="product-name" style="color:#ff6b6b; text-shadow: 0 1px 3px rgba(255, 107, 107, 0.3);">
              ${arnaque.anonyme ? 'Arnaqueur anonyme' : (arnaque.nom || arnaque.username)}
              ${verifiedBadge}
            </h3>
            ${arnaque.username && arnaque.nom && !arnaque.anonyme ? `<div style="color:#8ef58e; font-size:0.9em; margin-top:2px; font-weight: 500;">@${arnaque.username}</div>` : ''}
            <p class="product-description" style="background: rgba(255, 107, 107, 0.1); padding: 8px 12px; border-radius: 6px; border-left: 3px solid #ff6b6b;">${arnaque.description || arnaque.techniques || 'Arnaqueur signalé'}</p>
            <div class="product-footer">
              <div style="background: rgba(142, 245, 142, 0.1); padding: 4px 8px; border-radius: 12px; display: flex; align-items: center; gap: 6px;">${(() => {
                if (!arnaque.reseaux || arnaque.reseaux === 'Réseaux non spécifiés') return '<span style="color:#8ef58e; font-size:0.8em;">Réseaux non spécifiés</span>';
                const reseauxList = Array.isArray(arnaque.reseaux) ? arnaque.reseaux : arnaque.reseaux.split(', ');
                const iconMap = {
                  'Snapchat': 'img/_technique/icon/Snapchat.png',
                  'Telegram': 'img/_technique/icon/telegram.png',
                  'Discord': 'img/_technique/icon/discord.ico',
                  'Instagram': 'img/_technique/icon/Instagram.png',
                  'Facebook': 'img/_technique/icon/facebook.png',
                  'WhatsApp': 'img/_technique/icon/whatsapp.png',
                  'Anonyme': 'img/_technique/icon/anonyme.png'
                };
                return reseauxList.map(reseau => {
                  const icon = iconMap[reseau.trim()] || '';
                  return icon ? `<img src="${icon}" alt="${reseau}" title="${reseau}" style="width: 16px; height: 16px;">` : `<span style="color:#8ef58e; font-size:0.7em;" title="${reseau}">${reseau}</span>`;
                }).join('');
              })()}</div>
            </div>
          </div>
        `;
        
        productDiv.addEventListener('click', () => {
          showArnaqueurModal(arnaque);
        });
        
        container.appendChild(productDiv);
      });
    }

    // Fonction pour afficher la modal détaillée d'un avis
    function showReviewModal(AvisData) {
      // Stocker les données de l'avis actuel pour la navigation
      currentReviewData = AvisData;
      const modal = document.getElementById('review-detail-modal');
      
      // Compatibilité ancien/nouveau format pour le nom utilisateur
      const username = AvisData.username || AvisData.client || 'Anonyme';
      const isAnonymous = AvisData.isAnonymous || username === 'Anonyme' || !username;
      
      // Pour l'affichage public, masquer le nom si anonyme
      const displayName = isAnonymous ? 'Anonyme' : username;
      
      // Remplir les détails - Avatar avec image pour anonymes
      const avatarElement = document.getElementById('review-detail-avatar');
      if (isAnonymous) {
        // Utiliser l'image anonyme pour les utilisateurs anonymes
        avatarElement.innerHTML = '<img src="img/_technique/icon/anonyme.png" alt="Utilisateur anonyme" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">';
      } else {
        // Utiliser l'initiale pour les utilisateurs identifiés
        avatarElement.textContent = username ? username.charAt(0).toUpperCase() : 'U';
      }
      
      document.getElementById('review-detail-username').textContent = displayName;
      
      // Formatage sécurisé de la date
      let formattedDate = 'Date non disponible';
      if (AvisData.date) {
        try {
          // Si c'est déjà au format français (dd/mm/yyyy)
          if (AvisData.date.includes('/')) {
            const [day, month, year] = AvisData.date.split('/');
            const dateObj = new Date(year, month - 1, day);
            if (!isNaN(dateObj.getTime())) {
              formattedDate = dateObj.toLocaleDateString('fr-FR', { 
                day: 'numeric', month: 'long', year: 'numeric' 
              });
            } else {
              formattedDate = AvisData.date;
            }
          } else {
            // Si c'est un timestamp ou format ISO
            const dateObj = new Date(AvisData.date);
            if (!isNaN(dateObj.getTime())) {
              formattedDate = dateObj.toLocaleDateString('fr-FR', { 
                day: 'numeric', month: 'long', year: 'numeric' 
              });
            } else {
              formattedDate = AvisData.date;
            }
          }
        } catch (e) {
          formattedDate = AvisData.date;
        }
      }
      
      document.getElementById('review-detail-date').textContent = formattedDate;
      
      // Rating
      const ratingContainer = document.getElementById('review-detail-rating');
      const stars = '★'.repeat(AvisData.rating) + '☆'.repeat(5 - AvisData.rating);
      ratingContainer.innerHTML = `
        <span class="review-stars">${stars}</span>
        <span class="review-rating-text">(${AvisData.rating}/5)</span>
      `;
      
      // Titre
      const titleElement = document.getElementById('review-detail-title');
      if (AvisData.titre) {
        titleElement.textContent = AvisData.titre;
        titleElement.style.display = 'block';
      } else {
        titleElement.style.display = 'none';
      }
      
      // Description - compatibilité ancien/nouveau format
      const commentaire = AvisData.commentaire || AvisData.description || 'Aucun commentaire';
      document.getElementById('review-detail-description').innerHTML = `<p>${commentaire}</p>`;
      
      // Produit concerné
      const productElement = document.getElementById('review-detail-product');
      const productNameElement = document.getElementById('review-product-name');
      if (AvisData.produit) {
        productNameElement.textContent = AvisData.produit;
        productElement.style.display = 'block';
      } else {
        productElement.style.display = 'none';
      }
      
      // Images/médias avec système de galerie avancé comme les produits
      const imagesContainer = document.getElementById('review-detail-images');
      const mainImage = document.getElementById('review-main-image');
      const thumbnailsContainer = document.getElementById('review-thumbnails');
      
      // Gérer les médias multiples - créer un tableau à partir de différents formats
      let mediaList = [];
      let mediaTypes = []; // Nouveau: stocker les types de médias
      
      // Si on a un tableau 'medias' 
      if (AvisData.medias && Array.isArray(AvisData.medias)) {
        // Vérifier si c'est un format objet {type, path} ou des chaînes directes
        AvisData.medias.forEach(media => {
          if (typeof media === 'string') {
            mediaList.push(media);
            // Détecter le type par extension pour les chaînes
            if (media.includes('.mp4') || media.includes('.webm') || media.includes('.mov')) {
              mediaTypes.push('video/mp4');
            } else {
              mediaTypes.push('image/jpeg');
            }
          } else if (media.path) {
            mediaList.push(media.path);
            // Normaliser le type - s'assurer qu'il commence par video/ ou image/
            let normalizedType = media.type || 'image/jpeg';
            if (normalizedType === 'video') normalizedType = 'video/mp4';
            if (normalizedType === 'image') normalizedType = 'image/jpeg';
            mediaTypes.push(normalizedType);
          }
        });
      }
      // Si on a un tableau d'images (format images simple) 
      else if (AvisData.images && Array.isArray(AvisData.images)) {
        mediaList = AvisData.images;
        mediaTypes = AvisData.images.map(() => 'image/jpeg'); // Tous sont des images
      }
      
      if (mediaList.length > 0) {
        // Normaliser les chemins
        mediaList = mediaList.map(path => normalizeMediaPath(path));
        
        // Afficher l'image/vidéo principale
        const firstMedia = mediaList[0];
        const firstMediaType = mediaTypes[0];
        const mainContainer = document.querySelector('#review-detail-images .main-image-container');
        
        // Déterminer si c'est une vidéo ou une image
        if (firstMediaType && firstMediaType.startsWith('video/')) {
          // Pour les vidéos Pixeldrain (ou via proxy), utiliser un type MIME générique
          const isProxied = typeof firstMedia === 'string' && firstMedia.startsWith('/media/proxy');
          const mimeType = (isProxied || firstMedia.includes('pixeldrain.com')) ? 'video/mp4' : getVideoMimeType(firstMedia);
          mainContainer.innerHTML = `
            <video id="review-main-media" class="main-image" controls muted loop style="max-width: 100%; height: auto; object-fit: contain; border-radius: 8px;">
              <source src="${firstMedia}" type="${mimeType}">
              Votre navigateur ne supporte pas la lecture vidéo.
            </video>
          `;
          
          // Ajouter la logique de lecture automatique/au survol
          const video = document.getElementById('review-main-media');
          video.addEventListener('loadedmetadata', () => {
            console.log('[DEBUG] Durée vidéo principale:', video.duration, 'secondes');
            if (video.duration > 0 && video.duration < 3) {
              // Vidéo courte : lecture en boucle automatique
              video.autoplay = true;
              video.play().catch(e => console.log('[DEBUG] Autoplay échoué (principale):', e));
            } else {
              // Vidéo longue : lecture au survol
              video.addEventListener('mouseenter', () => {
                video.play().catch(e => console.log('[DEBUG] Play au survol échoué (principale):', e));
              });
              video.addEventListener('mouseleave', () => {
                video.pause();
                video.currentTime = 0;
              });
            }
          });
        } else {
          mainContainer.innerHTML = `
            <img id="review-main-media" class="main-image" src="${firstMedia}" alt="Image principale" onclick="openImageModal('${firstMedia}')" style="max-width: 100%; height: auto; object-fit: contain; border-radius: 8px;">
          `;
        }
        
        // Générer les miniatures avec support vidéo/image
        thumbnailsContainer.innerHTML = mediaList.map((mediaPath, index) => {
          const isVideo = mediaTypes[index] && mediaTypes[index].startsWith('video/');
          const isActive = index === 0 ? 'active' : '';
          
          if (isVideo) {
            return `
              <div class="thumbnail ${isActive}" onclick="changeReviewMainMedia('${mediaPath}', this, 'video')" style="position: relative; cursor: pointer;">
                <video src="${mediaPath}" muted loop preload="metadata" style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;" 
                       onloadedmetadata="handleThumbnailVideoLoad(this)"></video>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 12px; pointer-events: none;">▶</div>
              </div>
            `;
          } else {
            return `
              <img src="${mediaPath}" class="thumbnail ${isActive}" onclick="changeReviewMainMedia('${mediaPath}', this, 'image')" alt="Miniature ${index + 1}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; cursor: pointer;">
            `;
          }
        }).join('');
        
        imagesContainer.style.display = 'block';
      } else {
        imagesContainer.style.display = 'none';
      }
      
      // Afficher la modal
      openModal('review-detail-modal');
    }

    // Gestionnaire pour fermer la modal
    document.getElementById('close-review-detail-modal').addEventListener('click', function() {
      closeModal('review-detail-modal');
    });

    // Fermer en cliquant à côté
    document.getElementById('review-detail-modal').addEventListener('click', function(e) {
      if (e.target === this) {
        this.classList.remove('show');
      }
    });

    // Fonction pour changer le média principal dans la galerie des avis (images ET vidéos)
    function changeReviewMainMedia(mediaSrc, clickedThumbnail, mediaType) {
      const mainContainer = document.querySelector('#review-detail-images .main-image-container');
      const thumbnails = document.querySelectorAll('#review-thumbnails .thumbnail');
      
      // Changer le média principal selon le type
      if (mediaType === 'video') {
        const isProxied = typeof mediaSrc === 'string' && mediaSrc.startsWith('/media/proxy');
        const mimeType = isProxied ? 'video/mp4' : getVideoMimeType(mediaSrc);
        mainContainer.innerHTML = `
          <video id="review-main-media" class="main-image" controls style="max-width: 100%; height: auto; object-fit: contain; border-radius: 8px;">
            <source src="${mediaSrc}" type="${mimeType}">
            Votre navigateur ne supporte pas la lecture vidéo.
          </video>
        `;
      } else {
        mainContainer.innerHTML = `
          <img id="review-main-media" class="main-image" src="${mediaSrc}" alt="Image principale" onclick="openImageModal('${mediaSrc}')" style="max-width: 100%; height: auto; object-fit: contain; border-radius: 8px;">
        `;
      }
      
      // Mettre à jour l'état actif des miniatures
      thumbnails.forEach(thumb => thumb.classList.remove('active'));
      clickedThumbnail.classList.add('active');
    }

    // Garder l'ancienne fonction pour compatibilité
    function changeReviewMainImage(imageSrc, clickedThumbnail) {
      changeReviewMainMedia(imageSrc, clickedThumbnail, 'image');
    }

    // Fonction pour gérer le chargement des vidéos miniatures
    function handleThumbnailVideoLoad(video) {
      console.log('[DEBUG] Chargement miniature vidéo, durée:', video.duration, 'secondes');
      
      if (video.duration > 0 && video.duration < 3) {
        // Vidéo courte : lecture en boucle automatique
        video.autoplay = true;
        video.play().catch(e => console.log('[DEBUG] Autoplay miniature échoué:', e));
        console.log('[DEBUG] Miniature vidéo courte - lecture en boucle');
      } else {
        // Vidéo longue : lecture au survol
        const container = video.parentElement;
        container.addEventListener('mouseenter', () => {
          video.play().catch(e => console.log('[DEBUG] Play miniature au survol échoué:', e));
        });
        container.addEventListener('mouseleave', () => {
          video.pause();
          video.currentTime = 0;
        });
        console.log('[DEBUG] Miniature vidéo longue - lecture au survol');
      }
    }

    // Fonction pour gérer le chargement des vidéos principales
    function handleMainVideoLoad(video) {
      console.log('[DEBUG] Chargement vidéo principale, durée:', video.duration, 'secondes');
      
      if (video.duration > 0 && video.duration < 3) {
        // Vidéo courte : lecture en boucle automatique
        video.autoplay = true;
        video.play().catch(e => console.log('[DEBUG] Autoplay principal échoué:', e));
        console.log('[DEBUG] Vidéo principale courte - lecture en boucle');
      } else {
        // Vidéo longue : lecture au survol
        const container = video.closest('.product-card, .product-selection-image');
        if (container) {
          container.addEventListener('mouseenter', () => {
            video.play().catch(e => console.log('[DEBUG] Play principal au survol échoué:', e));
          });
          container.addEventListener('mouseleave', () => {
            video.pause();
            video.currentTime = 0;
          });
          console.log('[DEBUG] Vidéo principale longue - lecture au survol');
        }
      }
    }

    // Variable globale pour stocker les données de l'avis actuel
    let currentReviewData = null;

    // Fonction pour ouvrir le produit depuis la modale d'avis
    function openProductFromReview() {
      if (!currentReviewData || !currentReviewData.produit) return;
      
      // Chercher le produit dans la liste des articles
      const article = articlesData.find(art => art.nom === currentReviewData.produit);
      if (article) {
        // Fermer la modale d'avis détaillée
        const reviewDetailModal = document.getElementById('review-detail-modal');
        if (reviewDetailModal) {
          reviewDetailModal.classList.remove('show');
        }
        // Ouvrir la modale du produit (API existante)
        showProductModal(article);
      }
    }

    // Fonction d'affichage des Avis (nouvelle interface)
    function displayAvis(Avis) {
      const container = document.getElementById('products-grid-Avis');
      if (!container) return;
      
      container.innerHTML = '';
      
      if (!Avis || Avis.length === 0) {
        container.innerHTML = `
          <div style="grid-column: 1 / -1; text-align: center; color: rgba(255,255,255,0.7); padding: 40px;">
            <img src="img/_technique/icon/preuve.png" alt="Aucun avis" class="icon-white" style="width: 48px; height: 48px; margin-bottom: 16px; opacity: 0.5;">
            <p>Aucun avis client pour le moment</p>
          </div>
        `;
        return;
      }
      
      Avis.forEach((Avis, index) => {
        const reviewCard = document.createElement('div');
        reviewCard.className = 'review-card-compact';
        
        // Générer les étoiles (5 par défaut)
        const rating = Avis.rating || 5;
        const stars = '★'.repeat(rating) + '☆'.repeat(5 - rating);
        
        // Gérer l'affichage du nom utilisateur (nouveau format) - masquer si anonyme
        const clientName = Avis.username || Avis.client || '';
        const isAnonymous = Avis.isAnonymous || !clientName || clientName.trim() === '' || clientName.toLowerCase() === 'anonyme';
        const displayName = isAnonymous ? '' : clientName; // Ne pas afficher le nom si anonyme
        
        // Formatage de la date
        const date = Avis.date || new Date().toLocaleDateString('fr-FR');
        
        // Créer le HTML de la carte compacte
        reviewCard.innerHTML = `
          <div class="review-rating-compact">
            <span class="review-stars-compact">${stars}</span>
            <span class="review-rating-text-compact">(${rating}/5)</span>
          </div>
          
          ${Avis.titre ? `<h3 class="review-title-compact">${Avis.titre}</h3>` : ''}
          
          <div class="review-footer-compact">
            ${displayName ? `<span class="review-user-compact">${displayName}</span>` : ''}
            <span class="review-date-compact">${date}</span>
          </div>
        `;
        
        // Animation d'apparition décalée
        reviewCard.style.animationDelay = `${index * 0.1}s`;
        reviewCard.style.animation = 'fadeInUp 0.6s ease forwards';
        
        // Ajouter l'événement de clic pour ouvrir la modal
        reviewCard.addEventListener('click', () => {
          showReviewModal(Avis);
        });
        
        container.appendChild(reviewCard);
      });
    }

    // --- MODALES ANCIENNES (static-index.html) ---
    let currentProduct = { name: '', price: 0, qty: 0 };
    const cartModal = document.getElementById('cart-modal');
    const cartList = document.getElementById('cart-list');
    const cartModalTotal = document.getElementById('cart-modal-total');
    function showProductModal(item) {
      const modal = document.getElementById('product-modal');
      const title = document.getElementById('modal-title');
      const description = document.getElementById('modal-description');
      const img = document.getElementById('modal-img');
      const video = document.getElementById('modal-video');
      
      // Remplir infos produit
      currentProduct = {
        name: item.nom || item.name || '',
        price: item.prix || item.price || 0,
        qty: cart.find(p => p.name === (item.nom || item.name))?.qty || 0
      };
      
      // Stocker l'item actuel pour les variantes
      window.currentProductItem = item;
      window.currentSelectedVariante = null;
      
      // Calculer le prix final avant d'afficher le titre
      let displayPrice = currentProduct.price;
      if (item.reduction && item.reduction > 0) {
        if (item.reduction_type === 'percent') {
          displayPrice = currentProduct.price * (1 - item.reduction / 100);
        } else if (item.reduction_type === 'fixed') {
          displayPrice = Math.max(0, currentProduct.price - item.reduction);
        }
      }
      
      // Formater le prix sans zéros inutiles
      const formatPrice = (price) => {
        const formatted = parseFloat(price).toFixed(2);
        // Supprimer les zéros inutiles après la virgule
        return formatted.replace(/\.00$/, '').replace(/(\.\d)0$/, '$1');
      };
      
      title.textContent = `${currentProduct.name} - ${formatPrice(displayPrice)}€`;
      
      // Créer le HTML avec cart-controls AVANT la galerie
      let contentHtml = item.description || '';
      
      // Ajouter le sélecteur de variantes si disponible
      if (item.variantes && item.variantes.length > 0) {
        contentHtml += `
          <div style="margin: 15px 0; padding: 15px; background: rgba(107,5,114,0.3); border-radius: 8px; border: 1px solid rgba(255,211,105,0.3);">
            <label style="display:block; color:#ffd369; font-weight:600; margin-bottom:10px; font-size:1em;">
              🔀 Choisir une variante :
            </label>
            <select id="variante-selector" style="width:100%; padding:10px; border-radius:6px; background:rgba(46,0,79,0.6); color:#fff; border:2px solid rgba(255,211,105,0.5); font-size:0.95em; cursor:pointer;">
              <option value="-1">Version standard</option>
              ${item.variantes.map((v, idx) => `<option value="${idx}">${v.nom}</option>`).join('')}
            </select>
          </div>
        `;
      }
      
      // Calculer le prix avec réduction si applicable
      let finalPrice = currentProduct.price;
      let hasReduction = false;
      let reductionHtml = '';
      
      if (item.reduction && item.reduction > 0) {
        hasReduction = true;
        if (item.reduction_type === 'percent') {
          finalPrice = currentProduct.price * (1 - item.reduction / 100);
          reductionHtml = `
            <div style="margin-bottom:10px;">
              <span style="text-decoration:line-through;color:#888;font-size:0.9em;">${currentProduct.price.toFixed(2)}€</span>
              <span style="color:#ff6b6b;font-weight:700;font-size:1.2em;margin-left:10px;">${finalPrice.toFixed(2)}€</span>
              <span style="background:#ff6b6b;color:#fff;padding:2px 8px;border-radius:12px;font-size:0.8em;margin-left:8px;">-${item.reduction}%</span>
            </div>
          `;
        } else if (item.reduction_type === 'fixed') {
          finalPrice = Math.max(0, currentProduct.price - item.reduction);
          reductionHtml = `
            <div style="margin-bottom:10px;">
              <span style="text-decoration:line-through;color:#888;font-size:0.9em;">${currentProduct.price.toFixed(2)}€</span>
              <span style="color:#ff6b6b;font-weight:700;font-size:1.2em;margin-left:10px;">${finalPrice.toFixed(2)}€</span>
              <span style="background:#ff6b6b;color:#fff;padding:2px 8px;border-radius:12px;font-size:0.8em;margin-left:8px;">-${item.reduction.toFixed(2)}€</span>
            </div>
          `;
        }
      }
      
      // Mettre à jour le prix dans currentProduct pour le panier
      currentProduct.price = finalPrice;
      
      // Ajouter les contrôles panier en haut avec le style du site
      contentHtml += `
        <div id="cart-controls" style="margin: 15px 0; padding: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 6px; border: 1px solid rgba(255, 255, 255, 0.2); text-align: center;">
          ${reductionHtml}
          <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;">
            <span id="modal-item-total" style="display:none; background: rgba(142,245,142,0.2); color: #8ef58e; font-weight: 600; padding: 4px 10px; border-radius: 4px; font-size: 0.9em; border: 1px solid rgba(142,245,142,0.3);"></span>
            <div style="display:flex;align-items:center;gap:10px;">
              <button id="remove-one" style="display:none; background: #ff6b6b; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 14px; cursor: pointer;">
                <img src="img/_technique/icon/corebeille.png" alt="Supprimer" style="width: 14px; height: 14px;">
              </button>
              <span id="item-qty" style="display:none; background: #ffd369; color: #333; font-weight: bold; padding: 4px 12px; border-radius: 4px;">x1</span>
              <button id="add-to-cart" style="background: #ffd369; color: #333; border: none; padding: 8px 16px; border-radius: 6px; font-weight: bold; cursor: pointer;">
                <img src="img/_technique/icon/panier.png" alt="Panier" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 6px;"> Ajouter
              </button>
            </div>
          </div>
        </div>
      `;
      
      // Gérer les médias multiples - créer un tableau à partir de différents formats
      let mediaList = [];
      let mediaTypes = [];
      
      // Si on a un tableau 'medias' avec {type, path} (nouveau format)
      if (item.medias && Array.isArray(item.medias)) {
        mediaList = item.medias.map(media => media.path);
        mediaTypes = item.medias.map(media => {
          if (media.type === 'video') return 'video/mp4';
          if (media.type === 'image') return 'image/jpeg';
          return media.type || 'image/jpeg';
        });
        console.log('Format medias détecté:', item.medias);
      }
      // Si on a un tableau d'images (format images simple)
      else if (item.images && Array.isArray(item.images)) {
        mediaList = item.images;
        mediaTypes = item.images.map(() => 'image/jpeg'); // Défaut pour images
        console.log('Format images détecté:', item.images);
      }
      // Sinon utiliser image/video/thumbnail séparément
      else {
        // Ajouter l'image principale si elle existe
        if (item.image && item.image.trim()) {
          mediaList.push(item.image);
          mediaTypes.push('image/jpeg');
        }
        
        // Ajouter la vidéo si elle existe  
        if (item.video && item.video.trim()) {
          mediaList.push(item.video);
          mediaTypes.push('video/mp4');
        }
        
        // Ajouter le thumbnail si il existe et est différent des autres
        if (item.thumbnail && item.thumbnail.trim() && 
            !mediaList.includes(item.thumbnail)) {
          mediaList.push(item.thumbnail);
          mediaTypes.push('image/jpeg');
        }
        console.log('Format classique détecté, médias:', mediaList);
      }
      
      // Debug log temporaire
      console.log('Article:', item.nom, 'MediaList final:', mediaList);
      
      if (mediaList.length > 0) {
        contentHtml += '<div class="media-gallery">';
        
        // Média principal (le premier)
        const mainMedia = mediaList[0];
        const mainMediaPath = normalizeMediaPath(mainMedia);
        contentHtml += '<div class="main-media" id="main-media">';
        if (mediaTypes[0] && mediaTypes[0].startsWith('video/')) {
          contentHtml += `
            <video src="${mainMediaPath}" controls preload="metadata" style="width: 100%; max-height: 300px; object-fit: contain; border-radius: 8px;">
              Votre navigateur ne supporte pas la vidéo.
            </video>
          `;
        } else {
          contentHtml += `
            <img src="${mainMediaPath}" alt="${currentProduct.name}" style="width: 100%; max-height: 300px; object-fit: contain; border-radius: 8px;" />
          `;
        }
        contentHtml += '</div>';
        
        // Miniatures des autres médias (s'il y en a plusieurs)
        if (mediaList.length > 1) {
          contentHtml += `
            <div class="media-thumbnails" style="margin-top: 20px; padding: 12px; background: rgba(255, 255, 255, 0.1); border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.2);">
              <div style="margin-bottom: 10px; font-weight: 600; font-size: 15px; color: #fff; border-bottom: 1px solid rgba(255, 255, 255, 0.3); padding-bottom: 6px;">
                Voir tous les médias (${mediaList.length})
              </div>
              <div style="display: flex; gap: 8px; flex-wrap: wrap;">
          `;
          
          mediaList.forEach((mediaPath, index) => {
            const fullPath = normalizeMediaPath(mediaPath);
            const isActive = index === 0 ? 'active' : '';
            if (mediaTypes[index] && mediaTypes[index].startsWith('video/')) {
              contentHtml += `
                <div class="media-thumb ${isActive}" data-media-index="${index}" data-media-path="${fullPath}" data-media-type="video" 
                     style="position: relative; width: 70px; height: 70px; border-radius: 6px; overflow: hidden; cursor: pointer; 
                            border: 2px solid ${index === 0 ? '#ffd369' : 'rgba(255, 255, 255, 0.4)'}; transition: all 0.2s ease; background: rgba(255, 255, 255, 0.1);">
                  <video src="${fullPath}" muted style="width: 100%; height: 100%; object-fit: cover;">
                  </video>
                  <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 14px; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);">▶</div>
                </div>
              `;
            } else {
              contentHtml += `
                <div class="media-thumb ${isActive}" data-media-index="${index}" data-media-path="${fullPath}" data-media-type="image"
                     style="position: relative; width: 70px; height: 70px; border-radius: 6px; overflow: hidden; cursor: pointer; 
                            border: 2px solid ${index === 0 ? '#ffd369' : 'rgba(255, 255, 255, 0.4)'}; transition: all 0.2s ease; background: rgba(255, 255, 255, 0.1);">
                  <img src="${fullPath}" alt="Miniature ${index + 1}" style="width: 100%; height: 100%; object-fit: cover;" />
                  <div style="position: absolute; bottom: 2px; right: 2px; background: rgba(0,0,0,0.7); color: white; font-size: 9px; padding: 1px 3px; border-radius: 2px;">${index + 1}</div>
                </div>
              `;
            }
          });
          contentHtml += '</div></div>';
        }
        
        contentHtml += '</div>';
      }
      
      // Cacher les anciens éléments img/video
      img.style.display = 'none';
      video.style.display = 'none';
      
      // Injecter tout le contenu
      description.innerHTML = contentHtml;
      
      // Ajouter les event listeners pour les miniatures
      const thumbnails = description.querySelectorAll('.media-thumb');
      const mainMedia = description.querySelector('#main-media');
      
      console.log('Miniatures trouvées:', thumbnails.length, 'Élément main-media:', mainMedia);
      
      thumbnails.forEach((thumb, index) => {
        console.log('Ajout listener sur miniature', index, thumb.dataset);
        thumb.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          
          const mediaPath = thumb.dataset.mediaPath;
          const mediaType = thumb.dataset.mediaType;
          const mediaIndex = thumb.dataset.mediaIndex;
          
          console.log('Clic miniature:', { mediaPath, mediaType, mediaIndex });
          
          // Mettre à jour le média principal
          if (mediaType === 'video') {
            mainMedia.innerHTML = `
              <video src="${mediaPath}" controls preload="metadata" style="width: 100%; max-height: 300px; object-fit: contain; border-radius: 8px;">
                Votre navigateur ne supporte pas la vidéo.
              </video>
            `;
          } else {
            mainMedia.innerHTML = `
              <img src="${mediaPath}" alt="${currentProduct.name}" style="width: 100%; max-height: 300px; object-fit: contain; border-radius: 8px;" />
            `;
          }
          
          // Mettre à jour les bordures des miniatures
          thumbnails.forEach(t => t.style.border = '2px solid rgba(255, 255, 255, 0.4)');
          thumb.style.border = '2px solid #ffd369';
        });
        
        // Effet hover simple sur les miniatures
        thumb.addEventListener('mouseenter', () => {
          if (!thumb.style.border.includes('#ffd369')) {
            thumb.style.border = '2px solid rgba(255, 255, 255, 0.7)';
          }
        });
        
        thumb.addEventListener('mouseleave', () => {
          if (!thumb.style.border.includes('#ffd369')) {
            thumb.style.border = '2px solid rgba(255, 255, 255, 0.4)';
          }
        });
      });
      
      // Gérer le changement de variante
      const varianteSelector = document.getElementById('variante-selector');
      if (varianteSelector) {
        varianteSelector.addEventListener('change', function(e) {
          const varianteIndex = parseInt(e.target.value);
          
          if (varianteIndex === -1) {
            // Version standard - utiliser l'article original
            window.currentSelectedVariante = null;
            updateProductDisplayWithVariante(item, null);
          } else if (item.variantes && item.variantes[varianteIndex]) {
            // Variante sélectionnée
            window.currentSelectedVariante = item.variantes[varianteIndex];
            updateProductDisplayWithVariante(item, item.variantes[varianteIndex]);
          }
        });
      }
      
      updateQtyDisplay();
      closeModal('cart-modal');
      openModal('product-modal');
    }
    function updateProductDisplayWithVariante(baseItem, variante) {
      const description = document.getElementById('modal-description');
      const title = document.getElementById('modal-title');
      
      if (!description) return;
      
      // Mettre à jour le titre
      if (variante) {
        title.textContent = `${baseItem.nom} - ${variante.nom} - ${baseItem.prix}€`;
      } else {
        title.textContent = `${baseItem.nom} - ${baseItem.prix}€`;
      }
      
      // Déterminer quels médias afficher
      let mediaList = [];
      let mediaTypes = [];
      
      if (variante && variante.medias && variante.medias.length > 0) {
        // Utiliser les médias de la variante
        mediaList = variante.medias.map(media => media.path || media.url);
        mediaTypes = variante.medias.map(media => {
          if (media.type === 'video') return 'video/mp4';
          if (media.type === 'image') return 'image/jpeg';
          return media.type || 'image/jpeg';
        });
      } else {
        // Utiliser les médias du produit de base
        if (baseItem.medias && Array.isArray(baseItem.medias)) {
          mediaList = baseItem.medias.map(media => media.path);
          mediaTypes = baseItem.medias.map(media => {
            if (media.type === 'video') return 'video/mp4';
            if (media.type === 'image') return 'image/jpeg';
            return media.type || 'image/jpeg';
          });
        }
      }
      
      // Mettre à jour le média principal
      const mainMedia = description.querySelector('#main-media');
      if (mainMedia && mediaList.length > 0) {
        const mainMediaPath = normalizeMediaPath(mediaList[0]);
        if (mediaTypes[0] && mediaTypes[0].startsWith('video/')) {
          mainMedia.innerHTML = `
            <video src="${mainMediaPath}" controls preload="metadata" style="width: 100%; max-height: 300px; object-fit: contain; border-radius: 8px;">
              Votre navigateur ne supporte pas la vidéo.
            </video>
          `;
        } else {
          mainMedia.innerHTML = `
            <img src="${mainMediaPath}" alt="${baseItem.nom}" style="width: 100%; max-height: 300px; object-fit: contain; border-radius: 8px;" />
          `;
        }
      }
      
      // Mettre à jour la description si la variante en a une
      if (variante && variante.description) {
        // Trouver l'élément de description (premier paragraphe avant le sélecteur de variante)
        const descParts = description.innerHTML.split('<div style="margin: 15px 0');
        if (descParts.length > 0) {
          descParts[0] = variante.description;
          description.innerHTML = descParts.join('<div style="margin: 15px 0');
        }
      }
      
      // Mettre à jour les miniatures
      const thumbnailsContainer = description.querySelector('.media-thumbnails > div:last-child');
      if (thumbnailsContainer && mediaList.length > 1) {
        let thumbsHtml = '';
        mediaList.forEach((mediaPath, index) => {
          const fullPath = normalizeMediaPath(mediaPath);
          if (mediaTypes[index] && mediaTypes[index].startsWith('video/')) {
            thumbsHtml += `
              <div class="media-thumb ${index === 0 ? 'active' : ''}" data-media-index="${index}" data-media-path="${fullPath}" data-media-type="video" 
                   style="position: relative; width: 70px; height: 70px; border-radius: 6px; overflow: hidden; cursor: pointer; 
                          border: 2px solid ${index === 0 ? '#ffd369' : 'rgba(255, 255, 255, 0.4)'}; transition: all 0.2s ease; background: rgba(255, 255, 255, 0.1);">
                <video src="${fullPath}" muted style="width: 100%; height: 100%; object-fit: cover;"></video>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 14px; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);">▶</div>
              </div>
            `;
          } else {
            thumbsHtml += `
              <div class="media-thumb ${index === 0 ? 'active' : ''}" data-media-index="${index}" data-media-path="${fullPath}" data-media-type="image"
                   style="position: relative; width: 70px; height: 70px; border-radius: 6px; overflow: hidden; cursor: pointer; 
                          border: 2px solid ${index === 0 ? '#ffd369' : 'rgba(255, 255, 255, 0.4)'}; transition: all 0.2s ease; background: rgba(255, 255, 255, 0.1);">
                <img src="${fullPath}" alt="Miniature ${index + 1}" style="width: 100%; height: 100%; object-fit: cover;" />
                <div style="position: absolute; bottom: 2px; right: 2px; background: rgba(0,0,0,0.7); color: white; font-size: 9px; padding: 1px 3px; border-radius: 2px;">${index + 1}</div>
              </div>
            `;
          }
        });
        thumbnailsContainer.innerHTML = thumbsHtml;
        
        // Réattacher les event listeners
        const newThumbnails = thumbnailsContainer.querySelectorAll('.media-thumb');
        newThumbnails.forEach((thumb) => {
          thumb.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            const mediaPath = thumb.dataset.mediaPath;
            const mediaType = thumb.dataset.mediaType;
            
            if (mediaType === 'video') {
              mainMedia.innerHTML = `
                <video src="${mediaPath}" controls preload="metadata" style="width: 100%; max-height: 300px; object-fit: contain; border-radius: 8px;">
                  Votre navigateur ne supporte pas la vidéo.
                </video>
              `;
            } else {
              mainMedia.innerHTML = `
                <img src="${mediaPath}" alt="${baseItem.nom}" style="width: 100%; max-height: 300px; object-fit: contain; border-radius: 8px;" />
              `;
            }
            
            newThumbnails.forEach(t => t.style.border = '2px solid rgba(255, 255, 255, 0.4)');
            thumb.style.border = '2px solid #ffd369';
          });
        });
      }
    }
    
    function updateQtyDisplay() {
      const qtyDisplay = document.getElementById('item-qty');
      const removeOneBtn = document.getElementById('remove-one');
      const totalDisplay = document.getElementById('modal-item-total');
      if (!qtyDisplay || !removeOneBtn) return; // Vérifier que les éléments existent
      
      if (currentProduct.qty > 0) {
        qtyDisplay.style.display = 'inline';
        qtyDisplay.textContent = `x${currentProduct.qty}`;
        removeOneBtn.style.display = 'inline';
        
        // Calculer et afficher le total
        if (totalDisplay) {
          const itemTotal = currentProduct.price * currentProduct.qty;
          // Formater sans zéros inutiles
          const formatted = itemTotal.toFixed(2).replace(/\.00$/, '').replace(/(\.\d)0$/, '$1');
          totalDisplay.textContent = `Total: ${formatted}€`;
          totalDisplay.style.display = 'inline';
        }
      } else {
        qtyDisplay.style.display = 'none';
        removeOneBtn.style.display = 'none';
        if (totalDisplay) totalDisplay.style.display = 'none';
      }
    }
    // Délégation d'événements pour les boutons créés dynamiquement
    document.addEventListener('click', (e) => {
      if (e.target.id === 'add-to-cart') {
        if (!currentProduct.name || isNaN(currentProduct.price)) return;
        let existing = cart.find(p => p.name === currentProduct.name);
        if (existing) {
          existing.qty += 1;
        } else {
          cart.push({ name: currentProduct.name, price: currentProduct.price, qty: 1 });
        }
        currentProduct.qty += 1;
        updateQtyDisplay();
        updateCartUI();
      } else if (e.target.id === 'remove-one') {
        if (!currentProduct.name) return;
        let existing = cart.find(p => p.name === currentProduct.name);
        if (existing && existing.qty > 1) {
          existing.qty -= 1;
          currentProduct.qty -= 1;
        } else if (existing && existing.qty === 1) {
          cart.splice(cart.indexOf(existing), 1);
          currentProduct.qty = 0;
        }
        updateQtyDisplay();
        updateCartUI();
      }
    });
    function updateCartUI() {
      let total = 0;
      let totalItems = 0;
      cart.forEach(item => { 
        total += item.price * item.qty; 
        totalItems += item.qty;
      });
      
      const totalSpan = document.getElementById('cart-total');
      const labelSpan = document.getElementById('cart-label');
      const countSpan = document.getElementById('cart-count');
      
      // Le compteur est toujours visible
      countSpan.textContent = totalItems;
      
      if (total === 0) {
        labelSpan.style.display = 'none';
      } else {
        totalSpan.textContent = total.toFixed(2);
        labelSpan.style.display = 'block';
      }
    }
    // Fermeture modale produit
    document.querySelector('#product-modal .close').addEventListener('click', () => {
      closeModal('product-modal');
    });
    // Fermeture modale panier
    document.querySelector('#cart-modal .close').addEventListener('click', () => {
      closeModal('cart-modal');
    });

    // Bouton Commander Snapchat
    document.getElementById('commander-btn')?.addEventListener('click', () => {
      const cartItems = cart.map(item => `${item.name} (x${item.qty}) - ${(item.price * item.qty).toFixed(2)}€`).join('\n');
      const total = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
      const message = `🛒 Commande:\n${cartItems}\n\n💰 Total: ${total.toFixed(2)}€\n\nBonjour ! Je souhaite commander ces articles.`;
      const encodedMessage = encodeURIComponent(message);
      
      // Détection mobile pour Snapchat
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      const isMobile = /android|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent.toLowerCase());
      
      if (isMobile) {
        // Sur mobile, essayer d'ouvrir l'app Snapchat directement
        window.location.href = `snapchat://add/jvendtous`;
        // Fallback vers le navigateur si l'app n'est pas installée
        setTimeout(() => {
          window.open(`https://www.snapchat.com/add/jvendtous`, '_blank');
        }, 500);
      } else {
        // Sur desktop, ouvrir Snapchat web
        window.open(`https://www.snapchat.com/add/jvendtous`, '_blank');
      }
    });

    // Fermeture modale arnaqueur
    document.querySelector('#arnaqueur-modal .close').addEventListener('click', () => {
      closeModal('arnaqueur-modal');
    });

    // Fonction pour afficher la modale arnaqueur
    function showArnaqueurModal(arnaqueur) {
      const modal = document.getElementById('arnaqueur-modal');
      const title = document.getElementById('arnaqueur-modal-title');
      const username = document.getElementById('arnaqueur-username');
      const reseaux = document.getElementById('arnaqueur-reseaux');
      const techniques = document.getElementById('arnaqueur-techniques');
      const description = document.getElementById('arnaqueur-description');
      const mediasDiv = document.getElementById('arnaqueur-medias');
      const gallery = document.getElementById('arnaqueur-gallery');

      // Titre : soit le nom réel si disponible, soit "Arnaqueur anonyme"
      const displayName = arnaqueur.anonyme ? 'Arnaqueur anonyme' : (arnaqueur.nom && arnaqueur.nom.trim() ? arnaqueur.nom : 'Arnaqueur anonyme');
      title.textContent = displayName;

      // Informations
      username.textContent = arnaqueur.username || 'N/A';
      
      // Réseaux avec icônes
      if (arnaqueur.reseaux) {
        let reseauxHtml = '';
        const reseauxList = Array.isArray(arnaqueur.reseaux) ? arnaqueur.reseaux : arnaqueur.reseaux.split(', ');
        reseauxList.forEach(reseau => {
          const iconMap = {
            'Snapchat': 'img/_technique/icon/Snapchat.png',
            'Telegram': 'img/_technique/icon/telegram.png',
            'Discord': 'img/_technique/icon/discord.ico',
            'Instagram': 'img/_technique/icon/Instagram.png',
            'Facebook': 'img/_technique/icon/facebook.png',
            'WhatsApp': 'img/_technique/icon/whatsapp.png',
            'Anonyme': 'img/_technique/icon/anonyme.png'
          };
          const icon = iconMap[reseau.trim()] || '';
          if (icon) {
            reseauxHtml += `<img src="${icon}" alt="${reseau}" style="width: 24px; height: 24px; margin-right: 8px; vertical-align: middle;" title="${reseau}"> `;
          } else {
            reseauxHtml += `<span style="font-size: 0.9em; color: #ffd369; margin-right: 8px;" title="${reseau}">${reseau}</span> `;
          }
        });
        reseaux.innerHTML = reseauxHtml;
      } else {
        reseaux.textContent = 'N/A';
      }

      techniques.textContent = arnaqueur.techniques || 'N/A';
      description.innerHTML = arnaqueur.description || 'Aucune description disponible.';

      // Gérer les médias s'il y en a
      if (arnaqueur.medias && arnaqueur.medias.length > 0) {
        mediasDiv.style.display = 'block';
        gallery.innerHTML = '';
        arnaqueur.medias.forEach(media => {
          const mediaPath = normalizeMediaPath(media.path || media);
          const mediaType = media.type || (typeof media === 'string' ? 'image/jpeg' : 'video/mp4');
          const mediaElement = document.createElement('div');
          mediaElement.style.margin = '10px 0';
          
          if (mediaType.startsWith('video/')) {
            mediaElement.innerHTML = `
              <video src="${mediaPath}" controls style="max-width: 100%; border-radius: 8px;">
                Votre navigateur ne supporte pas la vidéo.
              </video>
            `;
          } else {
            mediaElement.innerHTML = `
              <img src="${mediaPath}" alt="Avis" style="max-width: 100%; border-radius: 8px;" />
            `;
          }
          gallery.appendChild(mediaElement);
        });
      } else {
        mediasDiv.style.display = 'none';
      }

      // Afficher la modale
      openModal('arnaqueur-modal');
    }
    // Affichage modale panier
    window.onload = () => {
      const cartButton = document.getElementById('cart-button');
      cartButton.addEventListener('click', () => {
        updateCartModal();
        closeModal('product-modal');
        openModal('cart-modal');
      });
      document.getElementById('cart-label').style.display = 'none';
    };
    function updateCartModal() {
      cartList.innerHTML = '';
      let total = 0;
      cart.forEach(item => {
        const li = document.createElement('li');
        li.style.cssText = 'display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid rgba(255,255,255,0.1);';
        
        // Image du produit à gauche (thumbnail ou première image)
        const icon = document.createElement('img');
        
        // Trouver l'article complet pour récupérer son image
        const fullArticle = articlesData.find(a => a.nom === item.name || a.id === item.id);
        let imageSrc = 'img/_technique/icon/produit.png'; // Fallback
        
        if (fullArticle) {
          // Priorité : thumbnail > première image des medias > image
          if (fullArticle.thumbnail) {
            imageSrc = fullArticle.thumbnail;
          } else if (fullArticle.medias && fullArticle.medias.length > 0) {
            const firstImage = fullArticle.medias.find(m => m.type === 'image' || (m.mime_type && m.mime_type.startsWith('image/')));
            if (firstImage) {
              imageSrc = firstImage.path || firstImage.url;
            }
          } else if (fullArticle.image) {
            imageSrc = fullArticle.image;
          }
        }
        
        icon.src = imageSrc;
        icon.alt = item.name;
        icon.style.cssText = 'width:50px;height:50px;object-fit:cover;border-radius:8px;flex-shrink:0;border:2px solid rgba(255,211,105,0.3);';
        
        // Nom du produit (qui prend l'espace disponible)
        const nameDiv = document.createElement('div');
        nameDiv.style.cssText = 'flex:1;font-weight:600;color:#fff;';
        nameDiv.textContent = item.name;
        
        // Quantité visible avec badge
        const qtyBadge = document.createElement('div');
        qtyBadge.style.cssText = 'background:rgba(142,245,142,0.3);color:#8ef58e;padding:4px 12px;border-radius:12px;font-weight:700;font-size:1.1em;min-width:40px;text-align:center;';
        qtyBadge.textContent = `×${item.qty}`;
        
        // Boutons de contrôle à droite
        const controls = document.createElement('div');
        controls.style.cssText = 'display:flex;gap:6px;';
        
        const minus = document.createElement('button');
        minus.textContent = '−';
        minus.style.cssText = 'width:32px;height:32px;border-radius:6px;background:#dc3545;color:#fff;border:none;cursor:pointer;font-size:1.2em;font-weight:700;display:flex;align-items:center;justify-content:center;';
        minus.onclick = () => {
          item.qty -= 1;
          if (item.qty <= 0) cart.splice(cart.indexOf(item), 1);
          updateCartUI();
          updateCartModal();
        };
        
        const plus = document.createElement('button');
        plus.textContent = '+';
        plus.style.cssText = 'width:32px;height:32px;border-radius:6px;background:#28a745;color:#fff;border:none;cursor:pointer;font-size:1.2em;font-weight:700;display:flex;align-items:center;justify-content:center;';
        plus.onclick = () => {
          item.qty += 1;
          updateCartUI();
          updateCartModal();
        };
        
        controls.appendChild(minus);
        controls.appendChild(plus);
        
        li.appendChild(icon);
        li.appendChild(nameDiv);
        li.appendChild(qtyBadge);
        li.appendChild(controls);
        cartList.appendChild(li);
        total += item.qty * item.price;
      });
      cartModalTotal.textContent = total.toFixed(2);
    }

    // Fonction pour ajouter au panier
    function addToCart(id) {
      const article = articlesData.find(a => a.id === id);
      if (article) {
        // Vérifier si l'article existe déjà dans le panier
        const existingItem = cart.find(item => item.name === article.nom);
        if (existingItem) {
          // Augmenter la quantité
          existingItem.qty = (existingItem.qty || 1) + 1;
        } else {
          // Ajouter nouvel article avec quantité 1
          cart.push({
            name: article.nom,
            price: article.prix,
            qty: 1
          });
        }
        updateCartUI();
      } else {
        console.error('Article non trouvé avec l\'ID:', id);
      }
    }

    // Augmenter/diminuer/supprimer du panier
    function increaseQuantity(name) {
      const item = cart.find(item => item.name === name);
      if (item) {
        item.qty = (item.qty || 1) + 1;
        updateCartUI();
        updateCartModal();
      }
    }

    function decreaseQuantity(name) {
      const item = cart.find(item => item.name === name);
      if (item && item.qty > 1) {
        item.qty--;
        updateCartUI();
        updateCartModal();
      } else if (item && item.qty === 1) {
        removeFromCart(name);
      }
    }

    function removeFromCart(name) {
      const index = cart.findIndex(item => item.name === name);
      if (index > -1) {
        cart.splice(index, 1);
        updateCartUI();
        updateCartModal();
      }
    }

    // Calculer le prix en fonction des paliers de quantité
    function calculatePriceWithTiers(item, quantity) {
      // Si l'article a des paliers de quantité
      if (item.reduction_type === 'quantity' && item.quantity_tiers && item.quantity_tiers.length > 0) {
        // Trier les paliers par quantité décroissante pour trouver le meilleur match
        const sortedTiers = [...item.quantity_tiers].sort((a, b) => b.quantity - a.quantity);
        
        console.log(`[Calcul] Article: ${item.nom}, Quantité: ${quantity}, Paliers:`, sortedTiers);
        
        // Trouver le palier applicable (le plus élevé qui est <= à la quantité)
        for (const tier of sortedTiers) {
          if (quantity >= tier.quantity) {
            console.log(`[Calcul] Palier trouvé: ${tier.quantity} articles = ${tier.price}€ total`);
            // Le prix dans tier.price est le PRIX TOTAL pour cette quantité
            return tier.price;
          }
        }
        
        // Si aucun palier ne correspond, utiliser le prix de base * quantité
        console.log(`[Calcul] Aucun palier applicable, prix de base: ${item.prix}€ × ${quantity}`);
        return (item.prix || 0) * quantity;
      }
      
      // Sinon, calculer normalement avec réduction classique
      return (item.prix || 0) * quantity;
    }

    // Mettre à jour l'affichage du panier
    function updateCartDisplay() {
      const cartItems = document.getElementById('cart-items');
      const cartTotal = document.getElementById('cart-total');
      
      if (!cartItems || !cartTotal) return;
      
      cartItems.innerHTML = '';
      let total = 0;
      
      if (cart.length === 0) {
        cartItems.innerHTML = '<p style="text-align:center;color:#8ef58e;padding:2rem;">Votre panier est vide</p>';
      } else {
        cart.forEach((item) => {
          const quantity = item.quantity || 1;
          const itemTotal = calculatePriceWithTiers(item, quantity);
          total += itemTotal;
          
          // Calculer le prix unitaire effectif (avec palier)
          let unitPrice = item.prix;
          let priceInfo = `${item.prix}€/unité`;
          
          if (item.reduction_type === 'quantity' && item.quantity_tiers && item.quantity_tiers.length > 0) {
            const sortedTiers = [...item.quantity_tiers].sort((a, b) => b.quantity - a.quantity);
            for (const tier of sortedTiers) {
              if (quantity >= tier.quantity) {
                // Calculer le prix unitaire effectif : prix total / quantité
                unitPrice = tier.price / tier.quantity;
                priceInfo = `${unitPrice.toFixed(2)}€/unité (palier ${tier.quantity}+ = ${tier.price}€)`;
                break;
              }
            }
          }
          
          const cartItem = document.createElement('div');
          cartItem.className = 'cart-item';
          cartItem.innerHTML = `
            <div class="cart-item-details">
              <span class="item-name">${item.nom}</span>
              <div class="item-pricing">
                <span class="unit-price">${priceInfo}</span>
                <span class="total-price">${itemTotal.toFixed(2)}€</span>
              </div>
            </div>
            <div class="quantity-controls">
              <button class="qty-btn" onclick="decreaseQuantity('${item.id}')" ${quantity <= 1 ? 'disabled' : ''}>-</button>
              <span class="quantity">${quantity}</span>
              <button class="qty-btn" onclick="increaseQuantity('${item.id}')">+</button>
              <button class="remove-btn" onclick="removeFromCart('${item.id}')"><img src="img/_technique/icon/corebeille.png" alt="Supprimer" style="width: 14px; height: 14px;"></button>
            </div>
          `;
          cartItems.appendChild(cartItem);
        });
      }
      
      cartTotal.textContent = `Total: ${total}€`;
    }

    // Fonction de recherche et filtrage
    function applyFilters() {
      // Utiliser les données filtrées par catégorie si applicable
      let filteredData = getCurrentFilteredData();

      // Filtre par texte de recherche selon la section
      const searchInput = document.getElementById(`search-input${currentSection === 'articles' ? '' : '-' + currentSection}`);
      if (searchInput) {
        const searchText = searchInput.value.toLowerCase().trim();
        if (searchText) {
          if (currentSection === 'arnaques') {
            // Pour les arnaques, chercher dans nom et username
            filteredData = filteredData.filter(item => 
              (item.nom || '').toLowerCase().includes(searchText) || 
              (item.username || '').toLowerCase().includes(searchText) ||
              (item.description || '').toLowerCase().includes(searchText) ||
              (item.techniques || '').toLowerCase().includes(searchText)
            );
          } else {
            // Pour les autres sections, chercher dans nom et description
            filteredData = filteredData.filter(item => 
              (item.nom || item.name || item.titre || '').toLowerCase().includes(searchText) || 
              (item.description || '').toLowerCase().includes(searchText)
            );
          }
        }
      }

      // Filtres par prix (seulement pour articles et offres)
      if (currentSection === 'articles' || currentSection === 'offres') {
        const minPrice = parseFloat(document.getElementById('min-price')?.value) || 0;
        const maxPrice = parseFloat(document.getElementById('max-price')?.value) || Infinity;
        
        filteredData = filteredData.filter(item => {
          const price = item.prix || item.price || 0;
          return price >= minPrice && price <= maxPrice;
        });
      }

      // Afficher les résultats filtrés
      switch(currentSection) {
        case 'articles':
          displayArticles(filteredData);
          break;
        case 'offres':
          displayOffres(filteredData);
          break;
        case 'arnaques':
          displayArnaques(filteredData);
          break;
        case 'Avis':
          displayAvis(filteredData);
          break;
        case 'annonces':
          // Filtrage basique sur titre/message
          const input = document.getElementById('search-input-annonces');
          if(input){
            const q = input.value.toLowerCase();
            const subset = annoncesData.filter(a=> (a.titre||'').toLowerCase().includes(q) || (a.message||'').toLowerCase().includes(q));
            // Mise à jour data temporaire pour rendu
            const original = annoncesData;
            annoncesData = subset;
            renderAnnonces();
            annoncesData = original;
          } else {
            renderAnnonces();
          }
          break;
      }
    }

    // Fonction de changement de section
    function showSection(sectionName) {
      // Masquer toutes les sections
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
      });
      
      // Retirer la classe active de tous les boutons
      document.querySelectorAll('#sidebar button, .menu-horizontal button, .banner-nav button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Afficher la section demandée
      const targetSection = document.getElementById(sectionName + '-section');
      if (targetSection) {
        targetSection.classList.add('active');
        currentSection = sectionName;
        
        // Ajouter la classe active aux boutons correspondants
        document.querySelectorAll(`#menu-${sectionName}, #menu-${sectionName}-desktop, #banner-${sectionName}`).forEach(btn => {
          btn.classList.add('active');
        });
        
        // Réinitialiser les filtres
        window.currentCategoryFilter = null;
        
        // Charger les données de la section
        loadSectionData();
        
        // Fermer le menu mobile
        closeSidebar();
      }
    }

    // Système de gestion des modales (une seule ouverte à la fois par côté)
    const leftSideModals = []; // Plus de modales à gauche
    const rightSideModals = ['product-modal', 'cart-modal', 'arnaqueur-modal', 'category-modal', 'filter-modal', 'add-review-modal', 'product-selection-modal', 'review-detail-modal'];
    const specialModals = ['media-selection-modal']; // Peut rester ouverte avec d'autres

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.remove('show');
        modal.classList.add('hidden');
      }
    }

    function openModal(modalId) {
      const modal = document.getElementById(modalId);
      if (!modal) return;

      // Ne pas fermer les autres modales si c'est une modal spéciale
      if (!specialModals.includes(modalId)) {
        // Déterminer le côté de la modal
        let isLeftSide = leftSideModals.includes(modalId);
        let isRightSide = rightSideModals.includes(modalId);

        // Fermer les autres modales du même côté
        if (isLeftSide) {
          leftSideModals.forEach(id => {
            if (id !== modalId) closeModal(id);
          });
        } else if (isRightSide) {
          rightSideModals.forEach(id => {
            // Exception: ne pas fermer add-review-modal si product-selection-modal s'ouvre
            if (id !== modalId && !(modalId === 'product-selection-modal' && id === 'add-review-modal')) {
              closeModal(id);
            }
          });
        }
      }

      // Ouvrir la modal demandée
      modal.classList.remove('hidden');
      modal.classList.add('show');
    }

    // Fonctions pour le menu mobile
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('open');
    }

    function closeSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.remove('open');
    }

    // Fonction pour soumettre un avis
    async function submitReview(reviewData) {
      try {
        const response = await fetch('/api/avis-pending', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(reviewData)
        });
        
        if (response.ok) {
          // Suppression popup succès (remplacée par log)
          console.log('Avis soumis (succès) – notification popup désactivée.');
          closeModal('add-review-modal');
          document.getElementById('add-review-form').reset();
          selectedRating = 5;
          updateStars();
          // Recharger le compteur d'avis en attente
          if (currentSection === 'Avis') {
            loadPendingCountBadge();
          }
        } else {
          alert('Erreur lors de la soumission de l\'avis. Veuillez réessayer.');
        }
      } catch (error) {
        console.error('Erreur:', error);
        alert('Erreur de connexion. Veuillez réessayer.');
      }
    }

    // Fonction pour mettre à jour l'affichage des étoiles
    function updateStars() {
      const stars = document.querySelectorAll('.rating-star');
      stars.forEach((star, index) => {
        if (index < selectedRating) {
          star.style.color = '#ffd369';
          star.classList.add('active');
        } else {
          star.style.color = 'rgba(255, 255, 255, 0.3)';
          star.classList.remove('active');
        }
      });
    }

    // Refonte: gestion des catégories avec navigation par niveaux
    let categories = [];
    let catNavStack = []; // chaque entrée: { name, children }

    async function loadCategories(section = 'articles') {
      if (section === 'arnaques') {
        alert('Les catégories d\'arnaques ont été supprimées. Utilisez le tri et la recherche.');
        return;
      }
      try {
        const url = '/api/categories';
        const resp = await fetch(url);
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        categories = await resp.json();
        catNavStack = [{ name: 'Toutes', children: categories }];
        openCategoryModal();
        renderCategoryLevel();
      } catch (e) {
        console.error('Erreur catégories:', e);
        alert('Erreur chargement catégories: ' + e.message);
      }
    }

    function openCategoryModal() {
      openModal('category-modal');
    }

    function closeCategoryModal() {
      closeModal('category-modal');
    }

    // Rendu du niveau courant + breadcrumbs
    function renderCategoryLevel() {
      const crumbs = document.getElementById('cat-breadcrumbs');
      const list = document.getElementById('cat-list');
      if (!crumbs || !list) return;

      // Breadcrumbs
      crumbs.innerHTML = '';
      catNavStack.forEach((node, idx) => {
        const crumb = document.createElement('span');
        crumb.className = 'cat-crumb' + (idx === catNavStack.length - 1 ? ' active' : '');
        crumb.textContent = node.name;
        crumb.addEventListener('click', () => {
          if (idx < catNavStack.length - 1) {
            catNavStack = catNavStack.slice(0, idx + 1);
            renderCategoryLevel();
          }
        });
        crumbs.appendChild(crumb);
        if (idx < catNavStack.length - 1) {
          const sep = document.createElement('span');
          sep.className = 'cat-sep';
          sep.textContent = '›';
          crumbs.appendChild(sep);
        }
      });

      // Liste
      list.innerHTML = '';
      const current = catNavStack[catNavStack.length - 1];
      (current.children || []).forEach(child => {
        const li = document.createElement('li');
        li.className = 'cat-item';
        const name = document.createElement('div');
        name.className = 'cat-name';
        name.innerHTML = `<span>📁</span><span>${child.name}</span>`;
        const actions = document.createElement('div');
        actions.className = 'cat-actions';

        const hasChildren = child.children && child.children.length > 0;
        if (hasChildren) {
          const openBtn = document.createElement('button');
          openBtn.className = 'cat-btn';
          openBtn.textContent = 'Ouvrir';
          openBtn.addEventListener('click', () => {
            catNavStack.push({ name: child.name, children: child.children });
            renderCategoryLevel();
          });
          actions.appendChild(openBtn);
        }

        const selectBtn = document.createElement('button');
        selectBtn.className = 'cat-btn select';
        selectBtn.textContent = 'Choisir';
        selectBtn.addEventListener('click', () => {
          // Construire le chemin complet sélectionné
          const fullPath = catNavStack
            .map(n => n.name)
            .filter(n => n !== 'Toutes')
            .concat(child.name)
            .join('/');
          filterByCategory(child.name, fullPath.split('/'));
          closeCategoryModal();
        });
        actions.appendChild(selectBtn);

        li.appendChild(name);
        li.appendChild(actions);
        list.appendChild(li);
      });
    }

    // Charger les produits pour le formulaire d'avis
    function loadProductsForReview() {
      // Ancienne implémentation supprimée: le champ #review-produit est un input hidden.
      // La sélection de produit se fait via la modale "product-selection-modal" et la fonction selectProduct().
      return;
    }

    // Filtrer par catégorie
  function filterByCategory(categoryName, fullPath = null) {
      console.log('🏷️ Filtrage par catégorie:', categoryName);
      console.log('🗺️ Chemin complet:', fullPath);
      
      // Mettre à jour le titre de la section
  const sectionEl = document.getElementById(`${currentSection}-section`);
  const sectionTitle = sectionEl ? sectionEl.querySelector('h2') : null;
      if (sectionTitle) {
  const displayPath = Array.isArray(fullPath) ? fullPath.join(' > ') : categoryName;
  sectionTitle.textContent = `${currentSection.charAt(0).toUpperCase() + currentSection.slice(1)} - ${displayPath}`;
      }
      
      // Construire le chemin de catégorie attendu
      let targetPath = '';
      if (fullPath && Array.isArray(fullPath)) {
        targetPath = fullPath.join('/');
      } else {
        targetPath = categoryName;
      }
      
      console.log('🎯 Chemin cible:', targetPath);
      
      // Filtrer les articles par catégorie EXACTE
      const filteredArticles = articlesData.filter(article => {
        if (!article.categorie) return false;
        
        // Correspondance exacte du chemin complet
        const isExactMatch = article.categorie === targetPath;
        
        // Correspondance si l'article est dans une sous-catégorie du chemin ciblé
        const isInSubcategory = article.categorie.startsWith(targetPath + '/');
        
        console.log(`📄 Article "${article.nom}": catégorie="${article.categorie}", cible="${targetPath}", exacte=${isExactMatch}, sous-cat=${isInSubcategory}`);
        
        return isExactMatch || isInSubcategory;
      });
      
      console.log(`🔍 ${filteredArticles.length} articles trouvés dans la catégorie "${targetPath}"`);
      
      // Afficher les articles filtrés
      displayArticles(filteredArticles);
      
      // Sauvegarder le filtre actuel
      window.currentCategoryFilter = targetPath;
      window.currentCategoryPath = fullPath;
    }

    // Fonction pour réinitialiser les filtres et afficher tous les articles
    function clearCategoryFilter() {
      console.log('🔄 Réinitialisation du filtre catégorie');
      
      // Réinitialiser le titre
  const sectionEl = document.getElementById(`${currentSection}-section`);
  const sectionTitle = sectionEl ? sectionEl.querySelector('h2') : null;
      if (sectionTitle) {
  sectionTitle.textContent = currentSection.charAt(0).toUpperCase() + currentSection.slice(1);
      }
      
      // Afficher tous les articles
      displayArticles(articlesData);
      
      // Supprimer le filtre actuel
      window.currentCategoryFilter = null;
      window.currentCategoryPath = null;
    }

    // Fonction pour obtenir les données de base selon la section courante
    function getBaseSectionData() {
      switch(currentSection) {
        case 'articles':
          return [...articlesData];
        case 'offres':
          return [...offresData];
        case 'arnaques':
          return [...arnaquesData];
        case 'Avis':
          return [...AvisData];
        default:
          return [];
      }
    }

    // Fonction pour obtenir les données filtrées par catégorie si applicable
    function getCurrentFilteredData() {
      let data = getBaseSectionData();
      
      // Appliquer le filtre de catégorie si actif (uniquement pour les articles)
      if (currentSection === 'articles' && window.currentCategoryFilter) {
        data = data.filter(item => {
          if (!item.categorie) return false;
          
          // Recherche exacte par nom
          if (item.categorie === window.currentCategoryFilter) return true;
          
          // Recherche dans le chemin complet si disponible
          if (window.currentCategoryPath) {
            return window.currentCategoryPath.some(pathPart => 
              item.categorie.includes(pathPart) || 
              pathPart.includes(item.categorie)
            );
          }
          
          // Recherche par inclusion partielle
          return item.categorie.includes(window.currentCategoryFilter) || 
                 window.currentCategoryFilter.includes(item.categorie);
        });
      }
      
      return data;
    }

    // Initialisation au chargement de la page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOMContentLoaded - Initialisation...');
        // Initialisation menu mobile consolidé
        (function initMobileMenus(){
          const sectionConfigs = [
            { section:'articles', panel:'#mobile-menu-panel-articles', ids:['category-button','sort-button','filter-button','cart-button'] },
            { section:'offres', panel:'#mobile-menu-panel-offres', ids:['sort-button-offres','category-button-offres','filter-button-offres'] },
            { section:'arnaques', panel:'#mobile-menu-panel-arnaques', ids:['sort-button-arnaques'] },
            { section:'Avis', panel:'#mobile-menu-panel-Avis', ids:['sort-button-Avis','category-button-Avis','add-review-btn'] }
          ];

          function moveButtonsIfMobile(){
            const isMobile = window.matchMedia('(max-width:760px)').matches;
            sectionConfigs.forEach(cfg=>{
              const panel = document.querySelector(cfg.panel);
              if(!panel) return;
              if(isMobile){
                // remplir panel si vide
                if(panel.childElementCount===0){
                  cfg.ids.forEach(id=>{
                    const el = document.getElementById(id);
                    if(el){
                      // Pour les dropdowns, déplacer le parent .sort-dropdown entier
                      const dropdown = el.closest('.sort-dropdown');
                      if(dropdown && !panel.contains(dropdown)) panel.appendChild(dropdown);
                      else if(!dropdown && !panel.contains(el)) panel.appendChild(el);
                    }
                  });
                }
              } else {
                // remettre les éléments dans leur .controls d'origine
                if(panel.childElementCount>0){
                  const controls = panel.closest('.controls');
                  if(controls){
                    // insérer après le wrapper mobile
                    const wrapper = controls.querySelector('.mobile-menu-wrapper');
                    [...panel.children].forEach(child=>{
                      if(child.classList.contains('sort-dropdown')){
                        controls.insertBefore(child, wrapper.nextSibling);
                      } else {
                        controls.appendChild(child);
                      }
                    });
                  }
                  panel.innerHTML='';
                }
              }
            });
          }

          moveButtonsIfMobile();
          window.addEventListener('resize',()=>{
            moveButtonsIfMobile();
          });

          // Gestion toggles
          document.querySelectorAll('.mobile-menu-toggle').forEach(btn=>{
            btn.addEventListener('click',()=>{
              const panel = btn.parentElement.querySelector('.mobile-menu-panel');
              const open = panel.classList.toggle('open');
              btn.setAttribute('aria-expanded', open?'true':'false');
              // fermer autres
              if(open){
                document.querySelectorAll('.mobile-menu-panel').forEach(p=>{ if(p!==panel) p.classList.remove('open'); });
                document.querySelectorAll('.mobile-menu-toggle').forEach(b=>{ if(b!==btn) b.setAttribute('aria-expanded','false'); });
              }
            });
          });

          // fermeture clic extérieur
          document.addEventListener('click', (e)=>{
            if(!e.target.closest('.mobile-menu-wrapper')){
              document.querySelectorAll('.mobile-menu-panel.open').forEach(p=>p.classList.remove('open'));
              document.querySelectorAll('.mobile-menu-toggle[aria-expanded="true"]').forEach(b=>b.setAttribute('aria-expanded','false'));
            }
          });
        })();
      
      // Gestion du menu hamburger
      const hamburger = document.getElementById('hamburger');
      const sidebar = document.getElementById('sidebar');
      
      hamburger.addEventListener('click', toggleSidebar);
      
      // Gestion des boutons de menu (mobile)
      document.getElementById('menu-articles')?.addEventListener('click', () => showSection('articles'));
      document.getElementById('menu-offres')?.addEventListener('click', () => showSection('offres'));
      document.getElementById('menu-arnaques')?.addEventListener('click', () => showSection('arnaques'));
      document.getElementById('menu-Avis')?.addEventListener('click', () => showSection('Avis'));
  // Annonces (mobile)
  document.getElementById('menu-annonces')?.addEventListener('click', () => showSection('annonces'));
      
      // Gestion des boutons de menu (desktop)
      document.getElementById('menu-articles-desktop')?.addEventListener('click', () => showSection('articles'));
      document.getElementById('menu-offres-desktop')?.addEventListener('click', () => showSection('offres'));
      document.getElementById('menu-arnaques-desktop')?.addEventListener('click', () => showSection('arnaques'));
      document.getElementById('menu-Avis-desktop')?.addEventListener('click', () => showSection('Avis'));
  // Annonces (desktop)
  document.getElementById('menu-annonces-desktop')?.addEventListener('click', () => showSection('annonces'));
      
      // Gestion des nouveaux boutons du banner
      document.getElementById('banner-articles')?.addEventListener('click', () => showSection('articles'));
      document.getElementById('banner-offres')?.addEventListener('click', () => showSection('offres'));
      document.getElementById('banner-arnaques')?.addEventListener('click', () => showSection('arnaques'));
      document.getElementById('banner-Avis')?.addEventListener('click', () => showSection('Avis'));
  // Annonces (banner)
  document.getElementById('banner-annonces')?.addEventListener('click', () => showSection('annonces'));
  // Infos (banner)
  document.getElementById('banner-infos')?.addEventListener('click', () => showSection('infos'));
      // Bouton actualiser annonces
      document.getElementById('annonces-refresh')?.addEventListener('click', ()=>{
        loadAnnoncesAndMessagesAvis();
      });
      
      // Gestion des boutons de contrôle
      // Gestion des boutons de catégories pour toutes les sections
      document.getElementById('category-button').addEventListener('click', () => {
        console.log('🖱️ Clic sur le bouton catégories Articles');
        loadCategories('articles');
      });
      
      // Ajouter event listeners pour les autres boutons de catégories s'ils existent
      const categoryBtnOffres = document.getElementById('category-button-offres');
      if (categoryBtnOffres) {
        categoryBtnOffres.addEventListener('click', () => {
          console.log('🖱️ Clic sur le bouton catégories Offres');
          loadCategories('offres'); // Utilise les mêmes catégories qu'Articles
        });
      }
      
      // Catégories arnaques supprimées
      
      const categoryBtnAvis = document.getElementById('category-button-Avis');
      if (categoryBtnAvis) {
        categoryBtnAvis.addEventListener('click', () => {
          console.log('🖱️ Clic sur le bouton catégories Avis');
          loadCategories('Avis'); // Utilise les mêmes catégories qu'Articles
        });
      }

      // Bouton de fermeture de la modal catégories (nouvelle implémentation)
      const closeCatBtn = document.getElementById('close-category-modal');
      if (closeCatBtn) closeCatBtn.addEventListener('click', () => {
        closeModal('category-modal');
      });
      
      // Gestion des dropdowns de tri
      function initSortDropdowns() {
        // Pour chaque dropdown de tri
        document.querySelectorAll('.sort-dropdown').forEach(dropdown => {
          const button = dropdown.querySelector('.control-btn');
          const options = dropdown.querySelector('.sort-options');
          
          // Toggle dropdown
          button.addEventListener('click', (e) => {
            e.stopPropagation();
            // Fermer les autres dropdowns
            document.querySelectorAll('.sort-dropdown').forEach(other => {
              if (other !== dropdown) other.classList.remove('active');
            });
            dropdown.classList.toggle('active');
          });
          
          // Gérer les options de tri
          options.querySelectorAll('.sort-option').forEach(option => {
            option.addEventListener('click', (e) => {
              e.stopPropagation();
              
              // Marquer comme actif
              options.querySelectorAll('.sort-option').forEach(opt => opt.classList.remove('active'));
              option.classList.add('active');
              
              // Exécuter le tri
              const sortType = option.dataset.sort;
              const sectionContainer = dropdown.closest('.content-section');
              const section = sectionContainer ? sectionContainer.id.replace('-section','') : currentSection;
              applySorting(section, sortType);
              
              // Fermer le dropdown
              dropdown.classList.remove('active');
              // Si on est en mode mobile (panneau ouvert), fermer aussi le panneau menu
              if(window.matchMedia('(max-width:760px)').matches){
                const mobilePanel = dropdown.closest('.mobile-menu-panel');
                if(mobilePanel){
                  mobilePanel.classList.remove('open');
                  const toggle = mobilePanel.parentElement.querySelector('.mobile-menu-toggle');
                  if(toggle) toggle.setAttribute('aria-expanded','false');
                }
              }
            });
          });
        });
        
        // Fermer dropdowns au clic extérieur
        document.addEventListener('click', () => {
          document.querySelectorAll('.sort-dropdown').forEach(dropdown => {
            dropdown.classList.remove('active');
          });
        });
      }
      
      // Appliquer le tri selon la section et le type
      function applySorting(section, sortType) {
        console.log(`🔄 Tri ${section} par ${sortType}`);
        
        // Utiliser les données filtrées par catégorie si applicable
        let dataToSort = getCurrentFilteredData();
        let displayFunction;
        
        switch(section) {
          case 'articles':
            displayFunction = displayArticles;
            break;
          case 'offres':
            displayFunction = displayOffres;
            break;
          case 'arnaques':
            displayFunction = displayArnaques;
            break;
          case 'Avis':
            displayFunction = displayAvis;
            break;
          default:
            return;
        }
        
        // Tri selon le type
        switch(sortType) {
          case 'relevance':
            // Tri par pertinence (ordre original)
            break;
          case 'name-asc':
            dataToSort.sort((a, b) => {
              const nameA = a.nom || a.name || a.username || '';
              const nameB = b.nom || b.name || b.username || '';
              return nameA.localeCompare(nameB);
            });
            break;
          case 'name-desc':
            dataToSort.sort((a, b) => {
              const nameA = a.nom || a.name || a.username || '';
              const nameB = b.nom || b.name || b.username || '';
              return nameB.localeCompare(nameA);
            });
            break;
          case 'price-asc':
            dataToSort.sort((a, b) => (a.prix || a.price || 0) - (b.prix || b.price || 0));
            break;
          case 'price-desc':
            dataToSort.sort((a, b) => (b.prix || b.price || 0) - (a.prix || a.price || 0));
            break;
          case 'recent':
            dataToSort.sort((a, b) => {
              const dateA = new Date(a.date || a.dateAjout || 0);
              const dateB = new Date(b.date || b.dateAjout || 0);
              return dateB - dateA;
            });
            break;
          case 'date-old':
            dataToSort.sort((a, b) => {
              const dateA = new Date(a.date || a.dateAjout || 0);
              const dateB = new Date(b.date || b.dateAjout || 0);
              return dateA - dateB;
            });
            break;
          case 'date-desc':
            dataToSort.sort((a, b) => {
              const dateA = new Date(a.date || a.dateAjout || 0);
              const dateB = new Date(b.date || b.dateAjout || 0);
              return dateB - dateA;
            });
            break;
          case 'rating-desc':
            dataToSort.sort((a, b) => (b.rating || 5) - (a.rating || 5));
            break;
        }
        
        displayFunction(dataToSort);
      }
      
      // Gestion des filtres
      document.getElementById('filter-button').addEventListener('click', () => {
        openModal('filter-modal');
      });
      
      // Bouton panier avec style ancien
      document.getElementById('cart-button').addEventListener('click', () => {
        updateCartModal();
        closeModal('product-modal');
        openModal('cart-modal');
      });
      
      // Bouton d'ajout d'avis
      const addReviewBtn = document.getElementById('add-review-btn');
      if (addReviewBtn) {
        addReviewBtn.addEventListener('click', () => {
          openModal('add-review-modal');
        });
      }
      
      // Gestion des recherches
      document.getElementById('search-input').addEventListener('input', applyFilters);
      document.getElementById('search-input').addEventListener('input', applyFilters);
      document.getElementById('search-input').addEventListener('input', applyFilters);
  const searchAvis = document.getElementById('search-input');
  if (searchAvis) searchAvis.addEventListener('input', applyFilters);
      
      // Gestion des filtres
      const applyFiltersBtn = document.getElementById('apply-filters');
      if (applyFiltersBtn) {
        applyFiltersBtn.addEventListener('click', () => {
          applyFilters();
          closeModal('filter-modal');
        });
      }
      const closeFilterModalBtn = document.getElementById('close-filter-modal');
      if (closeFilterModalBtn) closeFilterModalBtn.addEventListener('click', () => closeModal('filter-modal'));
      const filterBtnOffres = document.getElementById('filter-button-offres');
      if (filterBtnOffres) filterBtnOffres.addEventListener('click', () => openModal('filter-modal'));
      const filterBtnAvis = document.getElementById('filter-button-Avis');
      if (filterBtnAvis) filterBtnAvis.addEventListener('click', () => openModal('filter-modal'));
      
      // Gestion du sélecteur de produit
      const productSelectBtn = document.getElementById('product-select-btn');
      if (productSelectBtn) {
        productSelectBtn.addEventListener('click', () => {
          loadProductsForSelection();
          openModal('product-selection-modal');
        });
      }
      
      const closeProductSelectionBtn = document.getElementById('close-product-selection-modal');
      if (closeProductSelectionBtn) {
        closeProductSelectionBtn.addEventListener('click', () => {
          closeModal('product-selection-modal');
        });
      }
      
      // Recherche de produit
      const productSearchInput = document.getElementById('product-search-input');
      if (productSearchInput) {
        productSearchInput.addEventListener('input', (e) => {
          filterProductsForSelection(e.target.value);
        });
      }

      // Gestion de la soumission d'avis
      document.getElementById('add-review-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const produitInput = document.getElementById('review-produit');
        const produitNom = produitInput.value || ''; // Produit optionnel
        const isAnonymous = document.getElementById('review-anonymous').checked;
        
        // Gestion du nom client (anonyme ou non)
        let clientName = document.getElementById('review-client').value.trim();
        
        // Le nom doit TOUJOURS être renseigné, même pour un avis anonyme
        if (!clientName) {
          alert('Veuillez saisir votre nom (obligatoire dans tous les cas).');
          return;
        }
        
        // Gestion des médias - Upload avant soumission de l'avis
        const mediaFiles = document.getElementById('review-media').files;
        let mediaUrls = [];
        
        if (mediaFiles.length > 0) {
          try {
            const produitSlug = produitNom 
              ? produitNom.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '')
              : 'general';
            
            // Créer FormData pour l'upload vers Pixeldrain
            const formData = new FormData();
            
            // Renommer les fichiers avec un format structuré: avis-[produit]-[index].[ext]
            for (let i = 0; i < mediaFiles.length; i++) {
              const file = mediaFiles[i];
              const ext = file.name.split('.').pop();
              const newFileName = `avis-${produitSlug}-${i + 1}.${ext}`;
              
              // Créer un nouveau File avec le nom modifié
              const renamedFile = new File([file], newFileName, { type: file.type });
              formData.append('medias', renamedFile);
            }
            
            // Ajouter les informations minimales pour messages-Avis
            const titreAvis = document.getElementById('review-titre').value.trim();
            const messageAvis = document.getElementById('review-description').value.trim();
            
            formData.append('message', messageAvis || `Avis client${produitNom ? ` sur ${produitNom}` : ''}`);
            formData.append('titre', titreAvis || (produitNom ? `Avis sur ${produitNom}` : 'Avis client'));
            formData.append('produit', produitNom);
            
            // Upload des médias vers Pixeldrain via l'API dédiée (pas messages-Avis)
            const uploadResponse = await fetch('/api/upload-avis-media', {
              method: 'POST',
              body: formData
            });
            
            if (uploadResponse.ok) {
              const uploadResult = await uploadResponse.json();
              
              // Récupérer les médias uploadés avec toutes les infos (path, url, pixeldrain_id, etc.)
              if (uploadResult.medias && uploadResult.medias.length > 0) {
                mediaUrls = uploadResult.medias; // Garder l'objet complet
                console.log('✓ Médias uploadés vers Pixeldrain:', mediaUrls);
                console.log(`  ${uploadResult.uploaded} fichier(s) mappé(s) dans pixeldrain-mapping.json`);
              }
            } else {
              const errorText = await uploadResponse.text();
              throw new Error(`Erreur upload: ${errorText}`);
            }
          } catch (error) {
            console.error('Erreur upload médias:', error);
            alert('Erreur lors de l\'upload des médias vers Pixeldrain: ' + error.message + '\n\nVous pouvez continuer sans médias ou réessayer.');
            // On continue même en cas d'erreur d'upload pour ne pas bloquer l'avis
          }
        }

        const reviewData = {
          id: Date.now(),
          client: isAnonymous ? 'Anonyme' : clientName, // Nom affiché publiquement
          realName: clientName, // Nom réel toujours conservé pour l'admin
          isAnonymous: isAnonymous,
          titre: document.getElementById('review-titre').value.trim() || '',
          commentaire: document.getElementById('review-description').value.trim() || '',
          rating: selectedRating,
          date: new Date().toLocaleDateString('fr-FR'),
          dateSubmission: new Date().toISOString(),
          medias: mediaUrls // Objets complets des fichiers uploadés avec path, url, pixeldrain_id
        };
        
        // Ajouter info produit (optionnel maintenant)
        if (produitNom) {
          reviewData.produit = produitNom;
          reviewData.produitId = produitInput.dataset.productId || '';
          reviewData.categorie = produitInput.dataset.categorie || '';
        }
        
        submitReview(reviewData);
      });
      
      // Gestion des étoiles de notation
      document.querySelectorAll('.rating-star').forEach(star => {
        star.addEventListener('click', () => {
          selectedRating = parseInt(star.dataset.rating);
          updateStars();
          updateRatingText();
        });
      });
      
      // Gestion de la checkbox anonyme
      document.getElementById('review-anonymous').addEventListener('change', (e) => {
        const clientInput = document.getElementById('review-client');
        if (e.target.checked) {
          // Le champ reste actif et obligatoire, mais on indique que l'affichage sera anonyme
          clientInput.placeholder = 'Votre nom (obligatoire, sera masqué publiquement)';
          clientInput.style.borderColor = '#ffd369';
        } else {
          clientInput.placeholder = 'Votre nom';
          clientInput.style.borderColor = '';
        }
      });
      
      // Fonction pour charger les produits dans la modal de sélection
      function loadProductsForSelection() {
        const grid = document.getElementById('product-selection-grid');
        grid.innerHTML = '';
        
        if (!articlesData || articlesData.length === 0) {
          grid.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.7); padding: 40px;">Aucun produit disponible</div>';
          return;
        }
        
        articlesData.forEach((article, index) => {
          const productCard = document.createElement('div');
          productCard.className = 'product-selection-card';
          
          // Utiliser l'attribut thumbnail en priorité
          let thumbnailPath = article.thumbnail || '';
          
          // Si pas de thumbnail, fallback sur le premier média ou image
          if (!thumbnailPath) {
            if (article.medias && article.medias.length > 0) {
              thumbnailPath = article.medias[0].path;
            } else if (article.image) {
              thumbnailPath = article.image;
            }
          }
          
          // Détecter si c'est une vidéo
          const isVideo = thumbnailPath && /\.(mp4|webm|mov)$/i.test(thumbnailPath);
          
          // Créer l'élément média approprié
          let mediaElement = '';
          if (thumbnailPath) {
            if (isVideo) {
              mediaElement = `<video src="${thumbnailPath}" muted loop autoplay style="width: 100%; height: 100%; object-fit: cover;" onloadedmetadata="handleThumbnailVideoLoad(this)"></video>`;
            } else {
              mediaElement = `<img src="${thumbnailPath}" alt="${article.nom}" style="width: 100%; height: 100%; object-fit: cover;">`;
            }
          }
          
          // Extraire seulement la catégorie finale du chemin
          const categoryParts = article.categorie ? article.categorie.split('/') : ['Sans catégorie'];
          const finalCategory = categoryParts[categoryParts.length - 1];
          
          // Tronquer le nom si trop long
          const truncatedName = article.nom.length > 25 ? article.nom.substring(0, 25) + '...' : article.nom;
          
          productCard.innerHTML = `
            <div class="product-selection-card-content">
              <h4 class="product-selection-title" title="${article.nom}">${truncatedName}</h4>
              <div class="product-selection-bottom">
                ${mediaElement ? `<div class="product-selection-image">${mediaElement}</div>` : ''}
                <div class="product-selection-right">
                  <p class="product-selection-price">${article.prix}€</p>
                  <span class="product-selection-category" title="${finalCategory}">${finalCategory}</span>
                </div>
              </div>
            </div>
          `;
          
          productCard.addEventListener('click', () => {
            selectProduct(article);
          });
          
          grid.appendChild(productCard);
        });
      }
      
      // Fonction pour sélectionner un produit
      function selectProduct(product) {
        const selectedProductDiv = document.getElementById('selected-product');
        const hiddenInput = document.getElementById('review-produit');
        
        // Utiliser thumbnail en priorité
        const imgSrc = product.thumbnail || (product.medias && product.medias.length > 0 ? product.medias[0].path : (product.image || ''));
        
        selectedProductDiv.innerHTML = `
          <div class="selected-product-info">
            <img src="${imgSrc}" 
                 alt="${product.nom}" class="selected-product-image" style="${!imgSrc ? 'display:none' : ''}">
            <div class="selected-product-details">
              <h4>${product.nom}</h4>
              <p>${product.prix}€</p>
              <span class="selected-category">${product.categorie || 'Produit'}</span>
            </div>
          </div>
        `;
        
        selectedProductDiv.classList.add('has-product');
        hiddenInput.value = product.nom;
        hiddenInput.dataset.productId = product.id;
        hiddenInput.dataset.categorie = product.categorie;
        
        closeModal('product-selection-modal');
      }
      
      // Fonction pour filtrer les produits
      function filterProductsForSelection(searchTerm) {
        const cards = document.querySelectorAll('.product-selection-card');
        cards.forEach(card => {
          const title = card.querySelector('.product-selection-title').textContent.toLowerCase();
          const category = card.querySelector('.product-selection-category').textContent.toLowerCase();
          
          if (title.includes(searchTerm.toLowerCase()) || category.includes(searchTerm.toLowerCase())) {
            card.style.display = 'block';
          } else {
            card.style.display = 'none';
          }
        });
      }

      // Fonction pour mettre à jour le texte de notation
      function updateRatingText() {
        const ratingTexts = {
          1: 'Très mécontent (1/5)',
          2: 'Mécontent (2/5)',
          3: 'Neutre (3/5)',
          4: 'Satisfait (4/5)',
          5: 'Très satisfait (5/5)'
        };
        const ratingTextElement = document.querySelector('.rating-text');
        if (ratingTextElement) {
          ratingTextElement.textContent = ratingTexts[selectedRating] || 'Très satisfait (5/5)';
        }
      }
      // Gestion des médias
      let selectedMediaFiles = [];
      let availableGalleryMedia = [];
      
      let mediaModalInitialized = false;
      let isMediaModalOpening = false;
      let mediaUploadClickHandler = null; // Référence pour l'event listener
      
      function initMediaUpload() {
        // Empêcher les initialisations multiples
        if (mediaModalInitialized) {
          return;
        }
        
        const mediaUploadBtn = document.getElementById('media-upload-btn');
        
        if (mediaUploadBtn) {
          // Créer le handler une seule fois
          mediaUploadClickHandler = function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Bouton média cliqué, isMediaModalOpening:', isMediaModalOpening);
            if (!isMediaModalOpening) {
              openMediaSelectionModal();
            }
          };
          
          // Supprimer les anciens événements et ajouter le nouveau
          if (mediaUploadBtn.onclick) mediaUploadBtn.onclick = null;
          mediaUploadBtn.removeEventListener('click', mediaUploadClickHandler);
          mediaUploadBtn.addEventListener('click', mediaUploadClickHandler);
        }
        
        // Initialiser les événements de la modale de sélection de médias une seule fois
        initMediaSelectionModal();
        mediaModalInitialized = true;
      }
      
      function handleDeviceMediaSelection(e) {
        const files = Array.from(e.target.files);
        handleDeviceFiles(files);
      }
      
      // Variable globale pour le callback de sélection de médias
      let mediaSelectionCallback = null;
      let mediaSelectionMultipleMode = false;
      
      function openMediaSelectionModal(callback = null, multipleMode = false) {
        console.log('openMediaSelectionModal appelée, callback:', !!callback, 'multipleMode:', multipleMode);
        if (isMediaModalOpening) {
          console.log('Modal déjà en cours d\'ouverture, ignoré');
          return;
        }
        
        // Stocker le callback et le mode
        mediaSelectionCallback = callback;
        mediaSelectionMultipleMode = multipleMode;
        
        // Réinitialiser la sélection
        selectedMediaFiles = [];
        updateMediaPreview();
        
        isMediaModalOpening = true;
        const modal = document.getElementById('media-selection-modal');
        if (modal && !modal.classList.contains('show')) {
          // Utiliser le système spécial pour les modales de médias (ne ferme pas les autres)
          modal.classList.remove('hidden');
          modal.classList.add('show');
          console.log('Modal ouverte avec callback:', !!callback);
        } else {
          console.log('Modal déjà ouverte ou introuvable');
        }
        
        // Réinitialiser le flag après un délai plus court
        setTimeout(() => {
          isMediaModalOpening = false;
          console.log('Flag isMediaModalOpening réinitialisé');
        }, 200);
      }
      
      function closeMediaSelectionModal() {
        const modal = document.getElementById('media-selection-modal');
        modal.classList.remove('show');
        modal.classList.add('hidden');
      }
      
      function updateMediaPreview() {
        // Réinitialiser le compteur de médias sélectionnés
        updateMediaCount();
        // Réinitialiser les prévisualisations
        const devicePreview = document.getElementById('device-selected-preview');
        if (devicePreview) devicePreview.innerHTML = '';
      }
      
      function openDeviceInput() {
        document.getElementById('device-media-input').click();
      }
      
      function initMediaSelectionModal() {
        const closeBtn = document.getElementById('close-media-selection-modal');
        const deviceInput = document.getElementById('device-media-input');
        const dropZone = document.getElementById('upload-drop-zone');
        
        // Supprimer les anciens event listeners pour éviter les doublons
        if (closeBtn) {
          closeBtn.removeEventListener('click', closeMediaSelectionModal);
          closeBtn.addEventListener('click', closeMediaSelectionModal);
        }
        

        
        if (dropZone) {
          dropZone.removeEventListener('click', openDeviceInput);
          dropZone.addEventListener('click', openDeviceInput);
        }
        
        if (deviceInput) {
          deviceInput.removeEventListener('change', handleDeviceMediaSelection);
          deviceInput.addEventListener('change', handleDeviceMediaSelection);
        }
        
        // Drag & drop
        dropZone.addEventListener('dragover', (e) => {
          e.preventDefault();
          dropZone.classList.add('drag-over');
        });
        
        dropZone.addEventListener('dragleave', () => {
          dropZone.classList.remove('drag-over');
        });
        
        dropZone.addEventListener('drop', (e) => {
          e.preventDefault();
          dropZone.classList.remove('drag-over');
          const files = Array.from(e.dataTransfer.files);
          handleDeviceFiles(files);
        });
        
        // Boutons d'action
        document.getElementById('cancel-media-selection').addEventListener('click', () => {
          selectedMediaFiles = [];
          mediaSelectionCallback = null; // Réinitialiser le callback
          closeMediaSelectionModal();
          updateMediaPreview();
        });
        
        document.getElementById('validate-media-selection').addEventListener('click', () => {
          // Si un callback est défini, l'utiliser au lieu de applyMediaSelection
          if (mediaSelectionCallback) {
            console.log('Callback trouvé, appel avec', selectedMediaFiles.length, 'médias');
            mediaSelectionCallback(selectedMediaFiles);
            mediaSelectionCallback = null; // Réinitialiser après utilisation
          } else {
            applyMediaSelection();
          }
          closeMediaSelectionModal();
        });
      }
      
      function handleDeviceFiles(files) {
        files.forEach(file => {
          if (file.type.startsWith('image/') || file.type.startsWith('video/')) {
            selectedMediaFiles.push({
              type: 'device',
              file: file,
              url: URL.createObjectURL(file),
              name: file.name
            });
          }
        });
        updateSelectedMediaPreview('device');
        updateMediaCount();
      }
      
      function updateSelectedMediaPreview(tabType) {
        const preview = document.getElementById(`${tabType}-selected-preview`);
        const relevantMedia = selectedMediaFiles.filter(media => media.type === tabType);
        
        preview.innerHTML = '';
        
        relevantMedia.forEach((media, index) => {
          const mediaItem = document.createElement('div');
          mediaItem.className = 'selected-media-item';
          
          const isVideo = media.name.toLowerCase().includes('.mp4') || 
                         media.name.toLowerCase().includes('.mov') || 
                         media.name.toLowerCase().includes('.avi');
          
          mediaItem.innerHTML = `
            ${isVideo ? 
              `<video src="${media.url}" muted></video>` : 
              `<img src="${media.url}" alt="Preview">`
            }
            <button class="remove-selected" onclick="removeSelectedMedia(${selectedMediaFiles.indexOf(media)})">×</button>
          `;
          
          preview.appendChild(mediaItem);
        });
      }
      
      function removeSelectedMedia(index) {
        selectedMediaFiles.splice(index, 1);
        updateSelectedMediaPreview('device');
        updateMediaCount();
      }
      
      function updateMediaCount() {
        const count = selectedMediaFiles.length;
        const countElement = document.getElementById('selected-media-count');
        countElement.textContent = `${count} média${count > 1 ? 's' : ''} sélectionné${count > 1 ? 's' : ''}`;
        
        const validateBtn = document.getElementById('validate-media-selection');
        validateBtn.disabled = count === 0;
      }
      
      function applyMediaSelection() {
        // Appliquer la sélection au formulaire d'avis
        const preview = document.getElementById('media-preview');
        preview.innerHTML = '';
        
        // Créer un nouveau DataTransfer pour les fichiers device
        const dt = new DataTransfer();
        
        selectedMediaFiles.forEach((media, index) => {
          const mediaItem = document.createElement('div');
          mediaItem.className = 'media-preview-item';
          
          const isVideo = media.name.toLowerCase().includes('.mp4') || 
                         media.name.toLowerCase().includes('.mov') || 
                         media.name.toLowerCase().includes('.avi');
          
          mediaItem.innerHTML = `
            ${isVideo ? 
              `<video src="${media.url}" muted></video>` : 
              `<img src="${media.url}" alt="Preview">`
            }
            <button class="media-preview-remove" data-index="${index}" type="button">×</button>
          `;
          
          // Ajouter l'event listener pour la suppression
          const removeBtn = mediaItem.querySelector('.media-preview-remove');
          removeBtn.addEventListener('click', () => {
            removeMediaFromForm(index);
          });
          
          preview.appendChild(mediaItem);
          
          // Ajouter les fichiers device au DataTransfer
          if (media.type === 'device' && media.file) {
            dt.items.add(media.file);
          }
        });
        
        // Mettre à jour l'input file avec les fichiers device
        const reviewMediaInput = document.getElementById('review-media');
        reviewMediaInput.files = dt.files;
      }
      
      function removeMediaFromForm(index) {
        selectedMediaFiles.splice(index, 1);
        applyMediaSelection();
      }
      
      // Fonction globale pour la suppression depuis l'HTML
      window.removeSelectedMedia = removeSelectedMedia;
        
      // Chargement initial des données
      async function initializeData() {
        try {
          // S'assurer que la section articles est définie comme courante
          currentSection = 'articles';
          
          // S'assurer que la section articles est bien visible (elle a déjà active dans le HTML)
          const articlesSection = document.getElementById('articles-section');
          console.log('Section articles trouvée:', !!articlesSection);
          if (articlesSection) {
            console.log('Section articles active:', articlesSection.classList.contains('active'));
            if (!articlesSection.classList.contains('active')) {
              articlesSection.classList.add('active');
              console.log('Section articles activée manuellement');
            }
          }
          
          // Activer le bouton articles dans tous les menus
          document.querySelectorAll('#menu-articles, #menu-articles-desktop, #banner-articles').forEach(btn => {
            if (btn) btn.classList.add('active');
          });
          
          // Charger les données des articles
          console.log('Chargement des articles au démarrage...');
          await loadSectionData();
          
          // Initialiser l'upload de médias
          initMediaUpload();
          
          // Initialiser le bouton de fermeture de la modal d'avis
          const closeAddReviewBtn = document.getElementById('close-add-review-modal');
          if (closeAddReviewBtn) {
            closeAddReviewBtn.addEventListener('click', () => {
              closeModal('add-review-modal');
            });
          }
          
          // ==================== GESTION MODAL ARNAQUE ====================
          let selectedArnaqueProducts = []; // Tableau pour stocker plusieurs produits
          
          const addArnaqueBtn = document.getElementById('add-arnaque-btn');
          if (addArnaqueBtn) {
            addArnaqueBtn.addEventListener('click', () => {
              openModal('add-arnaque-modal');
              selectedArnaqueProducts = [];
              updateSelectedArnaqueProductsDisplay();
            });
          }
          
          const closeAddArnaqueBtn = document.getElementById('close-add-arnaque-modal');
          if (closeAddArnaqueBtn) {
            closeAddArnaqueBtn.addEventListener('click', () => {
              closeModal('add-arnaque-modal');
            });
          }
          
          // Gestion du bouton sélection de produits pour arnaque
          const arnaqueProductSelectBtn = document.getElementById('arnaque-product-select-btn');
          if (arnaqueProductSelectBtn) {
            arnaqueProductSelectBtn.addEventListener('click', () => {
              loadProductsForArnaqueSelection();
              openModal('product-selection-modal');
            });
          }
          
          // Fonction pour charger les produits pour sélection arnaque
          function loadProductsForArnaqueSelection() {
            const grid = document.getElementById('product-selection-grid');
            grid.innerHTML = '';
            
            if (!articlesData || articlesData.length === 0) {
              grid.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.7); padding: 40px;">Aucun produit disponible</div>';
              return;
            }
            
            articlesData.forEach((article) => {
              const productCard = document.createElement('div');
              productCard.className = 'product-selection-card';
              
              // Vérifier si le produit est déjà sélectionné
              const isSelected = selectedArnaqueProducts.some(p => p.id === article.id);
              if (isSelected) {
                productCard.style.opacity = '0.5';
                productCard.style.border = '2px solid #ffd369';
              }
              
              // Utiliser l'attribut thumbnail en priorité
              let thumbnailPath = article.thumbnail || '';
              
              // Si pas de thumbnail, fallback sur le premier média ou image
              if (!thumbnailPath) {
                if (article.medias && article.medias.length > 0) {
                  thumbnailPath = article.medias[0].path;
                } else if (article.image) {
                  thumbnailPath = article.image;
                }
              }
              
              // Détecter si c'est une vidéo
              const isVideo = thumbnailPath && /\.(mp4|webm|mov)$/i.test(thumbnailPath);
              
              let mediaElement = '';
              if (thumbnailPath) {
                if (isVideo) {
                  mediaElement = `<video src="${thumbnailPath}" muted loop autoplay style="width: 100%; height: 100%; object-fit: cover;"></video>`;
                } else {
                  mediaElement = `<img src="${thumbnailPath}" alt="${article.nom}" style="width: 100%; height: 100%; object-fit: cover;">`;
                }
              }
              
              const categoryParts = article.categorie ? article.categorie.split('/') : ['Sans catégorie'];
              const finalCategory = categoryParts[categoryParts.length - 1];
              const truncatedName = article.nom.length > 25 ? article.nom.substring(0, 25) + '...' : article.nom;
              
              productCard.innerHTML = `
                <div class="product-selection-card-content">
                  <h4 class="product-selection-title" title="${article.nom}">${truncatedName}</h4>
                  <div class="product-selection-bottom">
                    ${mediaElement ? `<div class="product-selection-image">${mediaElement}</div>` : ''}
                    <div class="product-selection-right">
                      <p class="product-selection-price">${article.prix}€</p>
                      <span class="product-selection-category">${finalCategory}</span>
                    </div>
                  </div>
                  ${isSelected ? '<div style="position:absolute;top:10px;right:10px;background:#ffd369;color:#1a0b2e;padding:5px 10px;border-radius:20px;font-weight:600;font-size:12px;">✓ Sélectionné</div>' : ''}
                </div>
              `;
              
              productCard.addEventListener('click', () => {
                selectArnaqueProduct(article);
              });
              
              grid.appendChild(productCard);
            });
          }
          
          // Fonction pour sélectionner un produit pour arnaque (ajout dans le tableau)
          function selectArnaqueProduct(product) {
            // Vérifier si déjà sélectionné
            const alreadySelected = selectedArnaqueProducts.some(p => p.id === product.id);
            
            if (alreadySelected) {
              // Retirer du tableau
              selectedArnaqueProducts = selectedArnaqueProducts.filter(p => p.id !== product.id);
              showToast('Produit retiré de la sélection', 'info', 2000);
            } else {
              // Ajouter au tableau
              selectedArnaqueProducts.push(product);
              showToast('Produit ajouté à la sélection', 'success', 2000);
            }
            
            updateSelectedArnaqueProductsDisplay();
            
            // Recharger la grille pour mettre à jour l'affichage
            loadProductsForArnaqueSelection();
          }
          
          // Fonction pour mettre à jour l'affichage des produits sélectionnés
          function updateSelectedArnaqueProductsDisplay() {
            const selectedProductsDiv = document.getElementById('selected-arnaque-products');
            const hiddenInput = document.getElementById('arnaque-produits');
            
            if (selectedArnaqueProducts.length === 0) {
              selectedProductsDiv.innerHTML = `
                <div class="product-placeholder">
                  <span class="product-icon">📦</span>
                  <span class="product-text">Cliquez pour sélectionner des produits</span>
                </div>
              `;
              selectedProductsDiv.classList.remove('has-products');
              hiddenInput.value = '';
            } else {
              selectedProductsDiv.innerHTML = `
                <div class="selected-products-list">
                  ${selectedArnaqueProducts.map(product => `
                    <div class="selected-product-tag">
                      <span>${product.nom}</span>
                      <button type="button" class="selected-product-remove" onclick="removeArnaqueProduct(${product.id})">×</button>
                    </div>
                  `).join('')}
                </div>
              `;
              selectedProductsDiv.classList.add('has-products');
              hiddenInput.value = selectedArnaqueProducts.map(p => p.nom).join(', ');
            }
          }
          
          // Fonction globale pour retirer un produit
          window.removeArnaqueProduct = function(productId) {
            selectedArnaqueProducts = selectedArnaqueProducts.filter(p => p.id !== productId);
            updateSelectedArnaqueProductsDisplay();
          };
          
          // Gestion de l'upload des preuves
          const arnaqueMediaUploadBtn = document.getElementById('arnaque-media-upload-btn');
          
          // Stocker les médias sélectionnés pour l'arnaque
          let selectedArnaqueMedias = [];
          
          if (arnaqueMediaUploadBtn) {
            arnaqueMediaUploadBtn.addEventListener('click', () => {
              // Ouvrir la modal de sélection Pixeldrain
              openMediaSelectionModal((selectedMedias) => {
                console.log('Callback arnaque appelé avec:', selectedMedias);
                // Conserver tous les champs (file, url, path, name, type)
                selectedArnaqueMedias = selectedMedias.map(media => ({
                  file: media.file,        // Objet File pour upload
                  url: media.url,          // URL blob pour preview
                  path: media.url || media.path, // Path pour affichage
                  name: media.name,
                  type: media.type
                }));
                console.log('Médias mappés:', selectedArnaqueMedias);
                displayArnaqueMediaPreview();
              }, true); // true = mode multiple pour arnaques
            });
          }
          
          // Fonction pour afficher la prévisualisation des preuves depuis Pixeldrain
          function displayArnaqueMediaPreview() {
            const preview = document.getElementById('arnaque-media-preview');
            preview.innerHTML = '';
            
            if (!selectedArnaqueMedias || selectedArnaqueMedias.length === 0) {
              return;
            }
            
            selectedArnaqueMedias.forEach((media, index) => {
              const mediaItem = document.createElement('div');
              mediaItem.className = 'media-preview-item';
              
              const isVideo = /\.(mp4|webm|mov)$/i.test(media.path || media);
              const mediaUrl = media.path || media;
              
              if (isVideo) {
                mediaItem.innerHTML = `
                  <video src="${mediaUrl}" muted loop autoplay style="max-width:100%;max-height:100px;border-radius:6px;"></video>
                  <button type="button" class="media-preview-remove" onclick="removeArnaqueMedia(${index})">×</button>
                `;
              } else {
                mediaItem.innerHTML = `
                  <img src="${mediaUrl}" alt="Preuve" style="max-width:100%;max-height:100px;object-fit:cover;border-radius:6px;">
                  <button type="button" class="media-preview-remove" onclick="removeArnaqueMedia(${index})">×</button>
                `;
              }
              
              preview.appendChild(mediaItem);
            });
          }
          
          // Fonction globale pour retirer un média
          window.removeArnaqueMedia = function(index) {
            selectedArnaqueMedias.splice(index, 1);
            displayArnaqueMediaPreview();
          };
          
          // Gestion des boutons réseaux pour signalement
          document.querySelectorAll('.reseau-btn-signalement').forEach(btn => {
            btn.addEventListener('click', function() {
              this.classList.toggle('selected');
              updateReseauxSignalementInput();
            });
          });

          function updateReseauxSignalementInput() {
            const selectedReseaux = Array.from(document.querySelectorAll('.reseau-btn-signalement.selected'))
              .map(btn => btn.getAttribute('data-reseau'));
            document.getElementById('arnaque-reseaux').value = selectedReseaux.join(', ');
          }

          // Gestion de la soumission du formulaire arnaque
          document.getElementById('add-arnaque-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const nom = document.getElementById('arnaque-nom').value.trim();
            const arnaqueurId = document.getElementById('arnaque-id').value.trim();
            const reseaux = document.getElementById('arnaque-reseaux').value.trim();
            const denonceur = document.getElementById('arnaque-denonceur').value.trim();
            const technique = document.getElementById('arnaque-technique').value.trim();
            const isAnonymous = document.getElementById('arnaque-anonymous').checked;
            
            // Validation des champs obligatoires
            if (!nom) {
              showToast('Le nom de l\'arnaqueur est obligatoire', 'error', 3000);
              return;
            }
            
            if (!arnaqueurId) {
              showToast('L\'identifiant de l\'arnaqueur est obligatoire', 'error', 3000);
              return;
            }

            if (!reseaux) {
              showToast('Sélectionnez au moins un réseau social', 'error', 3000);
              return;
            }

            if (!denonceur) {
              showToast('Votre nom est obligatoire', 'error', 3000);
              return;
            }
            
            if (!technique) {
              showToast('La technique détaillée est obligatoire', 'error', 3000);
              return;
            }
            
            // Gestion de l'upload des preuves (Pixeldrain + fichiers locaux)
            console.log(`[ARNAQUE] ${selectedArnaqueMedias.length} média(s) sélectionné(s)`);
            
            // Vérifier si on a des fichiers locaux à uploader
            const hasLocalFiles = selectedArnaqueMedias.some(media => media.file);
            
            const arnaqueData = {
              id: Date.now(),
              nom: nom,
              arnaqueurId: arnaqueurId,
              reseaux: reseaux,
              denonceur: denonceur, // Toujours sauvegarder le vrai nom
              denonceurReel: denonceur, // Nom réel pour l'admin
              isAnonymous: isAnonymous, // Flag pour affichage public
              technique: technique,
              produits: selectedArnaqueProducts.map(p => ({
                id: p.id,
                nom: p.nom,
                prix: p.prix
              })),
              date: new Date().toISOString(),
              status: 'pending',
              verified: false
            };
            
            try {
              let response;
              
              if (hasLocalFiles) {
                // Utiliser FormData pour uploader les fichiers locaux
                console.log('[ARNAQUE] Upload avec FormData (fichiers locaux)');
                const formData = new FormData();
                formData.append('data', JSON.stringify(arnaqueData));
                
                // Ajouter les fichiers locaux
                selectedArnaqueMedias.forEach((media, index) => {
                  if (media.file) {
                    formData.append('preuves', media.file);
                    console.log(`[ARNAQUE] Fichier ${index}:`, media.name);
                  }
                });
                
                response = await fetch('/api/arnaques-pending', {
                  method: 'POST',
                  body: formData
                  // Pas de Content-Type, le navigateur le définit automatiquement avec boundary
                });
              } else {
                // Utiliser JSON si uniquement des URLs Pixeldrain
                console.log('[ARNAQUE] Upload avec JSON (URLs Pixeldrain uniquement)');
                arnaqueData.preuves = selectedArnaqueMedias.map(media => media.path);
                
                response = await fetch('/api/arnaques-pending', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(arnaqueData)
                });
              }
              
              if (response.ok) {
                showToast('Signalement envoyé avec succès !', 'success', 3000);
                closeModal('add-arnaque-modal');
                document.getElementById('add-arnaque-form').reset();
                selectedArnaqueProducts = [];
                selectedArnaqueMedias = [];
                // Réinitialiser les boutons réseaux
                document.querySelectorAll('.reseau-btn-signalement').forEach(btn => {
                  btn.classList.remove('selected');
                });
                document.getElementById('arnaque-reseaux').value = '';
                updateSelectedArnaqueProductsDisplay();
                displayArnaqueMediaPreview(); // Nettoyer l'aperçu
              } else {
                const errorData = await response.text();
                console.error('[ARNAQUE] Erreur serveur:', errorData);
                showToast('Erreur lors de l\'envoi du signalement', 'error', 3000);
              }
            } catch (error) {
              console.error('[ARNAQUE] Erreur:', error);
              showToast('Erreur de connexion', 'error', 3000);
            }
          });
          
          // ==================== FIN GESTION MODAL ARNAQUE ====================
          
          // ==================== TECHNIQUES ARNAQUES DISPLAY ====================
          let techniquesArnaquesData = [];
          
          // Charger les techniques d'arnaques
          async function loadTechniquesArnaques() {
            try {
              const response = await fetch('/api/techniques-arnaques');
              if (response.ok) {
                techniquesArnaquesData = await response.json();
                displayTechniquesArnaques();
              }
            } catch (error) {
              console.error('Erreur chargement techniques:', error);
            }
          }
          
          // Afficher les techniques
          let activeTechniqueFilter = null;
          
          function displayTechniquesArnaques() {
            const container = document.getElementById('techniques-arnaques-list');
            if (!container) return;
            
            if (techniquesArnaquesData.length === 0) {
              container.innerHTML = '<p style="color: rgba(255,255,255,0.6); text-align: center; width: 100%;">Aucune technique répertoriée pour le moment</p>';
              return;
            }
            
            container.innerHTML = techniquesArnaquesData.map(technique => {
              const isActive = activeTechniqueFilter === technique.name;
              return `
                <button 
                  class="technique-arnaque-btn" 
                  onclick="toggleTechniqueFilter('${technique.name.replace(/'/g, "\\'")}')"
                  style="${isActive ? 'background: linear-gradient(135deg, #8ef58e, #6ad66a); color: #1a0b2e; box-shadow: 0 4px 15px rgba(142, 245, 142, 0.5);' : ''}"
                  title="Cliquer pour filtrer par cette technique">
                  ${technique.name}
                </button>
              `;
            }).join('');
          }
          
          // Filtrer les arnaques par technique
          window.toggleTechniqueFilter = function(techniqueName) {
            if (activeTechniqueFilter === techniqueName) {
              // Désactiver le filtre
              activeTechniqueFilter = null;
              displayArnaques(arnaquesData);
            } else {
              // Activer le filtre
              activeTechniqueFilter = techniqueName;
              const filtered = arnaquesData.filter(arnaque => {
                if (!arnaque.techniques) return false;
                const techniques = typeof arnaque.techniques === 'string' 
                  ? arnaque.techniques.split(',').map(t => t.trim())
                  : Array.isArray(arnaque.techniques) ? arnaque.techniques : [];
                return techniques.some(t => t.toLowerCase().includes(techniqueName.toLowerCase()));
              });
              displayArnaques(filtered);
            }
            displayTechniquesArnaques(); // Re-render pour mettre à jour l'état actif
          };
          
          // Afficher les détails d'une technique (double-clic)
          window.showTechniqueDetail = function(techniqueName) {
            const technique = techniquesArnaquesData.find(t => t.name === techniqueName);
            if (!technique) return;
            
            document.getElementById('technique-name').textContent = technique.name;
            document.getElementById('technique-detail-description').textContent = technique.description || 'Aucune description disponible';
            
            openModal('technique-detail-modal');
          };
          
          // Fermer la modal de détail
          const closeTechniqueDetailBtn = document.getElementById('close-technique-detail-modal');
          if (closeTechniqueDetailBtn) {
            closeTechniqueDetailBtn.addEventListener('click', () => {
              closeModal('technique-detail-modal');
            });
          }
          
          // Charger les techniques au démarrage
          loadTechniquesArnaques();
          
          // ==================== FIN TECHNIQUES ARNAQUES ====================
          
          // Charger les données pour les autres sections en arrière-plan
          const offresRes = await fetch('/offres.json');
          offresData = await offresRes.json();
          
          const arnaquesRes = await fetch('/arnaques.json');
          arnaquesData = await arnaquesRes.json();
          
          const AvisRes = await fetch('/api/preuves');
          AvisData = await AvisRes.json();
          
          console.log('Toutes les données chargées en arrière-plan');
        } catch (error) {
          console.error('Erreur lors du chargement initial:', error);
        }
      }
      
      // Initialiser bouton panier au démarrage
      document.getElementById('cart-label').style.display = 'none';
      
      // ==================== SYSTÈME DE FILTRES ARNAQUES ====================
      let arnaquesFiltersActive = [];
      let arnaquesFiltersInverted = false; // Pour "Tout sauf..."
      
      document.getElementById('filter-button-arnaques')?.addEventListener('click', () => {
        showArnaquesFiltersModal();
      });
      
      function showArnaquesFiltersModal() {
        let modal = document.getElementById('arnaques-filters-modal');
        if (!modal) {
          modal = document.createElement('div');
          modal.id = 'arnaques-filters-modal';
          modal.className = 'modal';
          modal.innerHTML = `
            <div class="modal-content" style="max-width:700px;width:90%;max-height:90vh;background:linear-gradient(135deg, #2e003e, #6a0572);border-radius:16px;padding:0;overflow:hidden;">
              <div style="background:linear-gradient(135deg, #ffd369, #ffb347);padding:20px;display:flex;justify-content:space-between;align-items:center;">
                <h3 style="margin:0;color:#2e003e;font-size:1.3em;"><img src="img/_technique/icon/filtre.png" style="width:20px;height:20px;vertical-align:middle;margin-right:8px;"/> Filtres Arnaques</h3>
                <button onclick="document.getElementById('arnaques-filters-modal').classList.remove('show')" style="background:none;border:none;color:#2e003e;font-size:2em;cursor:pointer;width:40px;height:40px;">×</button>
              </div>
              <div style="padding:20px;overflow-y:auto;max-height:calc(90vh - 180px);">
                <div style="background:rgba(0,0,0,0.2);padding:10px;border-radius:8px;margin-bottom:12px;border:1px solid rgba(255,211,105,0.3);">
                  <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                    <input type="checkbox" id="arnaque-filter-invert" ${arnaquesFiltersInverted ? 'checked' : ''} style="width:16px;height:16px;cursor:pointer;">
                    <span style="color:#ffd369;font-weight:500;font-size:0.9em;">🔄 Inverser</span>
                  </label>
                </div>
                
                <div id="arnaques-filters-list" style="display:flex;flex-direction:column;gap:12px;"></div>
              </div>
              <div style="padding:20px;background:rgba(0,0,0,0.3);display:flex;justify-content:space-between;gap:10px;">
                <button onclick="clearArnaquesFilters()" style="background:#8b0000;color:#fff;border:none;padding:12px 20px;border-radius:8px;cursor:pointer;font-weight:600;">🗑️ Réinitialiser</button>
                <button onclick="applyArnaquesFilters()" style="background:#8ef58e;color:#2e003e;border:none;padding:12px 20px;border-radius:8px;cursor:pointer;font-weight:700;flex:1;">✅ Appliquer</button>
              </div>
            </div>
          `;
          document.body.appendChild(modal);
          
          // Event listener pour l'inversion
          document.getElementById('arnaque-filter-invert').addEventListener('change', (e) => {
            arnaquesFiltersInverted = e.target.checked;
          });
        }
        
        renderArnaquesFiltersList();
        modal.classList.add('show');
      }
      
      async function renderArnaquesFiltersList() {
        const container = document.getElementById('arnaques-filters-list');
        if (!container) return;
        
        container.innerHTML = '<div style="text-align:center;padding:20px;color:#8ef58e;">Les filtres par catégories ont été supprimés.<br>Utilisez le tri et la recherche pour filtrer les arnaques.</div>';
      }
      
      // Catégories d'arnaques supprimées
      window.toggleArnaqueFilter = function(category, value, icon) {
        // Fonction désactivée - catégories supprimées
      };
      
      window.clearArnaquesFilters = function() {
        arnaquesFiltersActive = [];
        arnaquesFiltersInverted = false;
        document.getElementById('arnaque-filter-invert').checked = false;
        renderArnaquesFiltersList();
        applyArnaquesFilters();
      };
      
      window.applyArnaquesFilters = function() {
        document.getElementById('arnaques-filters-modal').classList.remove('show');
        
        if (arnaquesFiltersActive.length === 0 && !arnaquesFiltersInverted) {
          displayArnaques(arnaquesData);
          return;
        }
        
        // Filtrer les arnaques
        let filtered = arnaquesData.filter(arnaque => {
          let matches = false;
          
          arnaquesFiltersActive.forEach(filter => {
            switch(filter.category) {
              case 'Plateforme':
                const reseauxList = Array.isArray(arnaque.reseaux) ? arnaque.reseaux : (arnaque.reseaux || '').split(', ');
                if (reseauxList.some(r => r.trim() === filter.value)) matches = true;
                break;
                
              case 'Type d\'arnaque':
                const techniques = arnaque.techniques || '';
                if (techniques.includes(filter.value)) matches = true;
                break;
                
              case 'Statut':
                // Ajouter le statut si présent dans les données
                if (arnaque.statut === filter.value) matches = true;
                break;
                
              case 'Montant':
                // Ajouter la logique de montant si présent dans les données
                if (arnaque.montant) {
                  const montant = parseFloat(arnaque.montant);
                  if (filter.value === 'Moins de 50€' && montant < 50) matches = true;
                  if (filter.value === '50€ - 200€' && montant >= 50 && montant < 200) matches = true;
                  if (filter.value === '200€ - 500€' && montant >= 200 && montant < 500) matches = true;
                  if (filter.value === 'Plus de 500€' && montant >= 500) matches = true;
                }
                break;
            }
          });
          
          // Inverser si mode "Tout sauf..."
          return arnaquesFiltersInverted ? !matches : matches;
        });
        
        displayArnaques(filtered);
        
        // Toast de confirmation
        const count = filtered.length;
        const mode = arnaquesFiltersInverted ? 'SAUF' : 'avec';
        showToast(`Filtres appliqués: ${count} arnaqueur(s) ${mode} les critères`, 'info');
      };

      // Chargement initial des données et affichage
      initializeData().then(() => {
        updateStars();
        initSortDropdowns();
        console.log('Initialisation terminée - Articles chargés');
      });

      console.log('Initialisation terminée');
    }); // Fermeture du DOMContentLoaded
    
    // Fonction Toast pour les notifications
    function showToast(message, type = 'info', duration = 4000) {
      let toastContainer = document.getElementById('toast-container');
      if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        toastContainer.style.cssText = 'position:fixed;top:80px;right:20px;z-index:10000;display:flex;flex-direction:column;gap:10px;max-width:400px;';
        document.body.appendChild(toastContainer);
      }
      const toast = document.createElement('div');
      const icons = { 
        success: '✅', 
        error: '❌', 
        warning: '⚠️', 
        info: '<img src="img/_technique/icon/information.png" style="width:16px;height:16px;vertical-align:middle;"/>' 
      };
      const colors = { 
        success: 'linear-gradient(135deg, #4CAF50, #45a049)', 
        error: 'linear-gradient(135deg, #f44336, #da190b)', 
        warning: 'linear-gradient(135deg, #ff9800, #fb8c00)', 
        info: 'linear-gradient(135deg, #2196F3, #0b7dda)' 
      };
      toast.style.cssText = `background:${colors[type]||colors.info};color:white;padding:16px 20px;border-radius:12px;box-shadow:0 6px 25px rgba(0,0,0,0.3);display:flex;align-items:center;gap:12px;font-weight:500;font-size:14px;animation:slideIn 0.3s ease-out;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.2);`;
      toast.innerHTML = `<span style="font-size:20px;">${icons[type]||icons.info}</span><span>${message}</span>`;
      
      if (!document.getElementById('toast-animations')) {
        const style = document.createElement('style');
        style.id = 'toast-animations';
        style.textContent = '@keyframes slideIn{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(400px);opacity:0}}';
        document.head.appendChild(style);
      }
      
      toastContainer.appendChild(toast);
      setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => { 
          toast.remove(); 
          if (toastContainer.children.length === 0) toastContainer.remove(); 
        }, 300);
      }, duration);
    }
    
  </script>
</body>
</html>
